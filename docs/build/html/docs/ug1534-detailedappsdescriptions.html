


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

	<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="37701bd4-e5c0-4ee3-9329-e7475d0b13a7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
		<!-- Google Tag Manager -->
	<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
	<!-- End Google Tag Manager -->
	
        <!-- Google Tag Manager -->
        <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
        <!-- End Google Tag Manager -->	

  
  
  
  

  
      <script type="text/javascript" src="../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../_static/js/Searchbox.min.js"></script>
    <script type="text/javascript" src="../_static/js/header-footer.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/pro.min.css" media="all" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DPDK" href="ug1534-dpdk.html" />
    <link rel="prev" title="3. U25N Installation" href="ug1534-installation.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
 <div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">

    
    

    



<div class="xf-content-height">
    

<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
    
    <div class="header parbase aem-GridColumn aem-GridColumn--default--12"><noindex>
	<header data-component="header" class="site-header">
		<nav class="navbar navbar-default">
			<div class="container-fluid main-nav">
				<div class="row">
					<div class="navbar-column col-xs-4 col-sm-5">
						<ul class="nav navbar-nav hidden-xs">
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
								</li>
							</ul>
							
						<ul class="nav navbar-nav hidden-sm hidden-md hidden-lg">
							<li>
									<button data-target="#header-container-0" data-function="toggle">Solutions</button>
								</li>
							<li>
									<button data-target="#header-container-1" data-function="toggle">Products</button>
								</li>
							<li>
									<button data-target="#header-container-2" data-function="toggle">Company</button>
								</li>
							</ul>
							
						<div id="header-container-0" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-1" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-2" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							</div>
					<div class="logo-column col-xs-4 col-sm-2">
						<div class="logo">
							<a target="_blank" href="https://www.xilinx.com/">
								<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
							</a>
						</div>
					</div>

				</div>
			</div>
			</nav></header></noindex></div>
		
	
</div>

    
</div>
</div>

<div class="calloutBanner parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><div class="callout-banner">
    Xilinx is now a part of <a target="_blank" href="https://www.amd.com/en/corporate/xilinx-acquisition">AMD</a> |  <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Learn More</a>
</div>
</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> U25N
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">U25N</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ug1534-supportedservices.html">Supported Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Detailed Applications Descriptions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#legacy-and-switchdev-modes">4.1 Legacy and Switchdev Modes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#legacy-nic-default">4.1.1 Legacy NIC (Default)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#switchdev-mode">4.1.2 Switchdev Mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ovs">4.2 OVS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-ovs">4.2.1 Installing OVS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#classification-fields-matches">4.2.2 Classification Fields (Matches)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#port-to-port">4.2.3 Port to Port</a></li>
<li class="toctree-l3"><a class="reference internal" href="#port-to-vm-or-vm-to-port">4.2.4 Port to VM or VM to Port</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vm-to-vm">VM to VM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tunnels-encapsulation-decapsulation">4.2.6 Tunnels (Encapsulation/Decapsulation)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#l2gre">L2GRE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vxlan">4.2.6.2 VXLAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vm-to-vm-or-vm-to-port-or-port-to-vm-tunnel">4.2.6.3 VM to VM or VM to Port or Port to VM Tunnel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ovs-configuration">4.2.7 OVS Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functionality-check">4.2.8 Functionality Check</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ping-test">Ping Test</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ipsec">IPsec</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supported-xfrm-parameters">4.3.1 Supported XFRM Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">4.3.2 Classification Fields (Matches)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#encryption">4.3.2.1 Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decryption">4.3.2.2 Decryption</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strongswan-installation">4.3.3 strongSwan Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">4.3.3.1 Server 1 Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">4.3.3.2 Server 2 Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#server-1-steps-to-run-ipsec">4.3.3.3 Server 1: Steps to Run IPsec</a></li>
<li class="toctree-l4"><a class="reference internal" href="#server-2-steps-to-run-ipsec">4.3.3.4 Server 2: Steps to Run IPsec</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#changing-ipsec-tunnel-endpoints">4.3.5 Changing IPsec Tunnel Endpoints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#stateless-firewall">4.4 Stateless Firewall</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#kernel-upgrade">Kernel Upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nftables">nftables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">4.4.3 Classification Fields (Matches)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#driver-installation">Driver Installation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#statistics">4.5 Statistics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ovs-commands">OVS Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mae-rules">4.5.2 MAE Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ipsec-statistics">4.5.3 IPsec Statistics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#debug-commands">4.6 Debug Commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-dpdk.html">DPDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-shellprogramming.html">APPENDIX A U25N Shell Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-vminstall.html">APPENDIX B VM Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Download Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pages.gitenterprise.xilinx.com/techdocs/u25n-smartnic/docs/build/PDF/xd133-u25n-smartnic-solution_1_2.pdf">PDF</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../_sources/docs/ug1534-detailedappsdescriptions.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">U25N</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>4 Detailed Applications Description</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/docs/ug1534-detailedappsdescriptions.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="detailed-applications-description">
<h1>4 Detailed Applications Description<a class="headerlink" href="#detailed-applications-description" title="Permalink to this heading">¶</a></h1>
<div class="section" id="legacy-and-switchdev-modes">
<h2>4.1 Legacy and Switchdev Modes<a class="headerlink" href="#legacy-and-switchdev-modes" title="Permalink to this heading">¶</a></h2>
<div class="section" id="legacy-nic-default">
<h3>4.1.1 Legacy NIC (Default)<a class="headerlink" href="#legacy-nic-default" title="Permalink to this heading">¶</a></h3>
<p>In legacy mode packets from the external MAC0 are forwarded to the internal MAC2 without any modifications on flow entry miss, and vice versa. Similarly, packets from the external MAC1 are forwarded to the internal MAC3 without any modifications on flow entry miss, and vice versa. OVS is not supported in this configuration.</p>
<p><em>Figure 5:</em> <strong>Legacy Mode</strong></p>
<p><img alt="X25712-091321" src="../_images/cgl1631062304607_LowRes.png" /></p>
</div>
<div class="section" id="switchdev-mode">
<h3>4.1.2 Switchdev Mode<a class="headerlink" href="#switchdev-mode" title="Permalink to this heading">¶</a></h3>
<p>When changed to the switchdev mode, the U25N can support OVS switching. Devlink features are added to the PF0 interface in each adapter to support the switch mode. Switchdev mode can be added for a single adapter or both. A new representor network interface comes up for each VF when a VM is connected to the VF via SR-IOV virtual ports provided by X2 VNICs.</p>
<p><em>Figure 6:</em> <strong>Switchdev Mode</strong></p>
<p><img alt="X25549-091321" src="../_images/lpe1631063727073_LowRes.png" /></p>
</div>
</div>
<div class="section" id="ovs">
<h2>4.2 OVS<a class="headerlink" href="#ovs" title="Permalink to this heading">¶</a></h2>
<div class="section" id="installing-ovs">
<h3>4.2.1 Installing OVS<a class="headerlink" href="#installing-ovs" title="Permalink to this heading">¶</a></h3>
<p>OVS is a multilayer software switch licensed under the open source Apache 2 license. It implements a production quality switch platform that supports standard management interfaces and opens the forwarding functions to programmatic extension and control. OVS is well suited to function as a virtual switch in virtualized environments.
Follow the below-mentioned steps to install OVS.</p>
<ol>
<li><p>The OVS source code is available in its Git repository, which  can be cloned into a directory named “ovs” using the git clone command (see <a class="reference external" href="https://github.com/openvswitch/ovs.git">https://github.com/openvswitch/ovs.git</a>).</p></li>
<li><p>After cloning, the ovs directory will be in the current directory path. “cd” to the ovs directory as mentioned below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ovs
</pre></div>
</div>
</li>
<li><p>Execute the following commands sequentially as the root user:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./boot.sh
./configure
make -j8
make install
</pre></div>
</div>
</li>
<li><p>Export the OVS path:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/share/openvswitch/scripts
</pre></div>
</div>
</li>
<li><p>Perform a version check:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vswitchd --version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Version 2.12 and 2.14 have been tested.</p>
</li>
</ol>
<p>Maximum flows supported and tested: 8k</p>
</div>
<div class="section" id="classification-fields-matches">
<h3>4.2.2 Classification Fields (Matches)<a class="headerlink" href="#classification-fields-matches" title="Permalink to this heading">¶</a></h3>
<p>Supported Keys and Actions</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Keys

<span class="m">1</span>. ipv4/ipv6 src_ip

<span class="m">2</span>. ipv4/ipv6 dst_ip

<span class="m">3</span>. ip_tos

<span class="m">4</span>. ip_proto

<span class="m">5</span>. ovlan Outer

<span class="m">6</span>. ivlan Inner

<span class="m">7</span>. ether_type

<span class="m">8</span>. tcp/udp src_port

<span class="m">9</span>. tcp/udp dst_port

<span class="m">10</span>. src_mac

<span class="m">11</span>. dst_mac

<span class="m">12</span>. vni

<span class="m">13</span>. Ingress port

Actions

<span class="m">1</span>. do_decap

<span class="m">2</span>. do_decr_ip_ttl

<span class="m">3</span>. do_src_mac

<span class="m">4</span>. do_dst_mac

<span class="m">5</span>. do_vlan_pop

<span class="m">6</span>. do_vlan_push

<span class="m">7</span>. do_encap

<span class="m">8</span>. do_deliver
</pre></div>
</div>
</div>
<div class="section" id="port-to-port">
<h3>4.2.3 Port to Port<a class="headerlink" href="#port-to-port" title="Permalink to this heading">¶</a></h3>
<p>In this configuration the U25N PF is added to the OVS bridge as an interface. Packets are sent to an external MAC, and OVS performs the switching based on the packets received.</p>
<p><em>Figure 7:</em> <strong>Port to Port setup</strong></p>
<p><img alt="X25550-090721 this seems messed up and missing a portion" src="../_images/cfd1631064119641_LowRes.png" /></p>
<p>Step 1. Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p>
<p>Step 2. In case the U25N driver version is 5.3.3.1008.3,this step can be ignored. Driver version of the U25N interface can be validated using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i U25_eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to U25N Driver installation section.</p>
<p>Step 3. Put both U25N PF interfaces in ready state by executing the following command:</p>
<ol>
<li><p>List the interfaces using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command.</p></li>
<li><p>Search for U25N interfaces using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfboot --list <span class="c1"># shows the U25n interfaces</span>
ifconfig &lt;u25n_interface&gt; up
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig U25_eth0 up
ifconfig U25_eth1 up
</pre></div>
</div>
</li>
</ol>
<p>Step 4. Put the U25N PF interfaces into switchdev mode by executing the following command:</p>
<p><strong><em>Note</em>:</strong> Ensure that the PF interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives us the PCIe® device bus ID required to execute the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode switchdev
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.1 mode switchdev
</pre></div>
</div>
<p>Step 5. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, continue with the next step.</p>
<p>Step 6. Add external ports to the OVS bridge by executing the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 &lt;PF interface&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 U25_eth0
ovs-vsctl add-port br0 U25_eth1
</pre></div>
</div>
<p>Step 7. Prints a brief overview of the database contents using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
<p>Refer to <a class="reference external" href="./ug1534-detailedappsdescriptions.html#functionality-check">Functionality Check</a> to check the OVS functionality.</p>
</div>
<div class="section" id="port-to-vm-or-vm-to-port">
<h3>4.2.4 Port to VM or VM to Port<a class="headerlink" href="#port-to-vm-or-vm-to-port" title="Permalink to this heading">¶</a></h3>
<p><strong><em>Note</em>:</strong> To have this configuration SR-IOV must be enabled in BIOS. For the Port to VM or VM to Port configuration, a tunnel L2GRE or VXLAN could be created with two server setups.</p>
<p><em>Figure 8:</em> <strong>Port to VM or VM to Port setup</strong>
<img alt="seems messed up a little bit X25551-090721" src="../_images/cgm1631064433686_LowRes.png" /></p>
<p>Step 1. Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version. For VM use cases, VFs need to be created for the corresponding PF for binding to the VM. The number of VF counts should be configured in the sfboot command and in sriov_numvfs.</p>
<p><strong><em>Note</em>:</strong> For more information, refer to <a class="reference external" href="./ug1534-installation.html#sfboot-configuration">sfboot Configuration</a>.</p>
<p>Step 2. Check the driver version of the U25N interface using the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N driver version is 5.3.3.1008.3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i U25_eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
<p><strong><em>Note</em>:</strong> Refer to <a class="reference external" href="./ug1534-installation.html#deployment-image-flashing">Deployment Image Flashing</a> for flashing images to check OVS functionality.</p>
<p>Step 3. Ensure that U25N PF interfaces are up by running the following commands:</p>
<p>a. List the PF interface using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command.</p>
<p>b. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i &lt;U25_eth0&gt;
</pre></div>
</div>
<p>driver: sfc</p>
<p>version: 5.3.3.1008.3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;U25_interface&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig U25eth0 up
</pre></div>
</div>
<p>Step 4. Enable desired VFs to the U25N PF. In the following command, a single VF is enabled on the PF0 interface:</p>
<p><strong><em>Note</em>:</strong> The VF could also be created on the PF1 interface based on the use case. The sriov_numvfs count should be less than or equal to the VF count specified in the sfboot command. The sriov_numvfs should be enabled only in legacy mode. To check the U25N mode, excecute the following steps.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch show pci/0000:&lt;pci_id&gt;
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pci/0000:af:00.0 mode legacy
</pre></div>
</div>
<p>If not in legacy mode, change to legacy mode using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode legacy
<span class="nb">echo</span> <span class="m">1</span> &gt; /sys/class/net/&lt;interface&gt;/device/sriov_numvfs
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">1</span> &gt; sys/class/net/U25_eth0/device/sriov_numvfs
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> After executing above mentioned command, a VF PCIe ID and VF interface will get created. The VF PCIe device ID can be listed with the command <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d</span> <span class="pre">1924:1b03</span></code>.</p>
<p>An example of the device ID is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>af:00.2 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>Virtual Function<span class="o">)</span> <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>. 
This VF PCIe ID is used <span class="k">for</span> binding the VF to a VM.
</pre></div>
</div>
<p>Step 5. The VF interface can be found using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. To differentiate VF from PF, use the ip link show command. This gives the VF interface ID and VF interface mac address under the PF interface.</p>
<p>Step 6. Ensure that the VF interface is up by executing the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   ifconfig &lt;vf_interface&gt; up
</pre></div>
</div>
<p>Step 7. Ensure that the PF interface is in switchdev mode by executing the following command:</p>
<p><strong><em>Note</em>:</strong> Ensure the PF interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode switchdev
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">devlink</span> <span class="pre">dev</span> <span class="pre">eswitch</span> <span class="pre">set</span> <span class="pre">pci/0000:af:00.0</span> <span class="pre">mode</span> <span class="pre">switchdev</span></code>.</p>
<p>Step 8. Running the above command creates a VF representor interface. The VF representor interface name will be the PF interface name followed by <code class="docutils literal notranslate"><span class="pre">_0</span></code> for the first VF representor and <code class="docutils literal notranslate"><span class="pre">_1</span></code> for the second V representor, and so on.</p>
<p>**<em>Note</em>:**The total number of VF representor interfaces created are based on the sriov_numvfs value configured.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link show <span class="p">|</span> grep &lt;PF_interface&gt;
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">show</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&lt;u25eth0&gt;</span></code>.</p>
<p><strong><em>Note</em>:</strong> Here u25eth0 is the PF interface and u25eth0_0 is the VF representor interface.</p>
<p>Now make the VF representor interface up using the ifconfig command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;vf_rep_interface&gt; up
</pre></div>
</div>
<p>Step 9. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p>
<p>Step 10. Add PF interfaces as ports to the OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ovs-vsctl add-port br0 &lt;x2 interface&gt;
```

For example, `ovs-vsctl add-port br0 U25eth0`.
</pre></div>
</div>
<p>Step 11. Add a VF representor interface as a port to the OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ovs-vsctl add-port &lt;bridge-name&gt; &lt;VF rep interface&gt;
```

For example, `ovs-vsctl add-port br0 U25eth0_0`.
</pre></div>
</div>
<p>Step 12. Ensure that the the OVS bridge is up by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ifconfig &lt;bridge-name&gt; up
```
</pre></div>
</div>
<p>Step 13. Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ovs-vsctl show
```
</pre></div>
</div>
<p>Step 14. Refer <a class="reference external" href="./ug1534-vminstall.html#vm-installation">VM Installation</a> to instantiate the VM. Post successful instantiation follow the Step 15 to validate its functionality.</p>
<p>Step 15. Refer to <a class="reference external" href="./ug1534-detailedappsdescriptions.html#functionality-check">Functionality Check</a> to check OVS functionality.</p>
</div>
<div class="section" id="vm-to-vm">
<h3>VM to VM<a class="headerlink" href="#vm-to-vm" title="Permalink to this heading">¶</a></h3>
<p><strong><em>Note</em>:</strong> To have this configuration SR-IOV must be enabled in BIOS. For a VM to VM configuration, a tunnel- VXLAN or L2GRE could be created with two server setups.</p>
<p><em>Figure 9:</em> <strong>VM to VM setup</strong></p>
<p><img alt="seems messed up a little bit X25551-090721" src="../_images/cxa1631064658045_LowRes.png" /></p>
<p>Step 1. Refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a> for the required OS/software version. For VM use cases, VFs need to be enabled on the corresponding PF and should be bound to the VM. The desired number VFs counts should be configured using sfboot command and in sriov_numvfs. Offload will happen between VMs created using same the PF’s VF.</p>
<p><strong><em>Note</em>:</strong> For more information, refer to sfboot Configuration.</p>
<p>Step 2. Validate the driver version of the U25N interface using the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N driver version is 5.3.3.1008.3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i U25_eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
<p><strong><em>Note</em>:</strong> Refer  <a class="reference external" href="./ug1534-installation.html#deployment-image-flashing">Deployment Image Flashing</a> for flashing images to check OVS functionality.</p>
<p>Step 3. Make the U25N X2 PF interface up:</p>
<ol>
<li><p>List the PF interface using the ifconfig -a command.</p></li>
<li><p>Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i &lt;U25_eth0&gt;
</pre></div>
</div>
<p>driver: sfc</p>
<p>version: 5.3.3.1008.3</p>
<p><code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">&lt;U25_interface&gt;</span> <span class="pre">up</span></code></p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig U25eth0 up
</pre></div>
</div>
</li>
</ol>
<p>Step 4. Enable the desired VFs on the corresponding PF. In this following commands, two VFs are enabled the PF0 interface:</p>
<p><strong><em>Note</em>:</strong> The VF could also be enabled in the PF1 interface based on the use case. The sriov_numvfs count should be less than or equal to the VF count specified in the sfboot command. The sriov_numvfs should be enabled only in legacy mode. To validate the U25N mode, execute the following steps.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch show pci/0000:&lt;pci_id&gt;
</pre></div>
</div>
<p>The output of the above command would be:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pci/0000:af:00.0 mode legacy
</pre></div>
</div>
<p>In case it is not in legacy mode, change it to legacy mode using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode legacy
<span class="nb">echo</span> <span class="m">2</span> &gt; /sys/class/net/&lt;interface&gt;/device/sriov_numvfs
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">1</span> /sys/class/net/U25_eth0/device/sriov_numvfs
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Post executing the above mentioned command, two VF PCIe IDs and two VF interfaces are created. The VF PCIe device ID can be listed with the <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d</span> <span class="pre">1924:1b03</span></code> command. An example of the device ID is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   af:00.2 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>Virtual Function<span class="o">)</span> <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>* and *af:00.3 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>Virtual Function<span class="o">)</span> <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>*.
These VF PCIe IDs will be used <span class="k">for</span> binding VFs to VMs.
</pre></div>
</div>
<p>Step 5. The two VF interfaces can be found using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. To differentiate VF from PF, use the <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">show</span></code> command. This gives the VF interface ID and VF interface mac address under the PF interface.</p>
<p>Step 6. Ensure that the two VF interfaces are up by executing the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;vf_interfaceup&gt;
</pre></div>
</div>
<p>Step 7. Ensure that the PF interfaces are in switchdev mode by executing the following command.</p>
<p><strong><em>Note</em>:</strong> Ensure the PF interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode switchdev
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">devlink</span> <span class="pre">dev</span> <span class="pre">eswitch</span> <span class="pre">set</span> <span class="pre">pci/0000:af:00.0</span> <span class="pre">mode</span> <span class="pre">switchdev</span></code>.</p>
<p>Step 8. Execution of above mentioned command results in the creation of two VF representor interfaces. The VF representor interface name will have PF interface name followed by <code class="docutils literal notranslate"><span class="pre">_0</span></code> for the first VF representor and <code class="docutils literal notranslate"><span class="pre">_1</span></code> for the second VF representor and so on and so forth.</p>
<p><strong><em>Note</em>:</strong> The number of VF representor interfaces created are based on the sriov_numvfs value configured.</p>
<p>ip link show | grep &lt;PF_interface&gt;</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">&lt;ip</span> <span class="pre">link</span> <span class="pre">show</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&lt;u25eth0&gt;</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>u25eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc mq state UP
mode DEFAULT group default qlen <span class="m">1000</span>
u25eth0_0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel
master ovs-system state UP mode DEFAULT group default qlen <span class="m">1000</span>
u25eth0_1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel
master ovs-system state UP mode DEFAULT group default qlen <span class="m">1000</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Here u25eth0 is the PF interface, and u25eth0_0 and u25eth0_1 are the VF representor interfaces.</p>
<p>Now make the VF representor interfaces up using the ifconfig command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;vf_rep_interface&gt; up
</pre></div>
</div>
<p>Step 9. Follow the steps mentioned in OVS Configuration to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p>
<p>Step 10. Add two VF representor interfaces to the OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ovs-vsctl add-port &lt;bridge-name&gt; &lt;VF rep interface 1&gt;
ovs-vsctl add-port &lt;bridge-name&gt; &lt;VF rep interface 2&gt;
```

For example:

```
ovs-vsctl add-port br0 u25eth0_0
ovs-vsctl add-port br0 u25eth0_1
```
</pre></div>
</div>
<p>Step 11. Make the OVS bridge up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ifconfig &lt;bridge-name&gt; up
```
</pre></div>
</div>
<p>Step 12. Print the brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ovs-vsctl show
```
</pre></div>
</div>
<p>Step 13. Refer <a class="reference internal" href="ug1534-vminstall.html"><span class="doc">VM Installation</span></a> to instantiate the VM. Post VM instantiation, proceed to the next step to validate the functionality.</p>
<p>Step 14. Refer [Functionality Check(link)] to validate OVS functionality.</p>
</div>
<div class="section" id="tunnels-encapsulation-decapsulation">
<h3>4.2.6 Tunnels (Encapsulation/Decapsulation)<a class="headerlink" href="#tunnels-encapsulation-decapsulation" title="Permalink to this heading">¶</a></h3>
<p>U25N Smart NIC supports offloading of tunnels using encapsulation and decapsulation actions.</p>
<ul class="simple">
<li><p><strong>Encapsulation:</strong> Pushing tunnel header is supported on TX</p></li>
<li><p><strong>Decapsulation:</strong> Stripping tunnel header is supported on RX</p></li>
</ul>
<p>Supported tunnels:</p>
<ul class="simple">
<li><p>VXLAN</p></li>
<li><p>L2GRE</p></li>
</ul>
<div class="section" id="l2gre">
<h4>L2GRE<a class="headerlink" href="#l2gre" title="Permalink to this heading">¶</a></h4>
<p><strong><em>Note</em>:</strong> For Port to VM or VM to Port or VM to VM case, a tunnel could be created with two server setup. The following section demonstrates creating a L2GRE based tunnel.</p>
<ul class="simple">
<li><p>Maximum tunnel support = 1K</p></li>
<li><p>Maximum supported flows = 8K</p></li>
<li><p>Maximum MTU size = 1400</p></li>
</ul>
<p>Refer <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version. An L2GRE tunnel can be formed between two servers. Tunnel endpoint IP should be added to the PF interface which acts as a origin of the tunnel.</p>
<p><strong><em>Note</em>:</strong> Two tunnels could be formed between two PFs of U25N SmartNICs for two different servers for the VM to VM case.</p>
<p><em>Figure 10:</em> <strong>L2GRE End to End setup with OVS functionality</strong></p>
<p><img alt="X25553-091321" src="../_images/idz1631575855541_LowRes.png" /></p>
<div class="section" id="server-1-configuration">
<h5><strong>Server 1 Configuration</strong><a class="headerlink" href="#server-1-configuration" title="Permalink to this heading">¶</a></h5>
<p>Step 1. Validate the driver version of the U25N interface by executing the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N driver version is 5.3.3.1008.3.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i U25_eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to U25N Driver Installation section.</p>
<p><strong><em>Note</em>:</strong> Refer Deployment Image Flashing for flashing images and to validate OVS functionality.</p>
<p>Step 2. Ensure that the U25N PF interfaces are up:</p>
<p>List the PF interfaces using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i &lt;U25_eth0&gt;
</pre></div>
</div>
<p>driver: sfc</p>
<p>version: 5.3.3.1008.3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;U25_interface&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig U25eth0 up
ifconfig U25eth1 up
</pre></div>
</div>
<p>Step 3. Assign tunnel IP to PF0 interface by executing following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;interface_1&gt; &lt;ip&gt; up
</pre></div>
</div>
<p>For example, ifconfig U25eth0 10.16.0.2/24 up.</p>
<p>Step 4. Ensure that the PF0 interface is in switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode switchdev
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
</pre></div>
</div>
<p>Step 5. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p>
<p>Step 6. Create GRE interfaces bby executing following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge_name&gt; gre0 -- <span class="nb">set</span> interface gre0 <span class="nv">type</span><span class="o">=</span>gre
options:local_ip<span class="o">=</span>&lt;ip_address&gt; options:remote_ip<span class="o">=</span>&lt;ip_address&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 gre0 -- <span class="nb">set</span> interface gre0 <span class="nv">type</span><span class="o">=</span>gre
options:local_ip<span class="o">=</span><span class="m">10</span>.16.0.2 options:remote_ip<span class="o">=</span><span class="m">10</span>.16.0.1
</pre></div>
</div>
<p>Step 7. Add a PF1 interface as a port to the OVS bridge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge-name&gt; &lt;U25N interface_2&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 U25eth1
</pre></div>
</div>
<p>Step 8. Ensue the OVS bridge is up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;bridge_name&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig br0 up
</pre></div>
</div>
<p>Step 9. Print a brief overview of the database contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
</div>
<div class="section" id="server-2-configuration">
<h5>Server 2 Configuration<a class="headerlink" href="#server-2-configuration" title="Permalink to this heading">¶</a></h5>
<p>Step 1. Check the driver version of the U25N interface using this command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N X2 driver version is 5.3.3.1008.3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i U25_eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a> installation section.</p>
<p>Step 2. Ensure that U25N PF interfaces are up:</p>
<p>List the PF interfaces using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i &lt;U25_eth0&gt;
</pre></div>
</div>
<p>driver: sfc</p>
<p>version: 5.3.3.1000</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;U25_interface&gt; up
</pre></div>
</div>
<p>For example:</p>
<p>Step 3. Assign tunnel IP to PF0 interface by executing the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;interface_1&gt; &lt;ip&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig U25eth0 <span class="m">10</span>.16.0.1/24 up
</pre></div>
</div>
<p>Step 4. Ensure that PF0 interface is in switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode switchdev
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
</pre></div>
</div>
<p>Step 5. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p>
<p>Step 6. Create GRE interfaces:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge_name&gt; gre0 -- <span class="nb">set</span> interface gre0 <span class="nv">type</span><span class="o">=</span>gre
options:local_ip<span class="o">=</span>&lt;ip_address&gt; options:remote_ip<span class="o">=</span>&lt;ip_address&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 gre0 -- <span class="nb">set</span> interface gre0 <span class="nv">type</span><span class="o">=</span>gre
options:local_ip<span class="o">=</span><span class="m">10</span>.16.0.1 options:remote_ip<span class="o">=</span><span class="m">10</span>.16.0.2
</pre></div>
</div>
<p>Step 7. Add a PF1 interface as a port to the OVS bridge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge_name&gt; &lt;U25N interface_2&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 U25eth1
</pre></div>
</div>
<p>Step 8. Ensure that the bridge up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;bridge_name&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig br0 up
</pre></div>
</div>
<p>STep 9. Print a brief overview of the database contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
<p>Step 10. Refer <a class="reference external" href="./ug1534-detailedappsdescriptions.html#functionality-check">Functionality Check</a> to check OVS functionality.</p>
</div>
</div>
<div class="section" id="vxlan">
<h4>4.2.6.2 VXLAN<a class="headerlink" href="#vxlan" title="Permalink to this heading">¶</a></h4>
<p><strong><em>Note</em>:</strong> For Port to VM or VM to Port or VM to VM configuration, a tunnel could be created with two server setups. The following section demonstrates creating a  VXLAN based tunnel.</p>
<ul class="simple">
<li><p>Maximum tunnel support = 1K</p></li>
<li><p>Maximum supported flows = 8K</p></li>
<li><p>Maximum MTU size = 1400</p></li>
</ul>
<p>Refer  <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version. A VXLAN tunnel can be formed between two servers. Tunnel endpoint IP should be added to the PF interface where the tunnel needs to be created.</p>
<p><em>Figure 11:</em> <strong>VXLAN</strong></p>
<p><img alt="X25554-091321" src="../_images/rcv1631576075856_LowRes.png" /></p>
<div class="section" id="id1">
<h5>Server 1 Configuration<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h5>
<p>Step 1. Validate the driver version of the U25N interface using this command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N X2 driver version is 5.3.3.1008.3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i U25_eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
<p><strong><em>Note</em>:</strong> Refer to Deployment Image Flashing for flashing images to check OVS functionality.</p>
<p>Step 2. Ensure that the the U25N PF interfaces are up:</p>
<p>List the PF interfaces using the ifconfig -a command. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i &lt;U25_eth0&gt;
</pre></div>
</div>
<p>driver: sfc</p>
<p>version: 5.3.3.1008.3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;U25_interface&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig U25eth0 up
ifconfig U25eth1 up
</pre></div>
</div>
<p>Step 3. Assign tunnel IP to PF0 interface:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;interface_1&gt; &lt;ip&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig U25eth0 <span class="m">10</span>.16.0.2/24 up
</pre></div>
</div>
<p>Step 4. Ensure that PF0 interface is in switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode switchdev
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">devlink</span> <span class="pre">dev</span> <span class="pre">eswitch</span> <span class="pre">set</span> <span class="pre">pci/0000:af:00.0</span> <span class="pre">mode</span> <span class="pre">switchdev</span></code>.</p>
<p>Step 5. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. Post OVS bridge creation, proceed to the next step.</p>
<p>Step 6. Create VXLAN interfaces:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 vxlan0 -- <span class="nb">set</span> interface vxlan0 <span class="nv">type</span><span class="o">=</span>vxlan
options:local_ip<span class="o">=</span>&lt;ip_address&gt; options:remote_ip<span class="o">=</span>&lt;ip_address&gt;
options:key<span class="o">=</span>&lt;key_id&gt;
ovs-vsctl add-port br0 vxlan0 -- <span class="nb">set</span> interface vxlan0 <span class="nv">type</span><span class="o">=</span>vxlan
options:local_ip<span class="o">=</span><span class="m">10</span>.16.0.2 options:remote_ip<span class="o">=</span><span class="m">10</span>.16.0.1 options:key<span class="o">=</span><span class="m">123</span>
</pre></div>
</div>
<p>Step 7. Add a PF1 interface as a port to the OVS bridge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge-name&gt; &lt;U25N interface_2&gt;
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ovs-vsctl</span> <span class="pre">add-port</span> <span class="pre">br0</span> <span class="pre">U25eth1</span></code>.</p>
<p>Step 8. Ensure that the bridge is up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;bridge_name&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig br0 up
</pre></div>
</div>
<p>Step 9. Print a brief overview of the database contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Server 2 Configuration<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h5>
<p>Step 1. Check the driver version of the U25N X2 interface using this command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N driver version is 5.3.3.1008.3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i U25_eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p>This should give the output as version 5.3.3.1008.3</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to U25N Driver.</p>
<p>Step 2. Ensure that the U25N PF interfaces are up:</p>
<p>List the PF interfaces using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i &lt;U25_eth0&gt;
</pre></div>
</div>
<p>driver: sfc</p>
<p>version: 5.3.3.1008.3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;U25_interface&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig U25eth0 up
ifconfig U25eth1 up
</pre></div>
</div>
<p>Step 3. Assign tunnel IP to PF0 interface:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;interface_1&gt; &lt;ip&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig U25eth0 <span class="m">10</span>.16.0.1/24 up
</pre></div>
</div>
<p>Step 4. Ensure that PF0 interface is in switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode switchdev
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
</pre></div>
</div>
<p>Step 5. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p>
<p>Step 6. Create VXLAN interfaces:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 vxlan0 -- <span class="nb">set</span> interface vxlan0 <span class="nv">type</span><span class="o">=</span>vxlan
options:local_ip<span class="o">=</span>&lt;ip_address&gt; options:remote_ip<span class="o">=</span>&lt;ip_address&gt;
options:key<span class="o">=</span>&lt;key_id&gt;
ovs-vsctl add-port br0 vxlan0 -- <span class="nb">set</span> interface vxlan0 <span class="nv">type</span><span class="o">=</span>vxlan
options:local_ip<span class="o">=</span><span class="m">10</span>.16.0.1 options:remote_ip<span class="o">=</span><span class="m">10</span>.16.0.2 options:key<span class="o">=</span><span class="m">123</span>
</pre></div>
</div>
<p>Step 7. Add a PF1 interface as a port to the OVS bridge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge_name&gt; &lt;U25N interface_2&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 U25eth1
</pre></div>
</div>
<p>Step 8. Ensure the bridge is up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;bridge_name&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig br0 up
</pre></div>
</div>
<p>Step 9. Print a brief overview of the database contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
<p>STep 10. Refer to <a class="reference external" href="./ug1534-detailedappsdescriptions.html#functionality-check">Functionality Check</a> to check OVS functionality.</p>
</div>
</div>
<div class="section" id="vm-to-vm-or-vm-to-port-or-port-to-vm-tunnel">
<h4>4.2.6.3 VM to VM or VM to Port or Port to VM Tunnel<a class="headerlink" href="#vm-to-vm-or-vm-to-port-or-port-to-vm-tunnel" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Maximum tunnel support = 1K</p></li>
<li><p>Maximum supported flows = 8K</p></li>
<li><p>Maximum MTU size = 1400</p></li>
</ul>
<p>Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a>. A VXLAN tunnel can be created between two servers. Tunnel endpoint IP should be added to the PF interface whcih acts as the starting point of the tunnel.</p>
<p><em>Figure 12:</em> <strong>Tunneling/Detunneling setup</strong></p>
<p><img alt="X25696-090721" src="../_images/ash1631066523492_LowRes.png" /></p>
<div class="section" id="id3">
<h5>Server 1 Configuration<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h5>
<p>Step 1. Check the driver version of the U25N interface using this command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N X2 driver version is 5.3.3.1008.3</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
<p><strong><em>Note</em>:</strong> Refer to <a class="reference external" href="./ug1534-installation.html#deployment-image-flashing">Deployment Image Flashing</a> for flashing images to check OVS functionality.</p>
<p>Step 2. Ensure that the U25N PF interfaces are up:</p>
<p>List the PF interfaces using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">U25_eth0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Driver: sfc</p>
<p>Version: 5.3.3.1008.3</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">U25_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25eth0</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="n">U25eth1</span> <span class="n">up</span>
</pre></div>
</div>
<p>Step 3. Assign tunnel IP to PF0 and PF1 interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_2</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_2</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>Step 4. Enable the desired the number of VF on the corresponding PF. Here, a single VF is enabled on each PF0 and PF1 interfaces:</p>
<p><strong><em>Note</em>:</strong> The sriov_numvfs count should be less than or equal to VF count specified in sfboot command. The sriov_numvfs should be enabled only in legacy mode. To validate U25N mode, please follow the below steps.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch show pci/0000:&lt;pci_id&gt;
</pre></div>
</div>
<p>The output of the above command would be:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pci/0000:af:00.0 mode legacy
</pre></div>
</div>
<p>If not in legacy mode, change it to legacy mode using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode legacy
<span class="nb">echo</span> <span class="m">1</span> &gt; /sys/class/net/&lt;interface&gt;/device/sriov_numvfs
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">1</span> &gt; /sys/class/net/U25_eth0/device/sriov_numvfs
<span class="nb">echo</span> <span class="m">1</span> &gt; /sys/class/net/U25_eth1/device/sriov_numvfs
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Post executing the above mentioned command, a VF PCIe ID and a VF interface will get created corresponding to each PF0 and PF1.
The VF PCIe device ID can be listed with the <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d</span> <span class="pre">1924:1b03</span></code> command. An example of the device ID is
<code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">af:00.2</span> <span class="pre">Ethernet</span> <span class="pre">controller:</span> <span class="pre">Solarflare</span> <span class="pre">Communications</span> <span class="pre">XtremeScale</span> <span class="pre">SFC9250</span> <span class="pre">10/25/40/50/100G</span> <span class="pre">Ethernet</span> <span class="pre">Controller</span> <span class="pre">(Virtual</span> <span class="pre">Function)</span> <span class="pre">(rev</span> <span class="pre">01)</span> <span class="pre">and</span> <span class="pre">af:00.6</span> <span class="pre">Ethernet</span> <span class="pre">controller:</span> <span class="pre">Solarflare</span> <span class="pre">Communications</span> <span class="pre">XtremeScale</span> <span class="pre">SFC9250</span> <span class="pre">10/25/40/50/100G</span> <span class="pre">Ethernet</span> <span class="pre">Controller</span> <span class="pre">(Virtual</span> <span class="pre">Function)</span> <span class="pre">(rev</span> <span class="pre">01).</span> <span class="pre">These</span> <span class="pre">VF</span> <span class="pre">PCIe</span> <span class="pre">IDs</span> <span class="pre">would</span> <span class="pre">be</span> <span class="pre">used</span> <span class="pre">for</span> <span class="pre">binding</span> <span class="pre">VFs</span> <span class="pre">to</span> <span class="pre">VMs.</span> </code>bash</p>
<p>Step 5. The two VF interfaces can be found using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. To differentiate VF from PF, use the <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">show</span></code> command. This gives the VF interface ID and VF interface mac address under the PF interface.</p>
<p>Step 6. Ensure that the two VF interfaces up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;vf_interface&gt; up
</pre></div>
</div>
<p>Step 7. Ensure that the PF0 and PF1 interfaces are in switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 and PF1 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode switchdev
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.1 mode switchdev
</pre></div>
</div>
<p>Step 8. Post execution of the above mentioned command a VF representor interface corresponding to each PF interface will get created. The VF representor interface name will have PF interface name followed by <code class="docutils literal notranslate"><span class="pre">_0</span></code>.</p>
<p><strong><em>Note</em>:</strong> Here, the number of VF representors created are based on the sriov_numvfs value configured.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link show <span class="p">|</span> grep &lt;PF_interface&gt;
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">show</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&lt;u25eth0&gt;</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>u25eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc mq state UP
mode DEFAULT group default qlen <span class="m">1000</span>
u25eth0_0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel
master ovs-system state UP mode DEFAULT group default qlen <span class="m">1000</span>
ip link show <span class="p">|</span> grep &lt;u25eth1&gt;
u25eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc mq state UP
mode DEFAULT group default qlen <span class="m">1000</span>
u25eth1_0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel
master ovs-system state UP mode DEFAULT group default qlen <span class="m">1000</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Here u25eth0 and u25eth1 are the PF interfaces, and u25eth0_0 and u25eth1_0 are the VF representor interfaces.</p>
<p>Now make the VF representor interfaces up using the ifconfig command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;vf_rep_interface&gt; up
</pre></div>
</div>
<p>Step 9. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p>
<p>Step 10. Creating VXLAN/GRE interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>***Note*:** The following configuration is for the VXLAN. Similarly, the GRE tunnel could also be used.

```bash
ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan
options:local_ip=&lt;ip_address&gt; options:remote_ip=&lt;ip_address&gt;
options:key=&lt;key_id&gt;
ovs-vsctl add-port br1 vxlan1 -- set interface vxlan0 type=vxlan
options:local_ip=&lt;ip_address&gt; options:remote_ip=&lt;ip_address&gt;
options:key=&lt;key_id&gt;
```

For example:

```bash
ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan
options:local_ip=10.16.0.2 options:remote_ip=10.16.0.1 options:key=123
ovs-vsctl add-port br1 vxlan1 -- set interface vxlan type=vxlan
options:local_ip=10.16.0.3 options:remote_ip=10.16.0.4 options:key=456
```
</pre></div>
</div>
<p>Step 11. Execute the following command to add VF representor enabled on each PF interface to a separate OVS bridge.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ovs-vsctl add-port &lt;bridge-name_0&gt; &lt;VF rep interface 1&gt;
ovs-vsctl add-port &lt;bridge-name_1&gt; &lt;VF rep interface 2&gt;
```

For example:

```bash
ovs-vsctl add-port br0 u25eth0_0
ovs-vsctl add-port br1 u25eth1_0
```
</pre></div>
</div>
<p>Step 12. Ensure the the two bridges are up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ifconfig &lt;bridge_name&gt; up
```

For example:

```bash
ifconfig br0 up
ifconfig br1 up
```
</pre></div>
</div>
<p>Step 13. Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ovs-vsctl show
```
</pre></div>
</div>
<p>Step 14. Refer <a class="reference internal" href="ug1534-vminstall.html"><span class="doc">VM Installation</span></a> to instantiate the VM.</p>
</div>
<div class="section" id="id4">
<h5>Server 2 Configuration<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h5>
<p>Step 1. Check the driver version of the U25N interface using this command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N X2 driver version is 5.3.3.1008.3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i U25_eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p>This should give the output as version 5.3.3.1008.3</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
<p><strong><em>Note</em>:</strong> Refer <a class="reference external" href="./ug1534-installation.html#deployment-image-flashing">Deployment Image Flashing</a> for flashing images to check OVS functionality.</p>
<p>Step 2. Ensure that U25N PF interfaces are up:</p>
<p>List the PF interfaces using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code>command.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i &lt;U25_eth0&gt;
</pre></div>
</div>
<p>Driver: sfc</p>
<p>Version: 5.3.3.1008.3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;U25_interface&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig U25eth0 up
ifconfig U25eth1 up
</pre></div>
</div>
<p>Step 3. Assign tunnel IP to PF0 and PF1 interfaces:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;interface_1&gt; &lt;ip&gt; up
ifconfig &lt;interface_2&gt; &lt;ip&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig U25eth0 <span class="m">10</span>.16.0.1/24 up
ifconfig U25eth1 <span class="m">10</span>.16.0.4/24 up
</pre></div>
</div>
<p>Step 4. Enable the desired number of VFs to the corresponding PF. Here, one VF is enabled on each PF0 and PF1 interface:</p>
<p><strong><em>Note</em>:</strong> The sriov_numvfs count should be less than or equal to VF count assigned in sfboot command. The sriov_numvfs should be enabled only in legacy mode. To validate mode, please follow the below steps.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch show pci/0000:&lt;pci_id&gt;
</pre></div>
</div>
<p>The output of the above command would be:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pci/0000:af:00.0 mode legacy
</pre></div>
</div>
<p>In case not in legacy mode, change it to legacy mode using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode legacy
<span class="nb">echo</span> <span class="m">1</span> &gt; /sys/class/net/&lt;interface&gt;/device/sriov_numvfs
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">1</span> &gt; /sys/class/net/U25_eth0/device/sriov_numvfs
<span class="nb">echo</span> <span class="m">1</span> &gt; /sys/class/net/U25_eth1/device/sriov_numvfs
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Post execution of the above mentioned command, a VF PCIe ID and a VF interface will get created corresponding to each PF0 and PF1. The VF PCIe device ID can be listed with the <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d</span> <span class="pre">1924:1b03</span></code> command. An example of the device ID is af:00.2 Ethernet controller: Solarflare Communications XtremeScale SFC9250 10/25/40/50/100G Ethernet Controller (Virtual Function) (rev 01) and af:00.6 Ethernet controller: Solarflare Communications XtremeScale SFC9250 10/25/40/50/100G Ethernet Controller (Virtual Function) (rev 01). These VF PCIe IDs would be used for binding VFs to VMs.</p>
<p>Step 5. The two VF interfaces can be found using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. To differentiate VF from PF, use the <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">show</span></code> command. This gives the VF interface ID and VF interface mac address under the PF interface.</p>
<p>Step 6. Ensure that two VF interfaces are up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;vf_interface&gt; up
</pre></div>
</div>
<p>Step 7. Ensure that PF0 and PF1 interfaces are in switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 and PF1 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus idm ode switchdev
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.1 mode switchdev
</pre></div>
</div>
<p>Step 8. Running the above command creates a VF representor interface corresponding to each PF interface. The VF representor interface name will have the PF interface name followed by <code class="docutils literal notranslate"><span class="pre">_0</span></code>.</p>
<p><strong><em>Note</em>:</strong> The total number of VF representor created is based on the sriov_numvfs value configured.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link show <span class="p">|</span> grep &lt;PF_interface&gt;
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">show</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&lt;u25eth0&gt;</span></code>.</p>
<p><strong><em>Note</em>:</strong> Here u25eth0 and u25eth1 are the PF interfaces, and u25eth0_0 and u25eth1_0 are the VF representor interfaces.</p>
<p>Ensure the VF representor interfaces are up using the ifconfig command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;vf_rep_interface&gt; up
</pre></div>
</div>
<p>Step 9. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p>
<p>Step 10. Create VXLAN/GRE interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>***Note*:** The following configuration is for the VXLAN. Similarly, the GRE tunnel could also be used.

```
ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan
options:local_ip=&lt;ip_address&gt; options:remote_ip=&lt;ip_address&gt;
options:key=&lt;key_id&gt;
ovs-vsctl add-port br1 vxlan1 -- set interface vxlan0 type=vxlan
options:local_ip=&lt;ip_address&gt; options:remote_ip=&lt;ip_address&gt;
options:key=&lt;key_id&gt;
```

For example:

```
ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan
options:local_ip=10.16.0.1 options:remote_ip=10.16.0.2 options:key=123
ovs-vsctl add-port br1 vxlan1 -- set interface vxlan type=vxlan
options:local_ip=10.16.0.4 options:remote_ip=10.16.0.3 options:key=456
```
</pre></div>
</div>
<p>Step 11. Adding VF representor of each PF interface to separate OVS bridges.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ovs-vsctl add-port &lt;bridge-name_0&gt; &lt;VF rep interface 1&gt;
ovs-vsctl add-port &lt;bridge-name_1&gt; &lt;VF rep interface 2&gt;
```

For example:

```
ovs-vsctl add-port br0 u25eth0_0
ovs-vsctl add-port br1 u25eth1_0
```
</pre></div>
</div>
<p>Step 12. Ensure that the two bridges are up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ifconfig &lt;bridge_name&gt; up
```

For example:

```
ifconfig br0 up
ifconfig br1 up
```
</pre></div>
</div>
<p>Step 13. Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
ovs-vsctl show
```
</pre></div>
</div>
<p>Step 14. Refer to <a class="reference internal" href="ug1534-vminstall.html"><span class="doc">VM Installation</span></a> to instantiate the VM. Post successful instantiation refer <a class="reference external" href="./ug1534-detailedappsdescriptions.html#functionality-check">Functionality Check</a> to validate  functionality.</p>
</div>
</div>
</div>
<div class="section" id="ovs-configuration">
<h3>4.2.7 OVS Configuration<a class="headerlink" href="#ovs-configuration" title="Permalink to this heading">¶</a></h3>
<p>Step 1. Export the OVS path:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export PATH=$PATH:/usr/local/share/openvswitch/scripts
export PATH=$PATH:/usr/local/bin
</pre></div>
</div>
<p>Step 2. Stop OVS and remove any database to get rid of old configurations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">ctl</span> <span class="n">stop</span>
<span class="n">rm</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">openvswitch</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">db</span>
</pre></div>
</div>
<p>Step 3. Start OVS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">ctl</span> <span class="n">start</span>
</pre></div>
</div>
<p>Step 4. Enable hardware offload:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="nb">set</span> <span class="n">Open_vSwitch</span> <span class="o">.</span> <span class="n">other_config</span><span class="p">:</span><span class="n">hw</span><span class="o">-</span><span class="n">offload</span><span class="o">=</span><span class="n">true</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="nb">set</span> <span class="n">Open_vSwitch</span> <span class="o">.</span> <span class="n">other_config</span><span class="p">:</span><span class="n">tc</span><span class="o">-</span><span class="n">policy</span><span class="o">=</span><span class="n">none</span>
</pre></div>
</div>
<p>Step 5. After adding the hardware offload policy, restart OVS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">ctl</span> <span class="n">restart</span>
</pre></div>
</div>
<p>Step 6. Set OVS log levels (for debug purpose only, if needed):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">appctl</span> <span class="n">vlog</span><span class="o">/</span><span class="nb">set</span> <span class="n">ANY</span><span class="p">:</span><span class="n">ANY</span><span class="p">:</span><span class="n">dbg</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">appctl</span> <span class="n">vlog</span><span class="o">/</span><span class="nb">set</span> <span class="n">poll_loop</span><span class="p">:</span><span class="n">ANY</span><span class="p">:</span><span class="n">OFF</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">appctl</span> <span class="n">vlog</span><span class="o">/</span><span class="nb">set</span> <span class="n">netlink_socket</span><span class="p">:</span><span class="n">ANY</span><span class="p">:</span><span class="n">OFF</span>
</pre></div>
</div>
<p>Step 7. Set the maximum time (in ms) that idle flows remain cached in the datapath:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ovs-vsctl set open_vswitch $(ovs-vsctl list open_vswitch | grep _uuid |
cut -f2 -d &quot;:&quot; | tr -d &#39; &#39;) other_config:max-idle=30000000g
</pre></div>
</div>
<p>Step 8. Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
<p>The output should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">git_version</span><span class="o">&gt;</span>
<span class="n">ovs_version</span><span class="p">:</span> <span class="s2">&quot;&lt;ovs_version&gt;&quot;</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> OVS versions 2.12 and 2.14 have been tested.</p>
<p>Step 9. Adding bridge to OVS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">br</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>

<span class="n">For</span> <span class="n">Example</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">br</span> <span class="n">br0</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> For VM to VM or VM to Port or Port to VM Tunnel alone create two OVS bridges. For example, <code class="docutils literal notranslate"><span class="pre">ovs-vsctl</span> <span class="pre">add-br</span> <span class="pre">br0</span></code> and <code class="docutils literal notranslate"><span class="pre">ovs-vsctl</span> <span class="pre">add-br</span> <span class="pre">br1</span></code>.</p>
</div>
<div class="section" id="functionality-check">
<h3>4.2.8 Functionality Check<a class="headerlink" href="#functionality-check" title="Permalink to this heading">¶</a></h3>
<p>After adding the U25N network interfaces to the OVS bridge, the functionality can be verified using ping, iperf, and dpdk network performance tools.</p>
<div class="section" id="ping-test">
<h4>Ping Test<a class="headerlink" href="#ping-test" title="Permalink to this heading">¶</a></h4>
<p>Step 1. Assign the IP address to the respective interface and do a ping using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ping</span> <span class="o">&lt;</span><span class="n">remote_ip</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Step 2. After a successful ping test, iperf can be used:</p>
<p><strong><em>Note</em>:</strong> For VXLAN and L2GRE, set the MTU size to 1400 before
running iperf3 or pktgen on a particular interface.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interfacemtu</span> <span class="mi">1400</span> <span class="p">[</span><span class="k">as</span> <span class="n">root</span><span class="p">]</span>
</pre></div>
</div>
<p>Step 3. Run iperf3 -s on the host device [iperf server].</p>
<p>Step 4. Run iperf3 -c <ip> on a remote device [iperf client].</p>
<p><strong><em>Note</em>:</strong> Refer to <a class="reference external" href="./ug1534-supportedservices.html#dpdk-on-u25n">DPDK on U25N</a> to run dpdk-testpmd.</p>
</div>
</div>
</div>
<div class="section" id="ipsec">
<h2>IPsec<a class="headerlink" href="#ipsec" title="Permalink to this heading">¶</a></h2>
<div class="section" id="supported-xfrm-parameters">
<h3>4.3.1 Supported XFRM Parameters<a class="headerlink" href="#supported-xfrm-parameters" title="Permalink to this heading">¶</a></h3>
<p>IPsec tunnels are created between two servers. Because IPsec is in <em>transport mode</em>, L2GRE is used to create tunnels. The strongSwan application runs in user space. The charon plugin of strongSwan is used to offload rules on the U25N. Packets reaching the IPsec module should be L2GRE encapsulated.</p>
<ul class="simple">
<li><p>Encryption algorithm: AES-GCM 256 encryption/decryption</p></li>
<li><p>IPsec mode: Transport mode.</p></li>
<li><p>Maximum IPsec tunnel supported: 32</p></li>
</ul>
</div>
<div class="section" id="id5">
<h3>4.3.2 Classification Fields (Matches)<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h3>
<div class="section" id="encryption">
<h4>4.3.2.1 Encryption<a class="headerlink" href="#encryption" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Key

<span class="m">1</span>. IPv4 <span class="nb">source</span> address

<span class="m">2</span>. IPv4 destination address

<span class="m">3</span>. IP4 protocol Action

Actions

<span class="m">1</span>. Action flag

<span class="m">2</span>. SPI

<span class="m">3</span>. Key

<span class="m">4</span>. IV
</pre></div>
</div>
</div>
<div class="section" id="decryption">
<h4>4.3.2.2 Decryption<a class="headerlink" href="#decryption" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Keys

<span class="m">1</span>. IPv4 <span class="nb">source</span> address

<span class="m">2</span>. IPv4 destination address

<span class="m">3</span>. SPI <span class="o">(</span>Security Parameter Index<span class="o">)</span>

Actions

<span class="m">1</span>. Decryption key

<span class="m">2</span>. IV
</pre></div>
</div>
</div>
</div>
<div class="section" id="strongswan-installation">
<h3>4.3.3 strongSwan Installation<a class="headerlink" href="#strongswan-installation" title="Permalink to this heading">¶</a></h3>
<p>Execute the following commands as a root user:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>- apt-get install aptitude

- aptitude install opensc

- aptitude install libgmp10

- aptitude install libgmp-dev

- apt-get install libssl-dev
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Before installing the Debian package for strongSwan, make sure all the dependencies are installed.</p>
<p>Step 1. Refer <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p>
<p>Step 2. Use the following command to validate the version of the strongSwan Debian package. Ignore this step if it shows the version as strongswan_5.8.4</p>
<p>The version can be found using the command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">swanctl</span> <span class="pre">--version</span></code>.</p>
<p>Remove the already installed package before installing the latest one:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dpkg -r strongswan_5.8.4-1_amd64
dpkg -i strongswan_5.8.4-1_amd64.deb
</pre></div>
</div>
<p>Step 3. After installing the strongSwan package, create a CA certificate. CA certificate can be created in one server and can be copied to the other server.</p>
<div class="section" id="id6">
<h4>4.3.3.1 Server 1 Configuration<a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h4>
<p>Step 1. Generating a self-signed CA certificate using the PKI utility of strongSwan:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cd /etc/ipsec.d
ipsec pki --gen --type rsa --size 4096 --outform pem &gt; private/
strongswanKey.pem
ipsec pki --self --ca --lifetime 3650 --in private/strongswanKey.pem --
type rsa --dn &quot;C=CH, O=strongSwan, CN=Root CA&quot; --outform pem &gt; cacerts/
strongswanCert.pem
</pre></div>
</div>
<p>Step 2. After the key and certificate are generated in server 1, copy them to server 2 in the same directory.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>    a. Copy the file `strongswanKey.pem` present in `/etc/ipsec.d/private/` from the first server to the second server at the same location.

    b. Copy the file `strongswanCert.pem` presenti n `/etc/ipsec.d/cacerts/strongswanCert.pem` from the first server to the second server at the same location.

   After finishing the above, create a key pair and certificate for each server separately as root.
</pre></div>
</div>
<p>Step 3. Generate the key pair and certificate in server 1 as a root user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">d</span>
<span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="n">gen</span> <span class="o">--</span><span class="nb">type</span> <span class="n">rsa</span> <span class="o">--</span><span class="n">size</span> <span class="mi">2048</span> <span class="o">--</span><span class="n">outform</span> <span class="n">pem</span> <span class="o">&gt;</span> <span class="n">private</span><span class="o">/</span>
<span class="n">client1Key</span><span class="o">.</span><span class="n">pem</span>
<span class="n">chmod</span> <span class="mi">600</span> <span class="n">private</span><span class="o">/</span><span class="n">client1Key</span><span class="o">.</span><span class="n">pem</span>
<span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="n">pub</span> <span class="o">--</span><span class="ow">in</span> <span class="n">private</span><span class="o">/</span><span class="n">client1Key</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="nb">type</span> <span class="n">rsa</span> <span class="o">|</span> <span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span>
<span class="n">issue</span> <span class="o">--</span><span class="n">lifetime</span> <span class="mi">730</span> <span class="o">--</span><span class="n">cacert</span> <span class="n">cacerts</span><span class="o">/</span><span class="n">strongswanCert</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="n">cakey</span> <span class="n">private</span><span class="o">/</span>
<span class="n">strongswanKey</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="n">dn</span> <span class="s2">&quot;C=CH, O=strongSwan, CN=device1&quot;</span> <span class="o">--</span><span class="n">san</span> <span class="n">device1</span> <span class="o">--</span>
<span class="n">flag</span> <span class="n">serverAuth</span> <span class="o">--</span><span class="n">flag</span> <span class="n">ikeIntermediate</span> <span class="o">--</span><span class="n">outform</span> <span class="n">pem</span> <span class="o">&gt;</span> <span class="n">certs</span><span class="o">/</span>
<span class="n">client1Cert</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p>Step 4. Configure the conf file and secret file in server 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">conf</span>
<span class="n">conn</span> <span class="n">hw_offload</span> <span class="c1">#</span>
<span class="n">left</span><span class="o">=</span><span class="mf">10.16.0.2</span>
<span class="n">right</span><span class="o">=</span><span class="mf">10.16.0.1</span>
<span class="n">ike</span><span class="o">=</span><span class="n">aes256gcm16</span><span class="o">-</span><span class="n">sha256</span><span class="o">-</span><span class="n">modp2048</span>
<span class="n">esp</span><span class="o">=</span><span class="n">aes256gcm16</span><span class="o">-</span><span class="n">modp2048</span>
<span class="n">keyingtries</span><span class="o">=%</span><span class="n">forever</span>
<span class="n">ikelifetime</span><span class="o">=</span><span class="mi">8</span><span class="n">h</span>
<span class="n">lifetime</span><span class="o">=</span><span class="mi">8</span><span class="n">h</span>
<span class="n">dpddelay</span><span class="o">=</span><span class="mi">1</span><span class="n">h</span>
<span class="n">dpdtimeout</span><span class="o">=</span><span class="mi">1</span><span class="n">h</span>
<span class="n">dpdaction</span><span class="o">=</span><span class="n">restart</span>
<span class="n">auto</span><span class="o">=</span><span class="n">route</span>
<span class="n">keyexchange</span><span class="o">=</span><span class="n">ikev2</span>
<span class="nb">type</span><span class="o">=</span><span class="n">transport</span>
<span class="n">leftcert</span><span class="o">=</span><span class="n">client1Cert</span><span class="o">.</span><span class="n">pem</span>
<span class="n">leftsendcert</span><span class="o">=</span><span class="n">always</span>
<span class="n">hw_offload</span><span class="o">=</span><span class="n">yes</span>
<span class="n">leftid</span><span class="o">=</span><span class="s2">&quot;C=CH, O=strongSwan, CN=device1&quot;</span>
<span class="n">rightid</span><span class="o">=</span><span class="s2">&quot;C=CH, O=strongSwan, CN=device2&quot;</span>
<span class="n">leftprotoport</span><span class="o">=</span><span class="n">gre</span>
<span class="n">rightprotoport</span><span class="o">=</span><span class="n">gre</span>
<span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">secrets</span>
<span class="p">:</span> <span class="n">RSA</span> <span class="n">client1Key</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> There is a white space, present between <code class="docutils literal notranslate"><span class="pre">:</span></code> and <code class="docutils literal notranslate"><span class="pre">RSA</span></code>.</p>
</div>
<div class="section" id="id7">
<h4>4.3.3.2 Server 2 Configuration<a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h4>
<p>Step 1. Generate the key pair and certificate in server 2 as root:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">d</span>
<span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="n">gen</span> <span class="o">--</span><span class="nb">type</span> <span class="n">rsa</span> <span class="o">--</span><span class="n">size</span> <span class="mi">2048</span> <span class="o">--</span><span class="n">outform</span> <span class="n">pem</span> <span class="o">&gt;</span> <span class="n">private</span><span class="o">/</span>
<span class="n">client2Key</span><span class="o">.</span><span class="n">pem</span>
<span class="n">chmod</span> <span class="mi">600</span> <span class="n">private</span><span class="o">/</span><span class="n">client2Key</span><span class="o">.</span><span class="n">pem</span>
<span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="n">pub</span> <span class="o">--</span><span class="ow">in</span> <span class="n">private</span><span class="o">/</span><span class="n">client2Key</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="nb">type</span> <span class="n">rsa</span> <span class="o">|</span> <span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span>
<span class="n">issue</span> <span class="o">--</span><span class="n">lifetime</span> <span class="mi">730</span> <span class="o">--</span><span class="n">cacert</span> <span class="n">cacerts</span><span class="o">/</span><span class="n">strongswanCert</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="n">cakey</span> <span class="n">private</span><span class="o">/</span>
<span class="n">strongswanKey</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="n">dn</span> <span class="s2">&quot;C=CH, O=strongSwan, CN=device2&quot;</span> <span class="o">--</span><span class="n">san</span> <span class="n">device2</span> <span class="o">--</span>
<span class="n">flag</span> <span class="n">serverAuth</span> <span class="o">--</span><span class="n">flag</span> <span class="n">ikeIntermediate</span> <span class="o">--</span><span class="n">outform</span> <span class="n">pem</span> <span class="o">&gt;</span> <span class="n">certs</span><span class="o">/</span>
<span class="n">client2Cert</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p>Step 2. Configure the conf file and secret file in server 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">conf</span>
<span class="n">conn</span> <span class="n">hw_offload</span> <span class="c1">#</span>
<span class="n">left</span><span class="o">=</span><span class="mf">10.16.0.1</span>
<span class="n">right</span><span class="o">=</span><span class="mf">10.16.0.2</span>
<span class="n">ike</span><span class="o">=</span><span class="n">aes256gcm16</span><span class="o">-</span><span class="n">sha256</span><span class="o">-</span><span class="n">modp2048</span>
<span class="n">esp</span><span class="o">=</span><span class="n">aes256gcm16</span><span class="o">-</span><span class="n">modp2048</span>
<span class="n">keyingtries</span><span class="o">=%</span><span class="n">forever</span>
<span class="n">ikelifetime</span><span class="o">=</span><span class="mi">8</span><span class="n">h</span>
<span class="n">lifetime</span><span class="o">=</span><span class="mi">8</span><span class="n">h</span>
<span class="n">dpddelay</span><span class="o">=</span><span class="mi">1</span><span class="n">h</span>
<span class="n">dpdtimeout</span><span class="o">=</span><span class="mi">1</span><span class="n">h</span>
<span class="n">dpdaction</span><span class="o">=</span><span class="n">restart</span>
<span class="n">auto</span><span class="o">=</span><span class="n">route</span>
<span class="n">keyexchange</span><span class="o">=</span><span class="n">ikev2</span>
<span class="nb">type</span><span class="o">=</span><span class="n">transport</span>
<span class="n">leftcert</span><span class="o">=</span><span class="n">client2Cert</span><span class="o">.</span><span class="n">pem</span>
<span class="n">leftsendcert</span><span class="o">=</span><span class="n">always</span>
<span class="n">hw_offload</span><span class="o">=</span><span class="n">yes</span>
<span class="n">leftid</span><span class="o">=</span><span class="s2">&quot;C=CH, O=strongSwan, CN=device2&quot;</span>
<span class="n">rightid</span><span class="o">=</span><span class="s2">&quot;C=CH, O=strongSwan, CN=device1&quot;</span>
<span class="n">leftprotoport</span><span class="o">=</span><span class="n">gre</span>
<span class="n">rightprotoport</span><span class="o">=</span><span class="n">gre</span>
<span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">secrets</span>
<span class="p">:</span> <span class="n">RSA</span> <span class="n">client2Key</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong>  There is a white space, present between <code class="docutils literal notranslate"><span class="pre">:</span></code> and <code class="docutils literal notranslate"><span class="pre">RSA</span></code>.</p>
</div>
<div class="section" id="server-1-steps-to-run-ipsec">
<h4>4.3.3.3 Server 1: Steps to Run IPsec<a class="headerlink" href="#server-1-steps-to-run-ipsec" title="Permalink to this heading">¶</a></h4>
<p>Step 1. Validate the driver version of the U25N interface using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N driver version is 5.3.3.1008.3</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.
<em><em>Note</em>:</em>* Either PF0 or PF1 interface could act as a Tunnel endpoint . In the following example we have assumed PF0 as a tunnel endpoint.</p>
<p>Step 2. Ensure that the PF1 interface is up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_2</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">U25eth1</span> <span class="pre">up</span></code>.</p>
<p>Step 3. Esnure that the PF0 interface is up and assign a tunnel endpoint IP to it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">U25eth0</span> <span class="pre">10.16.0.2/24</span> <span class="pre">up</span></code>.</p>
<p>Step 4. Esnure that  PF0 interface is in switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 interface link is up before doing switchdev mode.</p>
<p>The lspci | grep Sol command gives the PCIe device bus ID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">devlink</span> <span class="pre">dev</span> <span class="pre">eswitch</span> <span class="pre">set</span> <span class="pre">pci/0000:af:00.0</span> <span class="pre">mode</span> <span class="pre">switchdev</span></code>.</p>
<p>Step 5. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed with the following steps.</p>
<p>Step 6. Create GRE interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">gre0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">gre0</span> <span class="nb">type</span><span class="o">=</span><span class="n">gre</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">gre0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">gre0</span> <span class="nb">type</span><span class="o">=</span><span class="n">gre</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=</span><span class="mf">10.16.0.2</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=</span><span class="mf">10.16.0.1</span>
</pre></div>
</div>
<p>Step 7. Add the PF1 interface OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="o">&lt;</span><span class="n">U25N</span> <span class="n">interface_2</span><span class="o">&gt;</span>
<span class="n">eg</span><span class="p">:</span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">U25eth1</span>
</pre></div>
</div>
<p>Step 8. Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
<p>Step 9. Ensure that the bridge is up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">br0</span> <span class="pre">up</span></code>.</p>
<p>Step 10. Enable ipsec offload in the driver:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```
echo 1 &gt;&gt; /sys/class/net/&lt;U25N_interface_1&gt;/device/ipsec_enable
```

For example, `echo 1 &gt;&gt; /sys/class/net/U25eth0/device/ipsec_enable`.
</pre></div>
</div>
<p>Step 11. Start IPsec:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```
sudo ipsec restart
```
</pre></div>
</div>
</div>
<div class="section" id="server-2-steps-to-run-ipsec">
<h4>4.3.3.4 Server 2: Steps to Run IPsec<a class="headerlink" href="#server-2-steps-to-run-ipsec" title="Permalink to this heading">¶</a></h4>
<p>Step 1. Validate the driver version of the U25N interface using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N driver version is 5.3.3.1008.3</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
<p>Step 2. Ensure that the PF1 interface up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_2</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">U25eth1</span> <span class="pre">up</span></code>.</p>
<p>Step 3. Ensure that the PF0 interface is up and assign a tunnel IP to it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">U25_eth0</span> <span class="pre">10.16.0.1/24up</span></code>.</p>
<p>Step 4. Ensure that the PF0 interface is into switchdev mode:</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives us the PCIe device bus ID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">devlink</span> <span class="pre">dev</span> <span class="pre">eswitch</span> <span class="pre">set</span> <span class="pre">pci/0000:af:00.0</span> <span class="pre">mode</span> <span class="pre">switchdev</span></code>.</p>
<p>Step 5. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed with the following steps.</p>
<p>Steo 6. Create GRE interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">gre0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">gre0</span> <span class="nb">type</span><span class="o">=</span><span class="n">gre</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">gre0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">gre0</span> <span class="nb">type</span><span class="o">=</span><span class="n">gre</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=</span><span class="mf">10.16.0.1</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=</span><span class="mf">10.16.0.2</span>
</pre></div>
</div>
<p>Step 7. Add PF1 interface OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="o">&lt;</span><span class="n">U25N</span> <span class="n">interface_2</span><span class="o">&gt;</span>
<span class="n">eg</span><span class="p">:</span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">U25eth1</span>
</pre></div>
</div>
<p>Step 8. Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
<p>Step 9. Ensure that the bridge is up.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">br0</span> <span class="pre">up</span></code>.</p>
<p>Step 10. Enable ipsec offload in the driver:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```
echo 1 &gt;&gt; /sys/class/net/&lt;U25N_interface_1&gt;/device/ipsec_enable
```

For example, `echo 1 &gt;&gt; /sys/class/net/U25eth0/device/ipsec_enable`.
</pre></div>
</div>
<p>Step 11. Start IPsec:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```
sudo ipsec restart
```

Refer [Functionality Check](./ug1534-detailedappsdescriptions.html#functionality-check) to validate OVS functionality.
</pre></div>
</div>
<p><em>Figure 13:</em> <strong>IPsec + OVS End to End setup Diagram</strong></p>
<p><img alt="X25555-091321" src="../_images/jqy1631576791246_LowRes.png" /></p>
</div>
</div>
<div class="section" id="changing-ipsec-tunnel-endpoints">
<h3>4.3.5 Changing IPsec Tunnel Endpoints<a class="headerlink" href="#changing-ipsec-tunnel-endpoints" title="Permalink to this heading">¶</a></h3>
<p><strong><em>Note</em>:</strong> In the below case, we assumed PF0 interface had previously acted as tunnel endpoint and now we are configuring PF1 to act as tunnel endpoint.</p>
<p><strong><em>Note</em>:</strong> Login as root user before proceeding below steps.</p>
<p>Step 1: Stop the incoming and outgoing traffic.</p>
<p>Step 2: Stop IPsec running on both servers using the below mentioned command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipsec</span> <span class="n">stop</span>
</pre></div>
</div>
<p>Step 3: Disable ipsec offload in PF interface using the below command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mi">0</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/&lt;</span><span class="n">U25N_interface_1</span><span class="o">&gt;/</span><span class="n">device</span><span class="o">/</span><span class="n">ipsec_enable</span>
</pre></div>
</div>
<p>Eg: <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">0</span> <span class="pre">&gt;</span> <span class="pre">/sys/class/net/U25eth0/device/ipsec_enable</span></code></p>
<p>Step 4: Now enable the IPsec offload in the PF which needs to act as Tunnel Endpoint.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/&lt;</span><span class="n">U25N_interface_2</span><span class="o">&gt;/</span><span class="n">device</span><span class="o">/</span><span class="n">ipsec_enable</span>
</pre></div>
</div>
<p>Eg: <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">1</span> <span class="pre">&gt;</span> <span class="pre">/sys/class/net/U25eth1/device/ipsec_enable</span></code></p>
<p>Step 5: Start the IPsec on both servers.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipsec</span> <span class="n">start</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="stateless-firewall">
<h2>4.4 Stateless Firewall<a class="headerlink" href="#stateless-firewall" title="Permalink to this heading">¶</a></h2>
<p>This section is about stateless firewall prerequisites, installation steps, and supported rules.</p>
<div class="section" id="kernel-upgrade">
<h3>Kernel Upgrade<a class="headerlink" href="#kernel-upgrade" title="Permalink to this heading">¶</a></h3>
<p>Run the command <code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-r</span></code> to get the kernel version. If the kernel version is v5.5 or higher, ignore the following steps:</p>
<ol>
<li><p>Download the Debian packages for the kernel upgrade.</p></li>
<li><p>Install the dpkg utility using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">-</span><span class="n">y</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">dpkg</span>
</pre></div>
</div>
</li>
<li><p>Unzip the folder using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unzip</span> <span class="o">&lt;</span><span class="n">folder_name</span><span class="o">&gt;.</span><span class="n">zip</span>
</pre></div>
</div>
</li>
<li><p>Move inside the folder using the cd command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">folder_name</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>Run the following command to install the Debian packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="o">*.</span><span class="n">deb</span>
</pre></div>
</div>
</li>
<li><p>After the command is executed with no error, do a reboot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">reboot</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="nftables">
<h3>nftables<a class="headerlink" href="#nftables" title="Permalink to this heading">¶</a></h3>
<p><strong><em>Note</em>:</strong> Refer <a class="reference external" href="./ug1534-installation.html#deployment-image-flashing">Deployment Image Flashing</a> for flashing images to check firewall functionality.</p>
<p>Step 1. The nftables only work in legacy mode. Ensure the SmartNIC is in legacy mode using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="n">show</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pci_id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The output of the above command should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pci_id</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">mode</span> <span class="n">legacy</span>
</pre></div>
</div>
<p>In case not in legacy mode, change it to legacy mode using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">legacy</span>
</pre></div>
</div>
<p>Step 2. Refer <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p>
<p>The nftables version can be found using the command <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">-v</span></code>.</p>
<p>nftables version ≥ v0.9.6</p>
<p><strong><em>Note</em>:</strong> Tested version 0.9.6 and 0.9.8.</p>
</div>
<div class="section" id="id8">
<h3>4.4.3 Classification Fields (Matches)<a class="headerlink" href="#id8" title="Permalink to this heading">¶</a></h3>
<p>Maximum rules supported: 1K for each U25N PF interface.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Keys:

<span class="m">1</span>. IPv4/IPv6 <span class="nb">source</span> address

<span class="m">2</span>. IPv4/IPv6 destination address

<span class="m">3</span>. Protocol <span class="o">(</span>TCP/UDP<span class="o">)</span>

<span class="m">4</span>. Src_port

<span class="m">5</span>. Dst_port

<span class="m">6</span>. Chain

<span class="m">7</span>. Interface Action

Actions

<span class="m">1</span>. drop

<span class="m">2</span>. accept
</pre></div>
</div>
<p><em>Figure 14:</em> <strong>Firewall</strong></p>
<p><img alt="X25556-091321 this table might be messed up" src="../_images/uhd1631577266564_LowRes.png" /></p>
<div class="section" id="driver-installation">
<h4>Driver Installation<a class="headerlink" href="#driver-installation" title="Permalink to this heading">¶</a></h4>
<p><strong><em>Note</em>:</strong> Log in as a root user before proceeding with the following
steps.</p>
<p>The prerequisites for the driver installation are as follows:</p>
<ul class="simple">
<li><p>modprobe mtd (first time only)</p></li>
<li><p>modprobe mdio (first time only)</p></li>
</ul>
<p>Step 1. If the debian package already exists, remove the existing package before installing the latest debian package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmmod</span> <span class="n">sfc</span>
<span class="n">dpkg</span> <span class="o">-</span><span class="n">r</span> <span class="n">sfc</span><span class="o">-</span><span class="n">dkms</span>
<span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">sfc</span><span class="o">-</span><span class="n">dkms_5</span><span class="mf">.3.3.2000</span><span class="n">_all</span><span class="o">.</span><span class="n">deb</span>
<span class="n">modprobe</span> <span class="n">sfc</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Login as root user before proceeding with the following steps.</p>
<p>Step 2. Creating a table</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">add</span> <span class="n">table</span> <span class="o">&lt;</span><span class="n">family</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">add</span> <span class="pre">table</span> <span class="pre">netdev</span> <span class="pre">filter</span></code>.</p>
<p>Step 3. Creating a chain:</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">add</span> <span class="pre">chain</span> <span class="pre">netdev</span> <span class="pre">filter</span> <span class="pre">input1</span> <span class="pre">{</span> <span class="pre">type</span> <span class="pre">filter</span> <span class="pre">hook</span> <span class="pre">ingress</span> <span class="pre">device</span> <span class="pre">ens7f1np1</span> <span class="pre">priority</span> <span class="pre">1;</span> <span class="pre">flags</span> <span class="pre">offload</span> <span class="pre">;}</span></code>. Adding a chain without specifying the policy leads to the default policy Accept.</p>
<p>Step 4. Adding rules to the chain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">add</span> <span class="n">rule</span> <span class="o">&lt;</span><span class="n">family</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">table</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">chain</span> <span class="n">name</span><span class="o">&gt;</span> <span class="n">ip</span> <span class="n">saddr</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">drop</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">add</span> <span class="pre">rule</span> <span class="pre">netdev</span> <span class="pre">filter</span> <span class="pre">input1</span> <span class="pre">ip</span> <span class="pre">saddr</span> <span class="pre">1.1.1.1</span> <span class="pre">drop</span></code>.</p>
<p>Step 5. Commands for listing tables, chain, and rules:</p>
<p>a. Listing a table of a netdev family:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  ```
  nft list tables &lt;family&gt;
  ```

  For example, `nft list tables netdev`.
</pre></div>
</div>
<p>b. Listing a particular chain from a table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  ```
  nft list chain &lt;family&gt; &lt;table name&gt; &lt;chain_name&gt;
  ```

  For example, `nft list chain netdev filter input1`.
</pre></div>
</div>
<p>c. Listing a chain along with a handle:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  ```
  nft -a list chain &lt;family&gt; &lt;table name&gt; &lt;chain_name&gt;
  ```

  For example, `nft -a list chain netdev filter input1`.
</pre></div>
</div>
<p>d. Listing all tables, chains, and rules with handle:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  ```
  nft -a list ruleset
  ```
</pre></div>
</div>
<p>Step 6. Commands for deleting tables, chains and rules:</p>
<p>a. Deleting a table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  ```
  nft delete table &lt;family&gt; &lt;name&gt;
  ```

  For example, `nft delete table netdev filter`.
</pre></div>
</div>
<p>b. Deleting a chain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  ```
  nft delete chain &lt;family&gt; &lt;table name&gt; &lt;chain name&gt;
  ```

  For example, `nft delete chain netdev filter input1`.
</pre></div>
</div>
<p>c. Deleting a specific rule with a handle:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  ```
  nft delete rule &lt;family&gt; &lt;table name&gt; &lt;chain_name&gt; handle &lt;handle_no&gt;
  ```

  For example, `nft delete rule netdev filter input1 handle 3`.

  ***Note*:** Here the handle number for a specific rule could be found using the `nft -a list ruleset` command.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="statistics">
<h2>4.5 Statistics<a class="headerlink" href="#statistics" title="Permalink to this heading">¶</a></h2>
<p>This section outlines the commands used by different modules to check the statistics and packet counters.</p>
<div class="section" id="ovs-commands">
<h3>OVS Commands<a class="headerlink" href="#ovs-commands" title="Permalink to this heading">¶</a></h3>
<ol class="simple">
<li><p>To print a brief overview of the database contents:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
<ol class="simple">
<li><p>To show the datapath flow entries:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">ofctl</span> <span class="n">dump</span><span class="o">-</span><span class="n">flows</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<ol class="simple">
<li><p>To show the full OpenFlow flow table, including hidden flows, on the bridge:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">appctl</span> <span class="n">dpctl</span><span class="o">/</span><span class="n">dump</span><span class="o">-</span><span class="n">flows</span> <span class="nb">type</span><span class="o">=</span><span class="n">offloaded</span>
</pre></div>
</div>
<ol class="simple">
<li><p>To show the OVS datapath flows:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">dpctl</span> <span class="n">dump</span><span class="o">-</span><span class="n">flows</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">appctl</span> <span class="n">dpctl</span><span class="o">/</span><span class="n">dump</span><span class="o">-</span><span class="n">flows</span>
</pre></div>
</div>
<ol class="simple">
<li><p>To show which flows are offloaded or not:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span> <span class="nb">filter</span> <span class="n">show</span> <span class="n">dev</span> <span class="o">&lt;</span><span class="n">iface_name</span><span class="o">&gt;</span> <span class="n">ingress</span>
</pre></div>
</div>
</div>
<div class="section" id="mae-rules">
<h3>4.5.2 MAE Rules<a class="headerlink" href="#mae-rules" title="Permalink to this heading">¶</a></h3>
<ol class="simple">
<li><p>Use the following command to display the rules present in the match-action engine (MAE):</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">sfc</span><span class="o">/&lt;</span><span class="n">if_iface</span><span class="o">&gt;/</span><span class="n">mae_rules</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Here <code class="docutils literal notranslate"><span class="pre">if_iface</span></code> should be the corresponding PF interface.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/sys/kernel/debug/sfc/if_u25eth0/mae_rules</span></code>.</p>
<ol class="simple">
<li><p>Use the following command to display the default rules present in the MAE:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">sfc</span><span class="o">/&lt;</span><span class="n">iface</span><span class="o">/</span><span class="n">mae_default_rules</span>
</pre></div>
</div>
</div>
<div class="section" id="ipsec-statistics">
<h3>4.5.3 IPsec Statistics<a class="headerlink" href="#ipsec-statistics" title="Permalink to this heading">¶</a></h3>
<ol class="simple">
<li><p>IPsec stats can be obtained by executing the following command:</p></li>
</ol>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">swanctl</span> <span class="pre">--stats</span></code></p></li>
</ul>
<ol class="simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">xfrm</span> <span class="pre">show</span></code> command to display IPsec offload security association.</p></li>
</ol>
</div>
</div>
<div class="section" id="debug-commands">
<h2>4.6 Debug Commands<a class="headerlink" href="#debug-commands" title="Permalink to this heading">¶</a></h2>
<p><strong><em>Note</em>:</strong> The output of the following commands should be saved for debug purposes.</p>
<ol class="simple">
<li><p>lsmod - It displays which kernel modules are currently loaded. Whether the sfc driver is inserted or not can be verified by the below command.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lsmod</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">sfc</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Expected result:
</pre></div>
</div>
<p>sfc                   		704512  	0
sfc_driverlink         	16384  		1 	sfc
virtual_bus            	20480  		1 	sfc
mtd                    	65536  		14 	cmdlinepart,sfc
mdio                   	16384  		1 	sfc</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<ol class="simple">
<li><p>To get kernel logs, enter the following command.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dmesg</span>
</pre></div>
</div>
<p>This command will help to understand all the actions performed by the driver and if there are any crashes happening due to the driver.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lspci</span>
</pre></div>
</div>
<p>To display information about all PCI buses and devices in the system. It will also show the network cards inserted in the system with details like driver in use, pci id etc.
For Example:</p>
<ol class="simple">
<li><p>lspci | grep Solarflare - Lists the info regarding solarflare devices in the system
lspci -k | grep Solarflare - Lists the subsystem information also.<br />lspci -vvv -s <BDF></p></li>
</ol>
<p>Expected result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lspci <span class="p">|</span> grep Solarflare:
3b:00.0 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>

3b:00.1 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>

lspci -k <span class="p">|</span> grep Solarflare:

3b:00.0 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>
Subsystem: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller

3b:00.1 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>
Subsystem: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller
</pre></div>
</div>
<ol class="simple">
<li><p>Logs generated by U25N hardware are saved to a file.The logs are collected from the internal processing subsystem and exported to the host at frequent intervals. Currently these logs are populated when switchdev mode is enabled.</p></li>
</ol>
<p>Path to read the logs in host : <code class="docutils literal notranslate"><span class="pre">/var/log/ps_dmesg.txt</span></code></p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sfreport</span></code> - A command line utility that generates a diagnostic log file providing diagnostic data about the server and Solarflare adapters.
Please refer to SF-103837-CD Solarflare Server Adapter User Guide chapter 5.20 for more details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">top</span></code> - This command can be used to show the linux processes or threads. It provides a real time view of the running system. It can be used to detect memory leaks.
The file in the linux path /proc/meminfo can also be used for detecting memory leaks.</p></li>
</ol>
<p>Watch out for the total memory already in use. Memory leak can be identified by running the command multiple times and checking whether the memory usage keeps on increasing.</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ps</span></code> - This command displays relevant information about active processes.<br />Example: ps -aux | grep sfc</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ethtool</span></code> - This command can be used to understand the driver related information such as version, firmware info and the enabled features.
ethtool -i &lt;interface_name&gt;<br />Example Usage:	ethtool -i enp59s0f0np0</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Expected result: 
driver: sfc
version: <span class="m">5</span>.3.3.2000.1
firmware-version: <span class="m">7</span>.8.7.1005 rx0 tx0
expansion-rom-version: 
bus-info: <span class="m">0000</span>:3b:00.0
supports-statistics: yes
supports-test: yes
supports-eeprom-access: no
supports-register-dump: yes
supports-priv-flags: yes
</pre></div>
</div>
<p>To get the information of the state of protocol offload and other features
ethtool -k &lt;interface_name&gt;
Example Usage:	ethtool -k enp59s0f1np1</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Expected result: 
Features <span class="k">for</span> enp59s0f1np1:
rx-checksumming: on
tx-checksumming: on
	tx-checksum-ipv4: on
	tx-checksum-ip-generic: off <span class="o">[</span>fixed<span class="o">]</span>
	tx-checksum-ipv6: on
	tx-checksum-fcoe-crc: off <span class="o">[</span>fixed<span class="o">]</span>
	tx-checksum-sctp: off <span class="o">[</span>fixed<span class="o">]</span>
scatter-gather: on
	tx-scatter-gather: on
	tx-scatter-gather-fraglist: off <span class="o">[</span>fixed<span class="o">]</span>
tcp-segmentation-offload: on
	tx-tcp-segmentation: on
	tx-tcp-ecn-segmentation: on
	tx-tcp-mangleid-segmentation: off
	tx-tcp6-segmentation: on
generic-segmentation-offload: on
generic-receive-offload: on
large-receive-offload: off
—-------------------------------------and so on.
</pre></div>
</div>
<p>To change the offload parameters and other features of the network device
sudo ethtool -K &lt;interface_name&gt; <feature> &lt;on/off&gt;</p>
<p>To get information about NIC Statistics
sudo ethtool -S &lt;interface_name&gt;
Example usage: sudo ethtool -S enp59s0f1np1</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Expected result:
NIC statistics:
     rx_noskb_drops: <span class="m">0</span>
     rx_nodesc_trunc: <span class="m">0</span>
     port_tx_bytes: <span class="m">59052</span>
     port_tx_packets: <span class="m">353</span>
     port_tx_pause: <span class="m">0</span>
     port_tx_control: <span class="m">0</span>
     port_tx_unicast: <span class="m">0</span>
     port_tx_multicast: <span class="m">273</span>
     port_tx_broadcast: <span class="m">80</span>
     port_tx_lt64: <span class="m">0</span>
     port_tx_64: <span class="m">0</span>
     port_tx_65_to_127: <span class="m">229</span>
     port_tx_128_to_255: <span class="m">44</span>
     port_tx_256_to_511: <span class="m">80</span>
     port_tx_512_to_1023: <span class="m">0</span>
     port_tx_1024_to_15xx: <span class="m">0</span>
     port_tx_15xx_to_jumbo: <span class="m">0</span>
     port_rx_bytes: <span class="m">0</span>
     port_rx_good_bytes: <span class="m">0</span>
     port_rx_bad_bytes: <span class="m">0</span>
     port_rx_packets: <span class="m">0</span>
—-------------------------------------- and so on.
</pre></div>
</div>
<p>NOTE: ethtool functionalities for sfc driver can also be realised using the sfctool utility also.
Eg:   sudo sfctool -S &lt;interface_name&gt;
Example Usage: sudo sfctool -S enp59s0f1np1</p>
<ol class="simple">
<li><p>u25n_update Application: u25n_update utility can be used to read the U25N shell version.
Eg:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./utils/u25n_update get-version &lt;PF0_interface&gt; 
</pre></div>
</div>
<p>10.MCDI Logging - Mcdi request and response data will be visible in dmesg if we activate mcdi logs. To activate the logs in dmesg:<br />echo 1 &gt;&gt; /sys/class/net/&lt;interface_name&gt;/device/mcdi_logging</p>
<ol class="simple">
<li><p>OVS log levels - It can be turned on/off using the ovs-appctl commands.
The ovs-vswitchd accepts the option –log-file[=file] to enable logging to a specific file. The file argument is actually optional, so if it is specified, it is used as the exact name for the log file. The default is used if the file is not specified. Usually the default is /usr/local/var/log/openvswitch/ovs-vswitchd.log
Setting OVS Log levels:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-appctl vlog/set ANY:ANY:dbg
ovs-appctl vlog/set poll_loop:ANY:OFF
ovs-appctl vlog/set netlink_socket:ANY:OFF
</pre></div>
</div>
<ol class="simple">
<li><p>Mae Rules - To see the offloaded rules available in the MAE, check the below file:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat /sys/kernel/debug/sfc/if_&lt;interface_name&gt;/mae_rules
</pre></div>
</div>
<p>To check the default rules in MAE, check the below file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat /sys/kernel/debug/sfc/if_&lt;interface_name&gt;/mae_default_rules
</pre></div>
</div>
<ol class="simple">
<li><p>iperf3 - Iperf is a tool for network performance measurement and tuning. It is a cross-platform tool that can produce standardized performance measurements for any network. It has client and server functionality, and can create data streams to measure the throughput between the interfaces. After setting proper ip addresses:
Server: iperf3 -s <options>
Client : iperf -c &lt;ip_addr_interface&gt; <options></p></li>
<li><p>tcpdump -  Tcpdump is a packet sniffing and packet analyzing tool meant for System Administrators to troubleshoot connectivity issues in Linux. For example it can capture the packets coming to the network interface using the below command.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tcpdump -i &lt;interface_name&gt;
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ug1534-dpdk.html" class="btn btn-neutral float-right" title="DPDK" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ug1534-installation.html" class="btn btn-neutral float-left" title="3. U25N Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on July 9, 2022.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
														
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<div class="lang-select dropup hidden-md hidden-lg">
		<button data-toggle="dropdown">
			<span class="fas fa-globe" aria-hidden="true"></span>
			<span>
				
					English
				</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a target="_blank" href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
																	<div class="lang-select dropup hidden-xs hidden-sm">
	<button data-toggle="dropdown">
		<span class="fas fa-globe" aria-hidden="true"></span>
		<span>
			
				English
			</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
															</div>
														</div>
														<div class="col-md-pull-5 col-lg-pull-5 col-md-5 col-lg-5">
															<span class="copyright">©2022 Advanced Micro Devices, Inc</span>
														</div>

													</div>
													                    <div class="movethisrowtoleft row">
                        <div class="col-xs-24">
                            <ul class="sub-menu">
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a></li>
								<li><a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a></li>
                                <li><a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></li>
                            </ul>
                        </div>
                    </div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
<div class="backToTop parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><noindex>
    <span data-component="backToTopButton" class="backToTopButton loaded">
        <ul>
            <li>
                <a href="https://www.author.xilinx.com/xx/rebrand/amd/en-amd-xilinx-header-footer.html#top" class="btn top">
                    <span class="fas fa-angle-up" aria-hidden="true"></span>
                </a>
            </li>
        </ul>
    </span>
</noindex></div>
			</div>
		</div>


		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>