


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

	<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="37701bd4-e5c0-4ee3-9329-e7475d0b13a7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
		<!-- Google Tag Manager -->
	<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
	<!-- End Google Tag Manager -->
	
        <!-- Google Tag Manager -->
        <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
        <!-- End Google Tag Manager -->	

  
  
  
  

  
      <script type="text/javascript" src="../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../_static/js/Searchbox.min.js"></script>
    <script type="text/javascript" src="../_static/js/header-footer.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/pro.min.css" media="all" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DPDK" href="ug1534-dpdk.html" />
    <link rel="prev" title="3. U25N Installation" href="ug1534-installation.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
 <div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">

    
    

    



<div class="xf-content-height">
    

<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
    
    <div class="header parbase aem-GridColumn aem-GridColumn--default--12"><noindex>
	<header data-component="header" class="site-header">
		<nav class="navbar navbar-default">
			<div class="container-fluid main-nav">
				<div class="row">
					<div class="navbar-column col-xs-4 col-sm-5">
						<ul class="nav navbar-nav hidden-xs">
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
								</li>
							</ul>
							
						<ul class="nav navbar-nav hidden-sm hidden-md hidden-lg">
							<li>
									<button data-target="#header-container-0" data-function="toggle">Solutions</button>
								</li>
							<li>
									<button data-target="#header-container-1" data-function="toggle">Products</button>
								</li>
							<li>
									<button data-target="#header-container-2" data-function="toggle">Company</button>
								</li>
							</ul>
							
						<div id="header-container-0" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-1" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-2" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							</div>
					<div class="logo-column col-xs-4 col-sm-2">
						<div class="logo">
							<a target="_blank" href="https://www.xilinx.com/">
								<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
							</a>
						</div>
					</div>

				</div>
			</div>
			</nav></header></noindex></div>
		
	
</div>

    
</div>
</div>

<div class="calloutBanner parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><div class="callout-banner">
    Xilinx is now a part of <a target="_blank" href="https://www.amd.com/en/corporate/xilinx-acquisition">AMD</a> |  <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Learn More</a>
</div>
</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> U25N
          

          
          </a>

          
            
            
              <div class="version">
                1.8.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">U25N</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ug1534-introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-supportedservices.html">Supported Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Detailed Applications Descriptions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#legacy-and-switchdev-modes">4.1 Legacy and Switchdev Modes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#legacy-nic-default">4.1.1 Legacy NIC (Default)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#switchdev-mode">4.1.2 Switchdev Mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ovs">4.2 OVS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-ovs">4.2.1 Installing OVS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#classification-fields-matches">4.2.2 Classification Fields (Matches)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#number-of-flow-supported-in-datapath-tables">4.2.3 Number of Flow Supported in Datapath Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#port-to-port">4.2.4 Port to Port</a></li>
<li class="toctree-l3"><a class="reference internal" href="#port-to-vm-or-vm-to-port">4.2.5 Port to VM or VM to Port</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vm-to-vm">4.2.6 VM to VM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tunnels-encapsulation-decapsulation">4.2.7 Tunnels (Encapsulation/Decapsulation)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#l2gre">4.2.7.1 L2GRE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vxlan">4.2.7.2 VXLAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vm-to-vm-or-vm-to-port-or-port-to-vm-tunnel">4.2.7.3 VM to VM or VM to Port or Port to VM Tunnel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#lacp">4.2.8 LACP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lag-creation">4.2.8.1 LAG Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lag-deletion">4.2.8.2 LAG Deletion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#connection-tracking">4.2.9 Connection Tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ovs-configuration">4.2.10 OVS Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functionality-check">4.2.11 Functionality Check</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ping-test">Ping Test</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#uninstalling-ovs-setup">4.2.12 Uninstalling OVS Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ipsec">4.3 IPsec</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supported-xfrm-parameters">4.3.1 Supported XFRM Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">4.3.2 Classification Fields (Matches)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#encryption">4.3.2.1 Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decryption">4.3.2.2 Decryption</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strongswan-installation">4.3.3 strongSwan Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ipsec-server-1-configuration">4.3.3.1 IPSec Server 1 Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipsec-server-2-configuration">4.3.3.2 IPSec Server 2 Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#server-1-steps-to-run-ipsec">4.3.3.3 Server 1: Steps to Run IPsec</a></li>
<li class="toctree-l4"><a class="reference internal" href="#server-2-steps-to-run-ipsec">4.3.3.4 Server 2: Steps to Run IPsec</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#stateless-firewall">4.4 Stateless Firewall</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#kernel-upgrade">Kernel Upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nftables">nftables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">4.4.3 Classification Fields (Matches)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#driver-installation">Driver Installation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rate-limiting">4.5 Rate Limiting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ingress-rule">4.5.1 Ingress rule:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#add-rate-limit-policy">4.5.1.1 Add Rate Limit Policy:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#delete-rate-limit-policy">4.5.1.2 Delete Rate Limit Policy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#egress-rule">4.5.2 Egress rule:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">4.5.2.1 Add Rate Limit Policy:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">4.5.2.2 Delete Rate Limit Policy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mirroring">4.6 Mirroring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sfboot-configuration">4.6.1 Sfboot Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#local-mirroring">4.6.2 Local Mirroring</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#add-local-ingress-mirroring-rule">4.6.2.1 Add Local Ingress Mirroring Rule:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#delete-local-ingress-mirroring-rule">4.6.2.2 Delete Local Ingress Mirroring Rule:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-local-egress-mirroring-rule">4.6.2.3 Add Local Egress Mirroring Rule:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#delete-local-egress-mirroring-rule">4.6.2.4 Delete Local Egress Mirroring Rule:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#remote-mirroring">4.6.3 Remote Mirroring</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setup-vxlan-tunnel-between-local-and-remote-servers">4.6.3.1 Setup VxLAN tunnel between local and remote servers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-remote-ingress-mirroring-rule">4.6.3.2 Add Remote Ingress Mirroring Rule:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#delete-remote-ingress-mirroring-rule">4.6.3.3 Delete Remote Ingress Mirroring Rule:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-remote-egress-mirroring-rule">4.6.3.4 Add Remote Egress Mirroring Rule:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#delete-remote-egress-mirroring-rule">4.6.3.5 Delete Remote Egress Mirroring Rule:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#statistics">4.7 Statistics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ovs-commands">4.7.1 OVS Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mae-rules">4.7.2 MAE Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ipsec-statistics">4.7.3 IPsec Statistics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#debug-commands">4.8 Debug Commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-dpdk.html">DPDK compilation steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-shellprogramming.html">APPENDIX A U25N Shell Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-vminstall.html">APPENDIX B VM Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-openstackinstallation.html">APPENDIX C OpenStack Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Download Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/U25N-SmartNIC-Solution/blob/gh-pages/docs/build/pdf/ug1534-u25n-smartnic-user-guide.pdf">PDF</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../_sources/docs/ug1534-detailedappsdescriptions.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">U25N</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>4 Detailed Applications Description</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/docs/ug1534-detailedappsdescriptions.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="detailed-applications-description">
<h1>4 Detailed Applications Description<a class="headerlink" href="#detailed-applications-description" title="Permalink to this heading">¶</a></h1>
<section id="legacy-and-switchdev-modes">
<h2>4.1 Legacy and Switchdev Modes<a class="headerlink" href="#legacy-and-switchdev-modes" title="Permalink to this heading">¶</a></h2>
<section id="legacy-nic-default">
<h3>4.1.1 Legacy NIC (Default)<a class="headerlink" href="#legacy-nic-default" title="Permalink to this heading">¶</a></h3>
<p>In legacy mode packets from the external MAC0 are forwarded to the internal MAC2 without any modifications on flow entry miss, and vice versa. Similarly, packets from the external MAC1 are forwarded to the internal MAC3 without any modifications on flow entry miss, and vice versa. OVS is not supported in this configuration.</p>
<p><em>Figure 5:</em> <strong>Legacy Mode</strong></p>
<p><img alt="X25712-091321" src="../_images/cgl1631062304607_LowRes.png" /></p>
</section>
<section id="switchdev-mode">
<h3>4.1.2 Switchdev Mode<a class="headerlink" href="#switchdev-mode" title="Permalink to this heading">¶</a></h3>
<p>When changed to the switchdev mode, the U25N can support OVS switching. Devlink features are added to the PF0 interface in each adapter to support the switch mode. Switchdev mode can be added for a single adapter or both. A new representor network interface comes up for each VF when a VM is connected to the VF via SR-IOV virtual ports provided by X2 VNICs.</p>
<p><em>Figure 6:</em> <strong>Switchdev Mode</strong></p>
<p><img alt="X25549-091321" src="../_images/lpe1631063727073_LowRes.png" /></p>
</section>
</section>
<section id="ovs">
<h2>4.2 OVS<a class="headerlink" href="#ovs" title="Permalink to this heading">¶</a></h2>
<section id="installing-ovs">
<h3>4.2.1 Installing OVS<a class="headerlink" href="#installing-ovs" title="Permalink to this heading">¶</a></h3>
<p>OVS is a multilayer software switch licensed under the open source Apache 2 license. It implements a production quality switch platform that supports standard management interfaces and opens the forwarding functions to programmatic extension and control. OVS is well suited to function as a virtual switch in virtualized environments.</p>
<p>Follow the below-mentioned steps to install OVS. For additional infomation of OVS installation, please refer to <a class="reference external" href="https://docs.openvswitch.org/en/latest/intro/install/index.html">Installing Open vSwitch</a></p>
<ol>
<li><p>The OVS source code is available in its Git repository</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/openvswitch/ovs.git
</pre></div>
</div>
</li>
<li><p>After cloning, the ovs directory will be in the current directory path. “cd” to the ovs directory as mentioned below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ovs
</pre></div>
</div>
</li>
<li><p>Execute the following commands sequentially as the root user:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./boot.sh
./configure
make
make install
</pre></div>
</div>
</li>
<li><p>Export the OVS path:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/share/openvswitch/scripts
</pre></div>
</div>
</li>
<li><p>Perform a version check:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vswitchd --version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Version 2.17.1 has been tested.</p>
</li>
</ol>
<p>Maximum flows supported and tested: 8k</p>
</section>
<section id="classification-fields-matches">
<h3>4.2.2 Classification Fields (Matches)<a class="headerlink" href="#classification-fields-matches" title="Permalink to this heading">¶</a></h3>
<p>Supported Keys and Actions</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Keys:

1. ipv4/ipv6 src_ip
2. ipv4/ipv6 dst_ip
3. ip_tos
4. ip_proto
5. ovlan Outer
6. ivlan Inner
7. ether_type
8. tcp/udp src_port
9. tcp/udp dst_port
10. src_mac
11. dst_mac
12. vni
13. Ingress port

Actions:

1. do_decap
2. do_decr_ip_ttl
3. do_src_mac
4. do_dst_mac
5. do_vlan_pop
6. do_vlan_push
7. do_encap
8. do_deliver
9. mod_vlan_vid
</pre></div>
</div>
</section>
<section id="number-of-flow-supported-in-datapath-tables">
<h3>4.2.3 Number of Flow Supported in Datapath Tables<a class="headerlink" href="#number-of-flow-supported-in-datapath-tables" title="Permalink to this heading">¶</a></h3>
<ol class="simple">
<li><p>AR table - 7680</p></li>
<li><p>CT table - 1 Million</p></li>
<li><p>MAEO - 1K</p></li>
<li><p>MAEX</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>LACP_LAG_Config_Table - 8</p></li>
<li><p>LACP_Balance_Table - 512</p></li>
</ul>
</div></blockquote>
<ol class="simple">
<li><p>Ingress_Mirror_Table - 64</p></li>
<li><p>Egress_Mirror_Table - 64</p></li>
</ol>
</section>
<section id="port-to-port">
<h3>4.2.4 Port to Port<a class="headerlink" href="#port-to-port" title="Permalink to this heading">¶</a></h3>
<p>In this configuration the U25N PF is added to the OVS bridge as an interface. Packets are sent to an external MAC, and OVS performs the switching based on the packets received.</p>
<p><em>Figure 7:</em> <strong>Port to Port setup</strong></p>
<p><img alt="X25550-090721 this seems messed up and missing a portion" src="../_images/cfd1631064119641_LowRes.png" /></p>
<ul>
<li><p>Step 1. Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p></li>
<li><p>Step 2. Check the driver version of U25N interface using the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step, if the U25N driver version is <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">latest</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i u25eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
</li>
<li><p>Step 3. Put both U25N PF interfaces in ready state:</p>
<ol>
<li><p>List the interfaces</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig -a
</pre></div>
</div>
</li>
<li><p>Search for U25N interfaces using the <code class="docutils literal notranslate"><span class="pre">sfboot</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfboot --list <span class="c1"># shows the U25N interfaces</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Adapter</span> <span class="nb">list</span><span class="p">:</span>
   <span class="n">u25eth0</span>
   <span class="n">u25eth1</span>
</pre></div>
</div>
</li>
<li><p>Bring U25N interfaces up</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">PF_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0 up
ifconfig u25eth1 up
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Step 4. Put the U25N PF interfaces into switchdev mode:</p>
<p><strong><em>Note</em>:</strong> Ensure that the PF interface link is up before switching to switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives us the PCIe® device bus ID required to execute the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;pci_id&gt; mode switchdev <span class="c1"># pci_id is the BDF of U25N Device</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.1 mode switchdev
</pre></div>
</div>
</li>
<li><p>Setp 5. Stop network manager</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl stop NetworkManager
</pre></div>
</div>
</li>
<li><p>Step 6. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, continue with the next step.</p></li>
<li><p>Step 7. Add external ports to the OVS bridge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge_name&gt; &lt;PF_interface&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 u25eth0
ovs-vsctl add-port br0 u25eth1
</pre></div>
</div>
</li>
<li><p>Step 8.  a brief overview of the OVS database contents using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
</li>
</ul>
<p>Refer to <a class="reference external" href="./ug1534-detailedappsdescriptions.html#functionality-check">Functionality Check</a> to check the OVS functionality.</p>
</section>
<section id="port-to-vm-or-vm-to-port">
<h3>4.2.5 Port to VM or VM to Port<a class="headerlink" href="#port-to-vm-or-vm-to-port" title="Permalink to this heading">¶</a></h3>
<p><strong><em>Note</em>:</strong> To have this configuration SR-IOV must be enabled in BIOS. For the Port to VM or VM to Port configuration, a tunnel L2GRE or VXLAN could be created with two server setups.</p>
<p><em>Figure 8:</em> <strong>Port to VM or VM to Port setup</strong></p>
<p><img alt="seems messed up a little bit X25551-090721" src="../_images/cgm1631064433686_LowRes.png" /></p>
<ul>
<li><p>Step 1. Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p>
<p>For VM use cases, VFs need to be created for the corresponding PF for binding to the VM. The number of VF counts should be configured by the sfboot command with sriov_numvfs.</p>
<p><strong><em>Note</em>:</strong> For more information, refer to <a class="reference external" href="./ug1534-installation.html#sfboot-configuration">sfboot Configuration</a>.</p>
</li>
<li><p>Step 2. Check the driver version of U25N interface using the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step, if the U25N driver version is <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">latest</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i u25eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
</li>
<li><p>Step 3. Put both U25N PF interfaces in ready state:</p>
<ol>
<li><p>List the interfaces</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig -a
</pre></div>
</div>
</li>
<li><p>Search for U25N interfaces using the <code class="docutils literal notranslate"><span class="pre">sfboot</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfboot --list <span class="c1"># shows the U25N interfaces</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Adapter</span> <span class="nb">list</span><span class="p">:</span>
   <span class="n">u25eth0</span>
   <span class="n">u25eth1</span>
</pre></div>
</div>
</li>
<li><p>Bring U25N interfaces up</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">PF_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0 up
ifconfig u25eth1 up
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Step 4. Enable desired VFs to the U25N PF. In the following command, a single VF is enabled on the PF0 interface:</p>
<p><strong><em>Note</em>:</strong> The VF could also be created on the PF1 interface based on the use case. The sriov_numvfs count should be less than or equal to the VF count specified in the sfboot command. The sriov_numvfs should be enabled only in legacy mode. To check the U25N mode, excecute the following steps.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch show pci/0000:&lt;pci_id&gt; <span class="c1"># pci_id is the BDF of U25N Device</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pci/0000:af:00.0 mode legacy
</pre></div>
</div>
<p>If not in legacy mode, change to legacy mode using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode legacy
</pre></div>
</div>
<p>Enable desired number of VFs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">1</span> &gt; /sys/class/net/&lt;PF_interface&gt;/device/sriov_numvfs
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">1</span> &gt; sys/class/net/u25eth0/device/sriov_numvfs
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> After executing above mentioned command, a VF PCIe ID and VF interface will be created. The VF PCIe device ID can be listed with the command <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d</span> <span class="pre">1924:1b03</span></code>.</p>
<p>An example of the device ID is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>af:00.2 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>Virtual Function<span class="o">)</span> <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>. 
This VF PCIe ID is used <span class="k">for</span> binding the VF to a VM.
</pre></div>
</div>
</li>
<li><p>Step 5. The VF interface can be found using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. To differentiate VF from PF, use the ip link show command. This gives the VF interface ID and VF interface mac address under the PF interface.</p></li>
<li><p>Step 6. Ensure that the VF interface is up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;VF_interface&gt; up
</pre></div>
</div>
</li>
<li><p>Step 7. Ensure that the PF interface is in switchdev mode:</p>
<p><strong><em>Note</em>:</strong> Ensure the PF interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;pci_id&gt; mode switchdev <span class="c1"># pci_id is the BDF of U25N Device</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
</pre></div>
</div>
</li>
<li><p>Step 8. Running the above command creates a VF representor interface. The VF representor interface name will be the PF interface name followed by <code class="docutils literal notranslate"><span class="pre">_0</span></code> for the first VF representor and <code class="docutils literal notranslate"><span class="pre">_1</span></code> for the second V representor, and so on.</p>
<p>**<em>Note</em>:**The total number of VF representor interfaces created are based on the sriov_numvfs value configured above.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link show <span class="p">|</span> grep &lt;PF_interface&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link show <span class="p">|</span> grep u25eth0
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Here u25eth0 is the PF interface and u25eth0_0 is the VF representor interface.</p>
<p>Now make the VF representor interface up using the ifconfig command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;VF_rep_interface&gt; up
</pre></div>
</div>
</li>
<li><p>Step 9. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p></li>
<li><p>Step 10. Add PF interfaces as ports to the OVS bridge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge_name&gt; &lt;PF0_interface&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 u25eth0
</pre></div>
</div>
</li>
<li><p>Step 11. Add a VF representor interface as a port to the OVS bridge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge_name&gt; &lt;VF_rep_interface&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 u25eth0_0
</pre></div>
</div>
</li>
<li><p>Step 12. Ensure that the the OVS bridge is up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;bridge_name&gt; up
</pre></div>
</div>
</li>
<li><p>Step 13. Print a brief overview of the database contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
</li>
<li><p>Step 14. Refer <a class="reference external" href="./ug1534-vminstall.html#vm-installation">VM Installation</a> to instantiate the VM.</p></li>
<li><p>Step 15. Refer to <a class="reference external" href="./ug1534-detailedappsdescriptions.html#functionality-check">Functionality Check</a> to check OVS functionality.</p></li>
</ul>
</section>
<section id="vm-to-vm">
<h3>4.2.6 VM to VM<a class="headerlink" href="#vm-to-vm" title="Permalink to this heading">¶</a></h3>
<p><strong><em>Note</em>:</strong> To have this configuration SR-IOV must be enabled in BIOS.</p>
<p><em>Figure 9:</em> <strong>VM to VM setup</strong></p>
<p><img alt="seems messed up a little bit X25551-090721" src="../_images/cxa1631064658045_LowRes.png" /></p>
<ul>
<li><p>Step 1. Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p>
<p>For VM use cases, VFs need to be created for the corresponding PF for binding to the VM. The number of VF counts should be configured by the sfboot command with sriov_numvfs.</p>
<p><strong><em>Note</em>:</strong> For more information, refer to <a class="reference external" href="./ug1534-installation.html#sfboot-configuration">sfboot Configuration</a>.</p>
</li>
<li><p>Step 2. Check the driver version of U25N interface using the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step, if the U25N driver version is <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">latest</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i u25eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
</li>
<li><p>Step 3. Put both U25N PF interfaces in ready state:</p>
<ol>
<li><p>List the interfaces</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig -a
</pre></div>
</div>
</li>
<li><p>Search for U25N interfaces using the <code class="docutils literal notranslate"><span class="pre">sfboot</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfboot --list <span class="c1"># shows the U25N interfaces</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Adapter</span> <span class="nb">list</span><span class="p">:</span>
   <span class="n">u25eth0</span>
   <span class="n">u25eth1</span>
</pre></div>
</div>
</li>
<li><p>Bring U25N interfaces up</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">PF_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0 up
ifconfig u25eth1 up
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Step 4. Enable desired VFs to the U25N PF. In the following command, two VFs are enabled on the PF0 interface:</p>
<p><strong><em>Note</em>:</strong> The VF could also be created on the PF1 interface based on the use case. The sriov_numvfs count should be less than or equal to the VF count specified in the sfboot command. The sriov_numvfs should be enabled only in legacy mode. To check the U25N mode, excecute the following steps.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch show pci/0000:&lt;pci_id&gt; <span class="c1"># pci_id is the BDF of U25N Device</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pci/0000:af:00.0 mode legacy
</pre></div>
</div>
<p>If not in legacy mode, change to legacy mode using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode legacy
</pre></div>
</div>
<p>Enable desired number of VFs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">2</span> &gt; /sys/class/net/&lt;PF_interface&gt;/device/sriov_numvfs
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">2</span> &gt; sys/class/net/u25eth0/device/sriov_numvfs
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> After executing above mentioned command, a VF PCIe ID and VF interface will be created. The VF PCIe device ID can be listed with the command <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d</span> <span class="pre">1924:1b03</span></code>.</p>
<p>An example of the device ID is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>af:00.2 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>Virtual Function<span class="o">)</span> <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>. 
This VF PCIe ID is used <span class="k">for</span> binding the VF to a VM.
</pre></div>
</div>
</li>
<li><p>Step 5. The VF interface can be found using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. To differentiate VF from PF, use the ip link show command. This gives the VF interface ID and VF interface mac address under the PF interface.</p></li>
<li><p>Step 6. Ensure that the VF interface is up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;VF_interface&gt; up
</pre></div>
</div>
</li>
<li><p>Step 7. Ensure that the PF interfaces are in switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Ensure the PF interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode switchdev
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
</pre></div>
</div>
</li>
<li><p>Step 8. Running the above command creates two VF representor interfaces. The VF representor interface name will be the PF interface name followed by <code class="docutils literal notranslate"><span class="pre">_0</span></code> for the first VF representor and <code class="docutils literal notranslate"><span class="pre">_1</span></code> for the second V representor, and so on.</p>
<p>**<em>Note</em>:**The total number of VF representor interfaces created are based on the sriov_numvfs value configured above.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link show <span class="p">|</span> grep &lt;PF_interface&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link show <span class="p">|</span> grep u25eth0
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>u25eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc mq state UP
mode DEFAULT group default qlen <span class="m">1000</span>
u25eth0_0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel
master ovs-system state UP mode DEFAULT group default qlen <span class="m">1000</span>
u25eth0_1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel
master ovs-system state UP mode DEFAULT group default qlen <span class="m">1000</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Here u25eth0 is the PF interface, and u25eth0_0 and u25eth0_1 are the VF representor interfaces.</p>
<p>Now make the VF representor interfaces up using the ifconfig command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;VF_rep_interface&gt; up
</pre></div>
</div>
</li>
<li><p>Step 9. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p></li>
<li><p>Step 10. Add two VF representor interfaces to the OVS bridge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge_name&gt; &lt;VF_rep_interface <span class="m">1</span>&gt;
ovs-vsctl add-port &lt;bridge_name&gt; &lt;VF_rep_interface <span class="m">2</span>&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">u25eth0_0</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">u25eth0_1</span>
</pre></div>
</div>
</li>
<li><p>Step 11. Ensure that the the OVS bridge is up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;bridge_name&gt; up
</pre></div>
</div>
</li>
<li><p>Step 12. Print the brief overview of the database contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
</li>
<li><p>Step 14. Refer <a class="reference external" href="./ug1534-vminstall.html#vm-installation">VM Installation</a> to instantiate the VM.</p></li>
<li><p>Step 15. Refer to <a class="reference external" href="./ug1534-detailedappsdescriptions.html#functionality-check">Functionality Check</a> to check OVS functionality.</p></li>
</ul>
</section>
<section id="tunnels-encapsulation-decapsulation">
<h3>4.2.7 Tunnels (Encapsulation/Decapsulation)<a class="headerlink" href="#tunnels-encapsulation-decapsulation" title="Permalink to this heading">¶</a></h3>
<p>U25N Smart NIC supports offloading of tunnels using encapsulation and decapsulation actions.</p>
<ul class="simple">
<li><p><strong>Encapsulation:</strong> Pushing tunnel header is supported on TX</p></li>
<li><p><strong>Decapsulation:</strong> Stripping tunnel header is supported on RX</p></li>
</ul>
<p>Supported tunnels:</p>
<ul class="simple">
<li><p>VXLAN</p></li>
<li><p>L2GRE</p></li>
</ul>
<section id="l2gre">
<h4>4.2.7.1 L2GRE<a class="headerlink" href="#l2gre" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Maximum tunnel support = 1K</p></li>
<li><p>Maximum supported flows = 8K</p></li>
<li><p>Maximum MTU size = 1400</p></li>
</ul>
<p>Refer <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version. An L2GRE tunnel can be formed between two servers. Tunnel endpoint IP should be added to the PF interface which acts as a origin of the tunnel.</p>
<p><em>Figure 10:</em> <strong>L2GRE End to End setup with OVS functionality</strong></p>
<p><img alt="X25553-091321" src="../_images/idz1631575855541_LowRes.png" /></p>
<section id="l2gre-server-1-configuration">
<h5><strong>L2GRE Server 1 Configuration</strong><a class="headerlink" href="#l2gre-server-1-configuration" title="Permalink to this heading">¶</a></h5>
<ul>
<li><p>Step 1. Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p></li>
<li><p>Step 2. Check the driver version of U25N interface using the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step, if the U25N driver version is <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">latest</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i u25eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
</li>
<li><p>Step 3. Put both U25N PF interfaces in ready state:</p>
<ol>
<li><p>List the interfaces</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig -a
</pre></div>
</div>
</li>
<li><p>Search for U25N interfaces using the <code class="docutils literal notranslate"><span class="pre">sfboot</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfboot --list <span class="c1"># shows the U25N interfaces</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Adapter</span> <span class="nb">list</span><span class="p">:</span>
   <span class="n">u25eth0</span>
   <span class="n">u25eth1</span>
</pre></div>
</div>
</li>
<li><p>Bring U25N interfaces up</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">PF_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0 up
ifconfig u25eth1 up
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Step 4. Assign tunnel local IP to PF0 interface:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;PF0_interface&gt; &lt;local_ip&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0 <span class="m">10</span>.16.0.2/24 up
</pre></div>
</div>
</li>
<li><p>Step 5. Put the U25N PF0 interface into switchdev mode:</p>
<p><strong><em>Note</em>:</strong> Ensure that the PF interface link is up before switching to switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives us the PCIe® device bus ID required to execute the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;pci_id&gt; mode switchdev <span class="c1"># pci_id is the BDF of U25N Device</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
</pre></div>
</div>
</li>
<li><p>Step 6. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, continue with the next step.</p></li>
<li><p>Step 7. Create GRE interfaces:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge_name&gt; gre0 -- <span class="nb">set</span> interface gre0 <span class="nv">type</span><span class="o">=</span>gre
options:local_ip<span class="o">=</span>&lt;ip_address&gt; options:remote_ip<span class="o">=</span>&lt;ip_address&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 gre0 -- <span class="nb">set</span> interface gre0 <span class="nv">type</span><span class="o">=</span>gre
options:local_ip<span class="o">=</span><span class="m">10</span>.16.0.2 options:remote_ip<span class="o">=</span><span class="m">10</span>.16.0.1
</pre></div>
</div>
</li>
<li><p>Step 8. Add a PF1 interface as a port to the OVS bridge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge_name&gt; &lt;PF1_interface&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 u25eth1
</pre></div>
</div>
</li>
<li><p>Step 9. Ensue the OVS bridge is up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;bridge_name&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig br0 up
</pre></div>
</div>
</li>
<li><p>Step 10. Print a brief overview of the database contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
</li>
</ul>
</section>
<section id="l2gre-server-2-configuration">
<h5><strong>L2GRE Server 2 Configuration</strong><a class="headerlink" href="#l2gre-server-2-configuration" title="Permalink to this heading">¶</a></h5>
<p>The setup steps for server 2 is as same as server 1 except for local_ip and remote_ip in step 4 and step 6.</p>
<p>In step 4, the tunnel local IP assigned to PF0 interface should be the tunnel remote IP in above server 1 configuration.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0 <span class="m">10</span>.16.0.1/24 up
</pre></div>
</div>
<p>In step 6, the tunnel local IP and remote IP should be swapped in above server 1 configuration.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 gre0 -- <span class="nb">set</span> interface gre0 <span class="nv">type</span><span class="o">=</span>gre
options:local_ip<span class="o">=</span><span class="m">10</span>.16.0.1 options:remote_ip<span class="o">=</span><span class="m">10</span>.16.0.2
</pre></div>
</div>
</section>
</section>
<section id="vxlan">
<h4>4.2.7.2 VXLAN<a class="headerlink" href="#vxlan" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Maximum tunnel support = 1K</p></li>
<li><p>Maximum supported flows = 8K</p></li>
<li><p>Maximum MTU size = 1400</p></li>
</ul>
<p>Refer  <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version. A VXLAN tunnel can be formed between two servers. Tunnel endpoint IP should be added to the PF interface where the tunnel needs to be created.</p>
<p><em>Figure 11:</em> <strong>VXLAN</strong></p>
<p><img alt="X25554-091321" src="../_images/rcv1631576075856_LowRes.png" /></p>
<section id="vxlan-server-1-configuration">
<h5><strong>VXLAN Server 1 Configuration</strong><a class="headerlink" href="#vxlan-server-1-configuration" title="Permalink to this heading">¶</a></h5>
<ul>
<li><p>Step 1. Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p></li>
<li><p>Step 2. Check the driver version of U25N interface using the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step, if the U25N driver version is <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">latest</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i u25eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
</li>
<li><p>Step 3. Put both U25N PF interfaces in ready state:</p>
<ol>
<li><p>List the interfaces</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig -a
</pre></div>
</div>
</li>
<li><p>Search for U25N interfaces using the <code class="docutils literal notranslate"><span class="pre">sfboot</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfboot --list <span class="c1"># shows the U25N interfaces</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Adapter</span> <span class="nb">list</span><span class="p">:</span>
   <span class="n">u25eth0</span>
   <span class="n">u25eth1</span>
</pre></div>
</div>
</li>
<li><p>Bring U25N interfaces up</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">PF_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0 up
ifconfig u25eth1 up
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Step 4. Assign tunnel local IP to PF0 interface:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;PF0_interface&gt; &lt;local_ip&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0 <span class="m">10</span>.16.0.2/24 up
</pre></div>
</div>
</li>
<li><p>Step 5. Put the U25N PF0 interface into switchdev mode:</p>
<p><strong><em>Note</em>:</strong> Ensure that the PF interface link is up before switching to switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives us the PCIe® device bus ID required to execute the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;pci_id&gt; mode switchdev <span class="c1"># pci_id is the BDF of U25N Device</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
</pre></div>
</div>
</li>
<li><p>Step 5. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, continue with the next step.</p></li>
<li><p>Step 6. Create VXLAN interfaces:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 vxlan0 -- <span class="nb">set</span> interface vxlan0 <span class="nv">type</span><span class="o">=</span>vxlan
options:local_ip<span class="o">=</span>&lt;ip_address&gt; options:remote_ip<span class="o">=</span>&lt;ip_address&gt; options:key<span class="o">=</span>&lt;key_id&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 vxlan0 -- <span class="nb">set</span> interface vxlan0 <span class="nv">type</span><span class="o">=</span>vxlan
options:local_ip<span class="o">=</span><span class="m">10</span>.16.0.2 options:remote_ip<span class="o">=</span><span class="m">10</span>.16.0.1 options:key<span class="o">=</span><span class="m">123</span>
</pre></div>
</div>
</li>
<li><p>Step 7. Add a PF1 interface as a port to the OVS bridge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge_name&gt; &lt;PF1_interface&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 u25eth1
</pre></div>
</div>
</li>
<li><p>Step 8. Ensue the OVS bridge is up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;bridge_name&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig br0 up
</pre></div>
</div>
</li>
<li><p>Step 9. Print a brief overview of the database contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
</li>
</ul>
</section>
<section id="vxlan-server-2-configuration">
<h5><strong>VXLAN Server 2 Configuration</strong><a class="headerlink" href="#vxlan-server-2-configuration" title="Permalink to this heading">¶</a></h5>
<p>The setup steps for server 2 is as same as server 1 except for local_ip and remote_ip in step 4 and step 6.</p>
<p>In step 4, the tunnel local IP assigned to PF0 interface should be the tunnel remote IP in above server 1 configuration.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0 <span class="m">10</span>.16.0.1/24 up
</pre></div>
</div>
<p>In step 6, the tunnel local IP and remote IP should be swapped in above server 1 configuration.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 vxlan0 -- <span class="nb">set</span> interface vxlan0 <span class="nv">type</span><span class="o">=</span>vxlan
options:local_ip<span class="o">=</span><span class="m">10</span>.16.0.1 options:remote_ip<span class="o">=</span><span class="m">10</span>.16.0.2 options:key<span class="o">=</span><span class="m">123</span>
</pre></div>
</div>
</section>
</section>
<section id="vm-to-vm-or-vm-to-port-or-port-to-vm-tunnel">
<h4>4.2.7.3 VM to VM or VM to Port or Port to VM Tunnel<a class="headerlink" href="#vm-to-vm-or-vm-to-port-or-port-to-vm-tunnel" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Maximum tunnel support = 1K</p></li>
<li><p>Maximum supported flows = 8K</p></li>
<li><p>Maximum MTU size = 1400</p></li>
</ul>
<p>Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a>. A VXLAN tunnel can be created between two servers. Tunnel endpoint IP should be added to the PF interface whcih acts as the starting point of the tunnel.</p>
<p><em>Figure 12:</em> <strong>Tunneling/Detunneling setup</strong></p>
<p><img alt="X25696-090721" src="../_images/ash1631066523492_LowRes.png" /></p>
<section id="tunnel-server-1-configuration">
<h5><strong>Tunnel Server 1 Configuration</strong><a class="headerlink" href="#tunnel-server-1-configuration" title="Permalink to this heading">¶</a></h5>
<ul>
<li><p>Step 1. Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p>
<p>For VM use cases, VFs need to be created for the corresponding PF for binding to the VM. The number of VF counts should be configured by the sfboot command with sriov_numvfs.</p>
<p><strong><em>Note</em>:</strong> For more information, refer to <a class="reference external" href="./ug1534-installation.html#sfboot-configuration">sfboot Configuration</a>.</p>
</li>
<li><p>Step 2. Check the driver version of U25N interface using the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step, if the U25N driver version is <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">latest</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i u25eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
</li>
<li><p>Step 3. Put both U25N PF interfaces in ready state:</p>
<ol>
<li><p>List the interfaces</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig -a
</pre></div>
</div>
</li>
<li><p>Search for U25N interfaces using the <code class="docutils literal notranslate"><span class="pre">sfboot</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfboot --list <span class="c1"># shows the U25N interfaces</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Adapter</span> <span class="nb">list</span><span class="p">:</span>
   <span class="n">u25eth0</span>
   <span class="n">u25eth1</span>
</pre></div>
</div>
</li>
<li><p>Bring U25N interfaces up</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">PF_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0 up
ifconfig u25eth1 up
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Step 4. Enable desired VFs to the U25N PF. In the following command, two VFs are enabled on the PF0 interface:</p>
<p><strong><em>Note</em>:</strong> The VF could also be created on the PF1 interface based on the use case. The sriov_numvfs count should be less than or equal to the VF count specified in the sfboot command. The sriov_numvfs should be enabled only in legacy mode. To check the U25N mode, excecute the following steps.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch show pci/0000:&lt;pci_id&gt; <span class="c1"># pci_id is the BDF of U25N Device</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pci/0000:af:00.0 mode legacy
</pre></div>
</div>
<p>If not in legacy mode, change to legacy mode using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode legacy
</pre></div>
</div>
<p>Enable desired number of VFs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">2</span> &gt; /sys/class/net/&lt;PF_interface&gt;/device/sriov_numvfs
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">1</span> &gt; sys/class/net/u25eth0/device/sriov_numvfs
<span class="nb">echo</span> <span class="m">1</span> &gt; sys/class/net/u25eth1/device/sriov_numvfs
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> After executing above mentioned command, a VF PCIe ID and VF interface will be created. The VF PCIe device ID can be listed with the command <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d</span> <span class="pre">1924:1b03</span></code>.</p>
<p>An example of the device ID is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>af:00.2 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>Virtual Function<span class="o">)</span> <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>. 
This VF PCIe ID is used <span class="k">for</span> binding the VF to a VM.
</pre></div>
</div>
</li>
<li><p>Step 5. The VF interface can be found using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. To differentiate VF from PF, use the ip link show command. This gives the VF interface ID and VF interface mac address under the PF interface.</p></li>
<li><p>Step 6. Ensure that the VF interface is up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;VF_interface&gt; up
</pre></div>
</div>
</li>
<li><p>Step 7. Ensure that the PF interfaces are in switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Ensure the PF interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode switchdev
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.1 mode switchdev
</pre></div>
</div>
</li>
<li><p>Step 8. Running the above command creates two VF representor interfaces. The VF representor interface name will be the PF interface name followed by <code class="docutils literal notranslate"><span class="pre">_0</span></code> for the first VF representor and <code class="docutils literal notranslate"><span class="pre">_1</span></code> for the second V representor, and so on.</p>
<p>**<em>Note</em>:**The total number of VF representor interfaces created are based on the sriov_numvfs value configured above.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link show <span class="p">|</span> grep &lt;PF_interface&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link show <span class="p">|</span> grep u25eth
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>u25eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc mq state UP
mode DEFAULT group default qlen <span class="m">1000</span>
u25eth0_0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel
master ovs-system state UP mode DEFAULT group default qlen <span class="m">1000</span>
ip link show <span class="p">|</span> grep &lt;u25eth1&gt;
u25eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc mq state UP
mode DEFAULT group default qlen <span class="m">1000</span>
u25eth1_0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel
master ovs-system state UP mode DEFAULT group default qlen <span class="m">1000</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Here u25eth0 and u25eth1 is the PF interface, and u25eth0_0 and u25eth1_0 are the VF representor interfaces.</p>
<p>Now make the VF representor interfaces up using the ifconfig command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;VF_rep_interface&gt; up
</pre></div>
</div>
</li>
<li><p>Step 9. Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p></li>
<li><p>Step 10. Creating VXLAN/GRE interfaces:</p>
<p><strong><em>Note</em>:</strong> The following configuration is for the VXLAN. Similarly, the GRE tunnel could also be used.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 vxlan0 -- <span class="nb">set</span> interface vxlan0 <span class="nv">type</span><span class="o">=</span>vxlan options:local_ip<span class="o">=</span>&lt;ip_address&gt; options:remote_ip<span class="o">=</span>&lt;ip_address&gt; options:key<span class="o">=</span>&lt;key_id&gt;
ovs-vsctl add-port br1 vxlan1 -- <span class="nb">set</span> interface vxlan0 <span class="nv">type</span><span class="o">=</span>vxlan options:local_ip<span class="o">=</span>&lt;ip_address&gt; options:remote_ip<span class="o">=</span>&lt;ip_address&gt; options:key<span class="o">=</span>&lt;key_id&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 vxlan0 -- <span class="nb">set</span> interface vxlan0 <span class="nv">type</span><span class="o">=</span>vxlan options:local_ip<span class="o">=</span><span class="m">10</span>.16.0.2 options:remote_ip<span class="o">=</span><span class="m">10</span>.16.0.1 options:key<span class="o">=</span><span class="m">123</span>
ovs-vsctl add-port br1 vxlan1 -- <span class="nb">set</span> interface vxlan <span class="nv">type</span><span class="o">=</span>vxlan options:local_ip<span class="o">=</span><span class="m">10</span>.16.0.3 options:remote_ip<span class="o">=</span><span class="m">10</span>.16.0.4 options:key<span class="o">=</span><span class="m">456</span>
</pre></div>
</div>
</li>
<li><p>Step 11. Add VF representor enabled on each PF interface to a separate OVS bridge.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port &lt;bridge_name_0&gt; &lt;VF_rep_interface <span class="m">1</span>&gt;
ovs-vsctl add-port &lt;bridge_name_1&gt; &lt;VF_rep_interface <span class="m">2</span>&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 u25eth0_0
ovs-vsctl add-port br1 u25eth1_0
</pre></div>
</div>
</li>
<li><p>Step 12. Ensure the the two bridges are up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;bridge_name&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig br0 up
ifconfig br1 up
</pre></div>
</div>
</li>
<li><p>Step 13. Print a brief overview of the database contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
</li>
<li><p>Step 14. Refer <a class="reference external" href="./ug1534-vminstall.html#vm-installation">VM Installation</a> to instantiate the VM.</p></li>
</ul>
</section>
<section id="tunnel-server-2-configuration">
<h5><strong>Tunnel Server 2 Configuration</strong><a class="headerlink" href="#tunnel-server-2-configuration" title="Permalink to this heading">¶</a></h5>
<p>The setup steps for server 2 is as same as server 1 except for local_ip and remote_ip in step 10.</p>
<p>In step 10, the tunnel local IP and remote IP should be swapped in above server 1 configuration.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>    ovs-vsctl add-port br0 vxlan0 -- <span class="nb">set</span> interface vxlan0 <span class="nv">type</span><span class="o">=</span>vxlan options:local_ip<span class="o">=</span><span class="m">10</span>.16.0.1 options:remote_ip<span class="o">=</span><span class="m">10</span>.16.0.2 options:key<span class="o">=</span><span class="m">123</span>
    ovs-vsctl add-port br1 vxlan1 -- <span class="nb">set</span> interface vxlan <span class="nv">type</span><span class="o">=</span>vxlan options:local_ip<span class="o">=</span><span class="m">10</span>.16.0.4 options:remote_ip<span class="o">=</span><span class="m">10</span>.16.0.3 options:key<span class="o">=</span><span class="m">456</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="lacp">
<h3>4.2.8 LACP<a class="headerlink" href="#lacp" title="Permalink to this heading">¶</a></h3>
<section id="lag-creation">
<h4>4.2.8.1 LAG Creation<a class="headerlink" href="#lag-creation" title="Permalink to this heading">¶</a></h4>
<ul>
<li><p>Step 1. Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p></li>
<li><p>Step 2. Check the driver version of U25N interface using the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step, if the U25N driver version is <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">latest</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i u25eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
</li>
<li><p>Step 3. Put both U25N PF interfaces in ready state:</p>
<ol>
<li><p>List the interfaces</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig -a
</pre></div>
</div>
</li>
<li><p>Search for U25N interfaces using the <code class="docutils literal notranslate"><span class="pre">sfboot</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfboot --list <span class="c1"># shows the U25N interfaces</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Adapter</span> <span class="nb">list</span><span class="p">:</span>
   <span class="n">u25eth0</span>
   <span class="n">u25eth1</span>
</pre></div>
</div>
</li>
<li><p>Bring U25N interfaces up</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">PF_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0 up
ifconfig u25eth1 up
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Step 4. Put the U25N PF interfaces into switchdev mode:</p>
<p><strong><em>Note</em>:</strong> Ensure that the PF interface link is up before switching to switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives us the PCIe® device bus ID required to execute the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;pci_id&gt; mode switchdev <span class="c1"># pci_id is the BDF of U25N Device</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.1 mode switchdev
</pre></div>
</div>
</li>
<li><p>Step 5. Enable desired VFs to the U25N PF. In the following command, two VFs are enabled on the PF0 interface:</p>
<p><strong><em>Note</em>:</strong> The VF could also be created on the PF1 interface based on the use case. The sriov_numvfs count should be less than or equal to the VF count specified in the sfboot command. The sriov_numvfs should be enabled only in legacy mode. To check the U25N mode, excecute the following steps.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch show pci/0000:&lt;pci_id&gt; <span class="c1"># pci_id is the BDF of U25N Device</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pci/0000:af:00.0 mode legacy
</pre></div>
</div>
<p>If not in legacy mode, change to legacy mode using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode legacy
</pre></div>
</div>
<p>Enable desired number of VFs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">1</span> &gt; /sys/class/net/&lt;PF_interface&gt;/device/sriov_numvfs
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">1</span> &gt; sys/class/net/u25eth0/device/sriov_numvfs
<span class="nb">echo</span> <span class="m">1</span> &gt; sys/class/net/u25eth1/device/sriov_numvfs
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> After executing above mentioned command, a VF PCIe ID and VF interface will be created. The VF PCIe device ID can be listed with the command <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d</span> <span class="pre">1924:1b03</span></code>.</p>
<p>An example of the device ID is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>af:00.2 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>Virtual Function<span class="o">)</span> <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>. 
This VF PCIe ID is used <span class="k">for</span> binding the VF to a VM.
</pre></div>
</div>
</li>
<li><p>Step 6. The VF interface can be found using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. To differentiate VF from PF, use the ip link show command. This gives the VF interface ID and VF interface mac address under the PF interface.</p></li>
<li><p>Step 7. Ensure that the VF interface is up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;VF_interface&gt; up
</pre></div>
</div>
</li>
<li><p>Step 8. Ensure that the PF interfaces are in switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Ensure the PF interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:&lt;PCIe device bus id&gt; mode switchdev
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.0 mode switchdev
devlink dev eswitch <span class="nb">set</span> pci/0000:af:00.1 mode switchdev
</pre></div>
</div>
</li>
<li><p>Step 9. Running the above command creates two VF representor interfaces. The VF representor interface name will be the PF interface name followed by <code class="docutils literal notranslate"><span class="pre">_0</span></code> for the first VF representor and <code class="docutils literal notranslate"><span class="pre">_1</span></code> for the second V representor, and so on.</p>
<p>**<em>Note</em>:**The total number of VF representor interfaces created are based on the sriov_numvfs value configured above.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link show <span class="p">|</span> grep &lt;PF_interface&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link show <span class="p">|</span> grep u25eth
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>u25eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc mq state UP
mode DEFAULT group default qlen <span class="m">1000</span>
u25eth0_0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel
master ovs-system state UP mode DEFAULT group default qlen <span class="m">1000</span>
ip link show <span class="p">|</span> grep &lt;u25eth1&gt;
u25eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc mq state UP
mode DEFAULT group default qlen <span class="m">1000</span>
u25eth1_0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel
master ovs-system state UP mode DEFAULT group default qlen <span class="m">1000</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Here u25eth0 and u25eth1 is the PF interface, and u25eth0_0 and u25eth1_0 are the VF representor interfaces.</p>
<p>Now make the VF representor interfaces up using the ifconfig command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;VF_rep_interface&gt; up
</pre></div>
</div>
</li>
<li><p>Step 10: Creating PF bond.</p>
<ol>
<li><p>Install the bonding driver</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>modprobe bonding
</pre></div>
</div>
</li>
<li><p>Create a PF bond interface. Then set bond mode as 802.3ad and xmit hash policy as layer 3+4</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link add bond0 <span class="nb">type</span> mode <span class="m">802</span>.3ad xmit_hash_policy layer3+4
</pre></div>
</div>
</li>
<li><p>Make both PF interfaces down</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;PF_interface&gt; down
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0 down
ifconfig u25eth1 down
</pre></div>
</div>
</li>
<li><p>Adding PF slave interfaces to master bond interface</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;+u25eth0&quot;</span> &gt; /sys/class/net/bond0/bonding/slaves
<span class="nb">echo</span> <span class="s2">&quot;+u25eth1&quot;</span> &gt; /sys/class/net/bond0/bonding/slaves
</pre></div>
</div>
</li>
<li><p>Make the bond interface up</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig bond0 up
</pre></div>
</div>
</li>
<li><p>Now the bond interface should show the supported rate as 50Gbps</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool bond0
</pre></div>
</div>
</li>
<li><p>Master bond and its corresponding slave interfaces would have the same MAC address</p></li>
</ol>
</li>
<li><p>Step 11: Creating a VF bond</p>
<ol>
<li><p>Create a VF bond interface. Then set bond mode as balance-xor mode and xmit hash policy as layer 3+4</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link add vfbond0 <span class="nb">type</span> mode balance-xor xmit_hash_policy layer3+4
</pre></div>
</div>
</li>
<li><p>Make both VF interfaces down</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;vf_interface&gt; down
</pre></div>
</div>
</li>
<li><p>Adding VF slave interfaces to master VF bond interface</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;+u25eth0n0&quot;</span> &gt; /sys/class/net/vfbond0/bonding/slaves
<span class="nb">echo</span> <span class="s2">&quot;+u25eth1n0&quot;</span> &gt; /sys/class/net/vfbond0/bonding/slaves
</pre></div>
</div>
</li>
<li><p>Make the VF bond interface up</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig vfbond0 up
</pre></div>
</div>
</li>
<li><p>Now the bond interface should show the supported rate as 50Gbps</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool vfbond0
</pre></div>
</div>
</li>
<li><p>Master vfbond and its corresponding slave interfaces would have the same MAC address</p></li>
</ol>
</li>
<li><p>Step 12: Creating VF_Rep bond</p>
<ol>
<li><p>Create a VF_Rep bond interface. Then set bond mode as balance-rr mode</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link add repbond0 <span class="nb">type</span> mode balance-rr
</pre></div>
</div>
</li>
<li><p>Make both VF_rep interfaces down</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;VF_rep_interface&gt; down
</pre></div>
</div>
</li>
<li><p>Adding VF_Rep slave interfaces to master VF_Rep bond interface</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;+u25eth0_0&quot;</span> &gt; /sys/class/net/repbond0/bonding/slaves
<span class="nb">echo</span> <span class="s2">&quot;+u25eth1_0&quot;</span> &gt; /sys/class/net/repbond0/bonding/slaves
</pre></div>
</div>
</li>
<li><p>Make the VF_Rep bond interface up</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig repbond0 up
</pre></div>
</div>
</li>
<li><p>Now the VF_Rep bond interface should show the supported rate as 50Gbps</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool repbond0
</pre></div>
</div>
</li>
<li><p>Master VF_Rep bond and its corresponding slave interfaces would have the same MAC address</p></li>
</ol>
</li>
<li><p>Step 13: Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p></li>
<li><p>Step 14: Adding VF bond and VR_rep bond to OVS bridges.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-port br0 bond0
ovs-vsctl add-port br0 repbond0
</pre></div>
</div>
</li>
<li><p>Step 15: Ensure that the bridge is up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;bridge_name&gt; up
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">br0</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Step 16: Print a brief overview of the database contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
</li>
<li><p>Step 17: Refer <a class="reference external" href="./ug1534-vminstall.html#vm-installation">VM Installation</a> to instantiate the VM with macvtap.</p></li>
<li><p>Step 18: Post successful instantiation refer <a class="reference external" href="./ug1534-detailedappsdescriptions.html#functionality-check">Functionality Check</a> to validate functionality.</p></li>
</ul>
</section>
<section id="lag-deletion">
<h4>4.2.8.2 LAG Deletion<a class="headerlink" href="#lag-deletion" title="Permalink to this heading">¶</a></h4>
<ul>
<li><p>Step 1: Delete ovs-bridge</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl del-br &lt;bridge_name&gt;
</pre></div>
</div>
</li>
<li><p>Step 2: Delete VF_Rep bond interface</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;-repbond_interface&quot;</span> &gt; /sys/class/net/bonding_masters
</pre></div>
</div>
</li>
<li><p>Step 3: Delete VF bond interface</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;-vfbond_interface&quot;</span> &gt; /sys/class/net/bonding_masters
</pre></div>
</div>
</li>
<li><p>Step 4: Delete PF bond interface</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;-bond_interface&quot;</span> &gt; /sys/class/net/bonding_masters
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;-bond0&quot;</span> &gt; /sys/class/net/bonding_masters
</pre></div>
</div>
</li>
<li><p>Step 5: After deleting bond interfaces, remove driver module</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rmmod sfc
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="connection-tracking">
<h3>4.2.9 Connection Tracking<a class="headerlink" href="#connection-tracking" title="Permalink to this heading">¶</a></h3>
<p><strong><em>Note</em>:</strong> Refer to <a class="reference external" href="https://docs.openvswitch.org/en/latest/tutorials/ovs-conntrack/">OVS Conntrack Tutorial</a> for detail of OVS connection tracking feature.</p>
<p>Before using connection tracking feature, please install below kernel modules.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>modprobe sch_netem
modprobe nf_flow_table
modprobe nf_conntrack
modprobe nft_flow_offload
</pre></div>
</div>
<p>Below scenario uses <a class="reference external" href="./ug1534-detailedappsdescriptions.html#port-to-vm-or-vm-to-port">Port to VM or VM to Port</a> data path as an example. Conntrack feature works in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#port-to-port">Port to Port</a> and <a class="reference external" href="./ug1534-detailedappsdescriptions.html#vm-to-vm">VM to VM</a> scenarios too.</p>
<p>Before below steps, please follow the step 1 to 14 in <a class="reference external" href="./ug1534-detailedappsdescriptions.html#port-to-vm-or-vm-to-port">Port to VM or VM to Port</a> to setup OVS and create PF and VF for the bridge.</p>
<p>Configuring TCP flow table timeout</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">3600</span> &gt; /proc/sys/net/netfilter/nf_flowtable_tcp_timeout
</pre></div>
</div>
<p>Maximum number of conntrack connections</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">524288</span> &gt; /proc/sys/net/netfilter/nf_conntrack_max
</pre></div>
</div>
<p>Then following below steps to configure connection tracking rules to the OVS bridges.</p>
<ul>
<li><p>Step 1. Clean all existing Openflow rules of the bridges if they have.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-ofctl del-flows &lt;br0&gt;
ovs-ofctl del-flows &lt;br1&gt;
</pre></div>
</div>
</li>
<li><p>Step 2. Add Openflow rules for testing PF0 and PF1:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Table 0</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=0, priority=1, arp, actions=normal&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=0, priority=3, icmp, actions=normal&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=0, priority=2, icmp6, actions=normal&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=0, priority=1, ip, actions=resubmit(,1)&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=0, priority=1, ipv6, actions=resubmit(,1)&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=0, priority=0, actions=drop&quot;</span>

<span class="c1"># Table 1</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=1, priority=1, ct_state=-trk, ip, actions=ct(table=1,zone=0x1)&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=1, priority=1, ct_state=-trk, ipv6, actions=ct(table=1)&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=1, priority=1, ct_state=+trk+new, ip, in_port=&lt;PF_interface&gt;, actions=ct(commit,zone=0x1),output:\&quot;&lt;VF_interface&gt;\&quot;&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=1, priority=1, ct_state=+trk+new, ip, in_port=&lt;VF_interface&gt;, actions=ct(commit,zone=0x1),output:\&quot;&lt;PF_interface&gt;\&quot;&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=1, priority=1, ct_state=+trk+new, ipv6, actions=ct(commit),normal&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=1, priority=1, ct_state=+trk+est, ip, in_port=&lt;PF_interface&gt;, actions=output:\&quot;&lt;VF_interface&gt;\&quot;&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=1, priority=1, ct_state=+trk+est, ip, in_port=&lt;VF_interface&gt;, actions=output:\&quot;&lt;PF_interface&gt;\&quot;&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=1, priority=1, ct_state=+trk+est, ipv6, actions=normal&quot;</span>
ovs-ofctl add-flow br0 <span class="s2">&quot;table=1, priority=0, actions=drop&quot;</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="ovs-configuration">
<h3>4.2.10 OVS Configuration<a class="headerlink" href="#ovs-configuration" title="Permalink to this heading">¶</a></h3>
<ul>
<li><p>Step 1. Export the OVS path:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/share/openvswitch/scripts
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/bin
</pre></div>
</div>
</li>
<li><p>Step 2. Stop OVS and remove any database to get rid of old configurations:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-ctl stop
rm /usr/local/etc/openvswitch/conf.db
</pre></div>
</div>
</li>
<li><p>Step 3. Start OVS:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-ctl start
</pre></div>
</div>
</li>
<li><p>Step 4. Enable hardware offload:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl <span class="nb">set</span> Open_vSwitch . other_config:hw-offload<span class="o">=</span><span class="nb">true</span>
ovs-vsctl <span class="nb">set</span> Open_vSwitch . other_config:tc-policy<span class="o">=</span>none
</pre></div>
</div>
</li>
<li><p>Step 5. Set OVS log levels (for debug purpose only, if needed):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-appctl vlog/set ANY:ANY:dbg
ovs-appctl vlog/set poll_loop:ANY:OFF
ovs-appctl vlog/set netlink_socket:ANY:OFF
</pre></div>
</div>
</li>
<li><p>Step 6. Set the maximum time (in ms) that idle flows remain cached in the datapath:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Maximum time (in ms) that idle flows will remain cached in the datapath</span>
ovs-vsctl <span class="nb">set</span> open_vswitch <span class="k">$(</span>ovs-vsctl list open_vswitch <span class="p">|</span> grep _uuid <span class="p">|</span> cut -f2 -d <span class="s2">&quot;:&quot;</span> <span class="p">|</span> tr -d <span class="s1">&#39; &#39;</span><span class="k">)</span> other_config:max-idle<span class="o">=</span><span class="m">6000000</span>
<span class="c1"># Maximum time (in ms) that revalidator threads will wait for kernel statistics before executing flow revalidation</span>
ovs-vsctl <span class="nb">set</span> open_vswitch . other_config:max-revalidator<span class="o">=</span><span class="m">10000</span>
<span class="c1"># Number of threads for software datapaths to use for handling new flows. The default value is the number of online CPU cores minus the number of revalidators.</span>
ovs-vsctl <span class="nb">set</span> Open_vSwitch . other_config:n-handler-threads<span class="o">=</span><span class="m">8</span>
<span class="c1"># Specifies the number of threads for software datapaths to use for revalidating flows in the datapath.</span>
ovs-vsctl <span class="nb">set</span> Open_vSwitch . other_config:n-revalidator-threads<span class="o">=</span><span class="m">4</span>
</pre></div>
</div>
</li>
<li><p>Step 7. After adding the hardware offload policy, restart OVS:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-ctl restart
</pre></div>
</div>
</li>
<li><p>Step 8. Print a brief overview of the database contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
</li>
<li><p>Step 9. Adding bridge to OVS:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-br &lt;bridge_name&gt;
</pre></div>
</div>
<p>For Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl add-br br0
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> For VM to VM or VM to Port or Port to VM Tunnel alone create two OVS bridges. For example: <code class="docutils literal notranslate"><span class="pre">ovs-vsctl</span> <span class="pre">add-br</span> <span class="pre">br0</span></code> and <code class="docutils literal notranslate"><span class="pre">ovs-vsctl</span> <span class="pre">add-br</span> <span class="pre">br1</span></code>.</p>
</li>
</ul>
</section>
<section id="functionality-check">
<h3>4.2.11 Functionality Check<a class="headerlink" href="#functionality-check" title="Permalink to this heading">¶</a></h3>
<p>After adding the U25N network interfaces to the OVS bridge, the functionality can be verified using ping, iperf, and dpdk network performance tools.</p>
<section id="ping-test">
<h4>Ping Test<a class="headerlink" href="#ping-test" title="Permalink to this heading">¶</a></h4>
<ul>
<li><p>Step 1. Assign the IP address to the respective interface and do a ping using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ping &lt;remote_ip&gt;
</pre></div>
</div>
</li>
<li><p>Step 2. After a successful ping test, iperf can be used:</p>
<p><strong><em>Note</em>:</strong> For VXLAN and L2GRE, set the MTU size to 1400 before
running iperf3 or pktgen on a particular interface.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;interface&gt; mtu <span class="m">1400</span> <span class="o">[</span>as root<span class="o">]</span>
</pre></div>
</div>
</li>
<li><p>Step 3. Run <code class="docutils literal notranslate"><span class="pre">iperf3</span> <span class="pre">-s</span></code> on the host device [iperf server].</p></li>
<li><p>Step 4. Run <code class="docutils literal notranslate"><span class="pre">iperf3</span> <span class="pre">-c</span> <span class="pre">&lt;ip</span> <span class="pre">address&gt;</span></code> on a remote device [iperf client].</p></li>
</ul>
</section>
</section>
<section id="uninstalling-ovs-setup">
<h3>4.2.12 Uninstalling OVS Setup<a class="headerlink" href="#uninstalling-ovs-setup" title="Permalink to this heading">¶</a></h3>
<p>To uninstall the setup, please follow the instructions below.</p>
<ul>
<li><p>Step 1. power off all running VMs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>killall qemu-system-x86
</pre></div>
</div>
</li>
<li><p>Step2. Delete the OVS bridge</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl del-br &lt; Bridge_nam &gt;
</pre></div>
</div>
</li>
<li><p>Step3. Delete the bond interface if U25N’s interface is the slave interface of this bond interface.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link del &lt; bond_name &gt;
</pre></div>
</div>
</li>
<li><p>Step4. Make all PF interfaces up</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt; interface_name &gt; up
</pre></div>
</div>
</li>
<li><p>Step5. Change mode from switchdev to legacy</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>devlink dev switch <span class="nb">set</span> pci/0000:&lt;pci&gt; mode legacy
</pre></div>
</div>
</li>
<li><p>Step6. Remove all VFs using the echo command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">0</span> &gt; /sys/class/net/&lt; interface_name &gt;/device/sriov_numvfs
</pre></div>
</div>
</li>
<li><p>Step7. uninstall the driver module</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rmmod sfc
</pre></div>
</div>
</li>
</ul>
<p><strong><em>Note</em>:</strong> Refer to <a class="reference external" href="./ug1534-supportedservices.html#dpdk-on-u25n">DPDK on U25N</a> to run dpdk-testpmd.</p>
</section>
</section>
<section id="ipsec">
<h2>4.3 IPsec<a class="headerlink" href="#ipsec" title="Permalink to this heading">¶</a></h2>
<section id="supported-xfrm-parameters">
<h3>4.3.1 Supported XFRM Parameters<a class="headerlink" href="#supported-xfrm-parameters" title="Permalink to this heading">¶</a></h3>
<p>IPsec tunnels are created between two servers. Because IPsec is in <em>transport mode</em>, L2GRE is used to create tunnels. The strongSwan application runs in user space. The charon plugin of strongSwan is used to offload rules on the U25N. Packets reaching the IPsec module should be L2GRE encapsulated.</p>
<ul class="simple">
<li><p>Encryption algorithm: AES-GCM 256 encryption/decryption</p></li>
<li><p>IPsec mode: Transport mode.</p></li>
<li><p>Maximum IPsec tunnel supported: 32</p></li>
</ul>
</section>
<section id="id1">
<h3>4.3.2 Classification Fields (Matches)<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<section id="encryption">
<h4>4.3.2.1 Encryption<a class="headerlink" href="#encryption" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Key

<span class="m">1</span>. IPv4 <span class="nb">source</span> address
<span class="m">2</span>. IPv4 destination address
<span class="m">3</span>. IP4 protocol Action

Actions

<span class="m">1</span>. Action flag
<span class="m">2</span>. SPI
<span class="m">3</span>. Key
<span class="m">4</span>. IV
</pre></div>
</div>
</section>
<section id="decryption">
<h4>4.3.2.2 Decryption<a class="headerlink" href="#decryption" title="Permalink to this heading">¶</a></h4>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Keys

1. IPv4 source address

2. IPv4 destination address

3. SPI (Security Parameter Index)

Actions

1. Decryption key

2. IV
</pre></div>
</div>
</section>
</section>
<section id="strongswan-installation">
<h3>4.3.3 strongSwan Installation<a class="headerlink" href="#strongswan-installation" title="Permalink to this heading">¶</a></h3>
<p><strong><em>Note</em>:</strong> Before installing the Debian package for strongSwan, make sure all the dependencies are installed.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>apt-get install aptitude opensc libgmp10 libgmp-dev libssl-dev
</pre></div>
</div>
<ul>
<li><p>Step 1. Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p></li>
<li><p>Step 2. Use the following commands to validate the version of the strongSwan Debian package.</p>
<p>The version can be found using the command <code class="docutils literal notranslate"><span class="pre">swanctl</span> <span class="pre">--version</span></code>.
Remove the already installed package before installing the latest one:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dpkg -r strongswan_5.8.4-1_amd64
dpkg -i strongswan_5.8.4-1_amd64.deb
</pre></div>
</div>
</li>
<li><p>Step 3. After installing the strongSwan package, create a CA certificate. CA certificate can be created in one server and can be copied to the other server.</p></li>
</ul>
<section id="ipsec-server-1-configuration">
<h4>4.3.3.1 IPSec Server 1 Configuration<a class="headerlink" href="#ipsec-server-1-configuration" title="Permalink to this heading">¶</a></h4>
<ul>
<li><p>Step 1. Generating a self-signed CA certificate using the PKI utility of strongSwan:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /etc/ipsec.d
ipsec pki --gen --type rsa --size <span class="m">4096</span> --outform pem &gt; private/strongswanKey.pem
ipsec pki --self --ca --lifetime <span class="m">3650</span> --in private/strongswanKey.pem --type rsa --dn <span class="s2">&quot;C=CH, O=strongSwan, CN=Root CA&quot;</span> --outform pem &gt; cacerts/strongswanCert.pem
</pre></div>
</div>
</li>
<li><p>Step 2. After the key and certificate are generated in server 1, copy them to server 2 in the same directory.</p>
<ol class="simple">
<li><p>Copy the file <code class="docutils literal notranslate"><span class="pre">strongswanKey.pem</span></code> present in <code class="docutils literal notranslate"><span class="pre">/etc/ipsec.d/private/</span></code> from the first server to the second server at the same location.</p></li>
<li><p>Copy the file <code class="docutils literal notranslate"><span class="pre">strongswanCert.pem</span></code> presenti n <code class="docutils literal notranslate"><span class="pre">/etc/ipsec.d/cacerts/strongswanCert.pem</span></code> from the first server to the second server at the same location.</p></li>
</ol>
<p>After finishing the above, create a key pair and certificate for each server separately as root.</p>
</li>
<li><p>Step 3. Generate the key pair and certificate in server 1 as a root user:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /etc/ipsec.d
ipsec pki --gen --type rsa --size <span class="m">2048</span> --outform pem &gt; private/client1Key.pem
chmod <span class="m">600</span> private/client1Key.pem
ipsec pki --pub --in private/client1Key.pem --type rsa <span class="p">|</span> ipsec pki --issue --lifetime <span class="m">730</span> --cacert cacerts/strongswanCert.pem --cakey private/strongswanKey.pem --dn <span class="s2">&quot;C=CH, O=strongSwan, CN=device1&quot;</span> --san device1 --flag serverAuth --flag ikeIntermediate --outform pem &gt; certs/client1Cert.pem
</pre></div>
</div>
</li>
<li><p>Step 4. Configure the .conf file and secret file in server 1:</p>
<p>In /etc/ipsec.conf, add below text in the beginning of the file</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>conn hw_offload #
      left=10.16.0.2
      right=10.16.0.1
      ike=aes256gcm16-sha256-modp2048
      esp=aes256gcm16-modp2048
      keyingtries=%forever
      ikelifetime=8h
      lifetime=8h
      dpddelay=1h
      dpdtimeout=1h
      dpdaction=restart
      auto=route
      keyexchange=ikev2
      type=transport
      leftcert=client1Cert.pem
      leftsendcert=always
      hw_offload=yes
      leftid=&quot;C=CH, O=strongSwan, CN=device1&quot;
      rightid=&quot;C=CH, O=strongSwan, CN=device2&quot;
      leftprotoport=gre
      rightprotoport=gre
</pre></div>
</div>
<p>In /etc/ipsec.secrets, add below line in the end of the file</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>: RSA client1Key.pem
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> There is a white space, present between <code class="docutils literal notranslate"><span class="pre">:</span></code> and <code class="docutils literal notranslate"><span class="pre">RSA</span></code>.</p>
</li>
</ul>
</section>
<section id="ipsec-server-2-configuration">
<h4>4.3.3.2 IPSec Server 2 Configuration<a class="headerlink" href="#ipsec-server-2-configuration" title="Permalink to this heading">¶</a></h4>
<ul>
<li><p>Step 1. Generate the key pair and certificate in server 2 as root:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">d</span>
<span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="n">gen</span> <span class="o">--</span><span class="nb">type</span> <span class="n">rsa</span> <span class="o">--</span><span class="n">size</span> <span class="mi">2048</span> <span class="o">--</span><span class="n">outform</span> <span class="n">pem</span> <span class="o">&gt;</span> <span class="n">private</span><span class="o">/</span><span class="n">client2Key</span><span class="o">.</span><span class="n">pem</span>
<span class="n">chmod</span> <span class="mi">600</span> <span class="n">private</span><span class="o">/</span><span class="n">client2Key</span><span class="o">.</span><span class="n">pem</span>
<span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="n">pub</span> <span class="o">--</span><span class="ow">in</span> <span class="n">private</span><span class="o">/</span><span class="n">client2Key</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="nb">type</span> <span class="n">rsa</span> <span class="o">|</span> <span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="n">issue</span> <span class="o">--</span><span class="n">lifetime</span> <span class="mi">730</span> <span class="o">--</span><span class="n">cacert</span> <span class="n">cacerts</span><span class="o">/</span><span class="n">strongswanCert</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="n">cakey</span> <span class="n">private</span><span class="o">/</span><span class="n">strongswanKey</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="n">dn</span> <span class="s2">&quot;C=CH, O=strongSwan, CN=device2&quot;</span> <span class="o">--</span><span class="n">san</span> <span class="n">device2</span> <span class="o">--</span><span class="n">flag</span> <span class="n">serverAuth</span> <span class="o">--</span><span class="n">flag</span> <span class="n">ikeIntermediate</span> <span class="o">--</span><span class="n">outform</span> <span class="n">pem</span> <span class="o">&gt;</span> <span class="n">certs</span><span class="o">/</span><span class="n">client2Cert</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
</li>
<li><p>Step 2. Configure the conf file and secret file in server 2:</p>
<p>In /etc/ipsec.conf, add below text in the beginning of the file</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>conn hw_offload #
      left=10.16.0.1
      right=10.16.0.2
      ike=aes256gcm16-sha256-modp2048
      esp=aes256gcm16-modp2048
      keyingtries=%forever
      ikelifetime=8h
      lifetime=8h
      dpddelay=1h
      dpdtimeout=1h
      dpdaction=restart
      auto=route
      keyexchange=ikev2
      type=transport
      leftcert=client2Cert.pem
      leftsendcert=always
      hw_offload=yes
      leftid=&quot;C=CH, O=strongSwan, CN=device2&quot;
      rightid=&quot;C=CH, O=strongSwan, CN=device1&quot;
      leftprotoport=gre
      rightprotoport=gre
</pre></div>
</div>
<p>In /etc/ipsec.secrets, add below line in the end of the file</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>: RSA client1Key.pem
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> There is a white space, present between <code class="docutils literal notranslate"><span class="pre">:</span></code> and <code class="docutils literal notranslate"><span class="pre">RSA</span></code>.</p>
</li>
</ul>
</section>
<section id="server-1-steps-to-run-ipsec">
<h4>4.3.3.3 Server 1: Steps to Run IPsec<a class="headerlink" href="#server-1-steps-to-run-ipsec" title="Permalink to this heading">¶</a></h4>
<p>Follow the step 1 to 10 of <a class="reference external" href="./ug1534-detailedappsdescriptions.html#l2gre-server-1-configuration">L2GRE Server 1 Configuration</a> to setup L2GRE on server 1.</p>
<p>Then enable IPSec as below.</p>
<ul>
<li><p>Step 1. Enable IPSec offload in the driver:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/&lt;</span><span class="n">PF0_interface</span><span class="o">&gt;/</span><span class="n">device</span><span class="o">/</span><span class="n">ipsec_enable</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">1</span> &gt;&gt; /sys/class/net/u25eth0/device/ipsec_enable
</pre></div>
</div>
</li>
<li><p>Step 2. Start IPsec:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipsec</span> <span class="n">restart</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="server-2-steps-to-run-ipsec">
<h4>4.3.3.4 Server 2: Steps to Run IPsec<a class="headerlink" href="#server-2-steps-to-run-ipsec" title="Permalink to this heading">¶</a></h4>
<p>Follow the step 1 to 10 of <a class="reference external" href="./ug1534-detailedappsdescriptions.html#l2gre-server-2-configuration">L2GRE Server 2 Configuration</a> to setup L2GRE on server 1.</p>
<p>Then enable IPSec as below.</p>
<ul>
<li><p>Step 1. Enable IPSec offload in the driver:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/&lt;</span><span class="n">PF0_interface</span><span class="o">&gt;/</span><span class="n">device</span><span class="o">/</span><span class="n">ipsec_enable</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">1</span> &gt;&gt; /sys/class/net/u25eth0/device/ipsec_enable
</pre></div>
</div>
</li>
<li><p>Step 2. Start IPsec:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipsec</span> <span class="n">restart</span>
</pre></div>
</div>
</li>
</ul>
<p><em>Figure 13:</em> <strong>IPsec + OVS End to End setup Diagram</strong></p>
<p><img alt="X25555-091321" src="../_images/jqy1631576791246_LowRes.png" /></p>
</section>
</section>
</section>
<section id="stateless-firewall">
<h2>4.4 Stateless Firewall<a class="headerlink" href="#stateless-firewall" title="Permalink to this heading">¶</a></h2>
<p>This section is about stateless firewall prerequisites, installation steps, and supported rules.</p>
<section id="kernel-upgrade">
<h3>Kernel Upgrade<a class="headerlink" href="#kernel-upgrade" title="Permalink to this heading">¶</a></h3>
<p>Run the command <code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-r</span></code> to get the kernel version. If the kernel version is v5.5 or higher, skip the following steps:</p>
<ul>
<li><p>Step 1. Install kernel &gt; 5.5 for nftables offload support</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span> <span class="n">install</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-&lt;</span><span class="n">version</span><span class="o">&gt;-</span><span class="n">generic</span> <span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-&lt;</span><span class="n">version</span><span class="o">&gt;-</span><span class="n">generic</span>  <span class="n">linux</span><span class="o">-</span><span class="n">modules</span><span class="o">-</span><span class="n">extra</span><span class="o">-&lt;</span><span class="n">version</span><span class="o">&gt;-</span><span class="n">generic</span>
</pre></div>
</div>
</li>
<li><p>Step 2. After the command is executed with no error, do a reboot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reboot</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="nftables">
<h3>nftables<a class="headerlink" href="#nftables" title="Permalink to this heading">¶</a></h3>
<p><strong><em>Note</em>:</strong> Refer <a class="reference external" href="./ug1534-installation.html#deployment-image-flashing">Deployment Image Flashing</a> for flashing images to check firewall functionality.</p>
<ul>
<li><p>Step 1. Refer to <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p></li>
<li><p>Step 2. Check the nftables version. U25N supports nftables version ≥ v0.9.6. The nftables version can be found using the command <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">-v</span></code>.</p>
<p><strong><em>Note</em>:</strong> Tested version 0.9.6 and 0.9.8.</p>
</li>
<li><p>Step 3. The nftables only work in legacy mode. Ensure the U25N is in legacy mode using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="n">show</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pci_id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The output of the above command should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pci_id</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">mode</span> <span class="n">legacy</span>
</pre></div>
</div>
<p>In case not in legacy mode, change it to legacy mode using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pci_id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">legacy</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id2">
<h3>4.4.3 Classification Fields (Matches)<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<p>Maximum rules supported: 1K for each U25N PF interface.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Keys:

1. IPv4/IPv6 source address

2. IPv4/IPv6 destination address

3. Protocol (TCP/UDP)

4. Src_port

5. Dst_port

6. Chain

7. Interface Action

Actions

1. drop

2. accept
</pre></div>
</div>
<p><em>Figure 14:</em> <strong>Firewall</strong></p>
<p><img alt="X25556-091321 this table might be messed up" src="../_images/uhd1631577266564_LowRes.png" /></p>
<section id="driver-installation">
<h4>Driver Installation<a class="headerlink" href="#driver-installation" title="Permalink to this heading">¶</a></h4>
<p><strong><em>Note</em>:</strong> Log in as a root user before proceeding with the following steps.</p>
<p>The prerequisites for the driver installation are as follows:</p>
<ul>
<li><p>modprobe mtd (first time only)</p></li>
<li><p>modprobe mdio (first time only)</p></li>
<li><p>Step 1. Check the driver version of U25N interface using the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step, if the U25N driver version is <a class="reference external" href="./ug1534-installation.html#basic-requirements-and-component-versions-supported">latest</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i u25eth0 <span class="p">|</span> grep version
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.html#u25n-driver">U25N Driver</a>.</p>
</li>
<li><p>Step 2. Creating a table</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft add table &lt;family&gt; &lt;name&gt;
</pre></div>
</div>
<p>For example: <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">add</span> <span class="pre">table</span> <span class="pre">netdev</span> <span class="pre">filter</span></code>.</p>
</li>
<li><p>Step 3. Creating a chain:</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft add chain netdev filter input1 <span class="o">{</span> <span class="nb">type</span> filter hook ingress device ens7f1np1 priority <span class="m">1</span><span class="p">;</span> flags offload <span class="p">;</span><span class="o">}</span>
</pre></div>
</div>
<p>Adding a chain without specifying the policy leads to the default policy Accept.</p>
</li>
<li><p>Step 4. Adding rules to the chain:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft add rule &lt;family&gt; &lt;table name&gt; &lt;chain name&gt; ip saddr &lt;ip&gt; drop
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft add rule netdev filter input1 ip saddr <span class="m">1</span>.1.1.1 drop
</pre></div>
</div>
</li>
<li><p>Step 5. Commands for listing tables, chain, and rules:</p>
<ol>
<li><p>Listing a table of a netdev family:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft list tables &lt;family&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft list tables netdev
</pre></div>
</div>
</li>
<li><p>Listing a particular chain from a table:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft list chain &lt;family&gt; &lt;table name&gt; &lt;chain_name&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft list chain netdev filter input1
</pre></div>
</div>
</li>
<li><p>Listing a chain along with a handle:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft -a list chain &lt;family&gt; &lt;table name&gt; &lt;chain_name&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft -a list chain netdev filter input1
</pre></div>
</div>
</li>
<li><p>Listing all tables, chains, and rules with handle:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="o">-</span><span class="n">a</span> <span class="nb">list</span> <span class="n">ruleset</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Step 6. Commands for deleting tables, chains and rules:</p>
<ol>
<li><p>Deleting a table:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft delete table &lt;family&gt; &lt;name&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft delete table netdev filter
</pre></div>
</div>
</li>
<li><p>Deleting a chain:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft delete chain &lt;family&gt; &lt;table name&gt; &lt;chain name&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft delete chain netdev filter input1
</pre></div>
</div>
</li>
<li><p>Deleting a specific rule with a handle:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft delete rule &lt;family&gt; &lt;table name&gt; &lt;chain_name&gt; handle &lt;handle_no&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nft delete rule netdev filter input1 handle <span class="m">3</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Here the handle number for a specific rule could be found using the <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">-a</span> <span class="pre">list</span> <span class="pre">ruleset</span></code> command.</p>
</li>
</ol>
</li>
</ul>
</section>
</section>
</section>
<section id="rate-limiting">
<h2>4.5 Rate Limiting<a class="headerlink" href="#rate-limiting" title="Permalink to this heading">¶</a></h2>
<p>Rate limiting can be applied on U25N’s virtual function in ingress and egress directions.</p>
<section id="ingress-rule">
<h3>4.5.1 Ingress rule:<a class="headerlink" href="#ingress-rule" title="Permalink to this heading">¶</a></h3>
<section id="add-rate-limit-policy">
<h4>4.5.1.1 Add Rate Limit Policy:<a class="headerlink" href="#add-rate-limit-policy" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter add dev &lt;VF_rep_interface&gt; parent ffff: protocol all prio <span class="m">90</span> matchall action police rate &lt;value&gt;mbit burst <span class="m">10000</span> mtu 64Kb
</pre></div>
</div>
<p>Eg: Ingress rate limit of 4 Gbps at u25eth0_0</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter add dev u25eth0_0 parent ffff: protocol all prio <span class="m">90</span> matchall action police rate 4000mbit burst <span class="m">10000</span> mtu 64Kb
</pre></div>
</div>
</section>
<section id="delete-rate-limit-policy">
<h4>4.5.1.2 Delete Rate Limit Policy<a class="headerlink" href="#delete-rate-limit-policy" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter del dev &lt;VF_rep_interface&gt; parent ffff: protocol all prio <span class="m">90</span> matchall action police rate &lt;value&gt;mbit burst <span class="m">10000</span> mtu 64Kb
</pre></div>
</div>
<p>Eg:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter del dev u25eth0_0 parent ffff: protocol all prio <span class="m">90</span> matchall action police rate 4000mbit burst <span class="m">10000</span> mtu 64Kb
</pre></div>
</div>
</section>
</section>
<section id="egress-rule">
<h3>4.5.2 Egress rule:<a class="headerlink" href="#egress-rule" title="Permalink to this heading">¶</a></h3>
<section id="id3">
<h4>4.5.2.1 Add Rate Limit Policy:<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc qdisc add dev &lt;VF_rep_interface&gt; handle <span class="m">1</span>: root prio
tc filter add dev &lt;VF_rep_interface&gt; parent <span class="m">1</span>: protocol all prio <span class="m">100</span> matchall action police rate &lt;value&gt;mbit burst <span class="m">10000</span> mtu 64kb
</pre></div>
</div>
<p>Eg: Egress rate limit of 2 Gbps at u25eth0_0</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc qdisc add dev u25eth0_0 handle <span class="m">1</span>: root prio
tc filter add dev u25eth0_0 parent <span class="m">1</span>: protocol all prio <span class="m">100</span> matchall action police rate 2000mbit burst <span class="m">10000</span> mtu 64kb
</pre></div>
</div>
</section>
<section id="id4">
<h4>4.5.2.2 Delete Rate Limit Policy<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter del dev &lt;VF_rep_interface&gt; parent <span class="m">1</span>: protocol all prio <span class="m">100</span> matchall action police rate &lt;value&gt;mbit burst <span class="m">10000</span> mtu 64kb
tc qdisc del dev &lt;VF_rep_interface&gt; handle <span class="m">1</span>: root prio
</pre></div>
</div>
<p>Eg:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc qdisc del dev u25eth0_0 handle <span class="m">1</span>: root prio
tc filter del dev u25eth0_0 parent <span class="m">1</span>: protocol all prio <span class="m">100</span> matchall action police rate 2000mbit burst <span class="m">10000</span> mtu 64kb
</pre></div>
</div>
</section>
</section>
</section>
<section id="mirroring">
<h2>4.6 Mirroring<a class="headerlink" href="#mirroring" title="Permalink to this heading">¶</a></h2>
<section id="sfboot-configuration">
<h3>4.6.1 Sfboot Configuration<a class="headerlink" href="#sfboot-configuration" title="Permalink to this heading">¶</a></h3>
<p>To enable mirrored traffic to be received by the host CPU (either local or remote) through the U25N X2 Network Controller, insecure filters on PF must be enabled.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfboot -i &lt;PF_interface&gt; insecure‐filters<span class="o">=</span>enabled
</pre></div>
</div>
<p>Eg:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfboot -i u25eth0 insecure‐filters<span class="o">=</span>enabled
sfboot -i u25eth1 insecure‐filters<span class="o">=</span>enabled
</pre></div>
</div>
<p><em><strong>Note</strong>:</em> Powercycle is required to update the configuration.</p>
<p>To revert back to default insecure filter configuration, use the below command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfboot -i &lt;PF_interface&gt; insecure‐filters<span class="o">=</span>default 
</pre></div>
</div>
<p>Eg:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfboot -i u25eth0 insecure‐filters<span class="o">=</span>default
sfboot -i u25eth1 insecure‐filters<span class="o">=</span>default
</pre></div>
</div>
<p><em><strong>Note</strong>:</em> Powercycle is required to update the configuration.</p>
</section>
<section id="local-mirroring">
<h3>4.6.2 Local Mirroring<a class="headerlink" href="#local-mirroring" title="Permalink to this heading">¶</a></h3>
<p>Local mirroring feature mirrors the traffic to VF interface on local server.</p>
<section id="add-local-ingress-mirroring-rule">
<h4>4.6.2.1 Add Local Ingress Mirroring Rule:<a class="headerlink" href="#add-local-ingress-mirroring-rule" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter add dev &lt;VF_rep_interface_0&gt; parent ffff: matchall skip_sw action mirred ingress mirror dev &lt;VF_rep_interface_2&gt;
</pre></div>
</div>
<p><em><strong>Note</strong>:</em> Here &lt;VF_rep_interface_0&gt; is the interface from which traffic will be mirrored and &lt;VF_rep_interface_2&gt; is the interface to which mirrored traffic will be sent.</p>
<p>Eg:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter add dev u25eth0_0 parent ffff: matchall skip_sw action mirred ingress mirror dev u25eth0_2
</pre></div>
</div>
</section>
<section id="delete-local-ingress-mirroring-rule">
<h4>4.6.2.2 Delete Local Ingress Mirroring Rule:<a class="headerlink" href="#delete-local-ingress-mirroring-rule" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc -f filter show dev &lt;VF_rep_interface&gt; parent ffff:
tc filter del dev &lt;VF_rep_interface&gt; parent ffff: handle <span class="m">1</span> prio <span class="m">49152</span> protocol all matchall
</pre></div>
</div>
<p>Eg:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc -f filter show dev u25eth0_0 parent ffff:
tc filter del dev u25eth0_0 parent ffff: handle <span class="m">1</span> prio <span class="m">49152</span> protocol all matchall
</pre></div>
</div>
</section>
<section id="add-local-egress-mirroring-rule">
<h4>4.6.2.3 Add Local Egress Mirroring Rule:<a class="headerlink" href="#add-local-egress-mirroring-rule" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc qdisc add dev &lt;VF_rep_interface_0&gt; handle <span class="m">1</span>: root prio
tc filter add dev &lt;VF_rep_interface_0&gt; parent <span class="m">1</span>: matchall skip_sw action mirred egress mirror dev &lt;VF_rep_interface_2&gt;
</pre></div>
</div>
<p>Eg:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc qdisc add dev u25eth0_0 handle <span class="m">1</span>: root prio
tc filter add dev u25eth0_0 parent <span class="m">1</span>: matchall skip_sw action mirred egress mirror dev u25eth0_2
</pre></div>
</div>
</section>
<section id="delete-local-egress-mirroring-rule">
<h4>4.6.2.4 Delete Local Egress Mirroring Rule:<a class="headerlink" href="#delete-local-egress-mirroring-rule" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter del dev &lt;VF_rep_interface&gt; parent <span class="m">1</span>:
tc qdisc del dev &lt;VF_rep_interface&gt; root
</pre></div>
</div>
<p>Eg:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter del dev u25eth0_0 parent <span class="m">1</span>:
tc qdisc del dev u25eth0_0 root
</pre></div>
</div>
</section>
</section>
<section id="remote-mirroring">
<h3>4.6.3 Remote Mirroring<a class="headerlink" href="#remote-mirroring" title="Permalink to this heading">¶</a></h3>
<section id="setup-vxlan-tunnel-between-local-and-remote-servers">
<h4>4.6.3.1 Setup VxLAN tunnel between local and remote servers<a class="headerlink" href="#setup-vxlan-tunnel-between-local-and-remote-servers" title="Permalink to this heading">¶</a></h4>
<p>On local server, create VxLAn tunnel to connect to remote server</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;VF_interface&gt; <span class="m">30</span>.30.30.2/24 mtu <span class="m">9000</span> up
ip link add vxlan0 <span class="nb">type</span> vxlan id <span class="m">100</span> remote &lt;TUNNEL_REMOTE_IP&gt; dev &lt;VF_interface&gt; dstport <span class="m">4789</span> 
ifconfig vxlan0 mtu <span class="m">8950</span> up
</pre></div>
</div>
<p>Eg:
u25eth0n0 is the VF interface. It connects to remote server through the VxLAN tunnel for mirrored traffic.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ifconfig u25eth0n0 <span class="m">30</span>.30.30.2/24 mtu <span class="m">9000</span> up
ip link add vxlan0 <span class="nb">type</span> vxlan id <span class="m">100</span> remote <span class="m">10</span>.0.0.3 dev u25eth0n0 dstport <span class="m">4789</span> 
ifconfig vxlan0 mtu <span class="m">8950</span> up
</pre></div>
</div>
</section>
<section id="add-remote-ingress-mirroring-rule">
<h4>4.6.3.2 Add Remote Ingress Mirroring Rule:<a class="headerlink" href="#add-remote-ingress-mirroring-rule" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter add dev &lt;VF_rep_interface&gt; parent ffff: matchall skip_sw action tunnel_key <span class="nb">set</span> src_ip &lt;TUNNEL_LOCAL_IP&gt; dst_ip &lt;TUNNEL_REMOTE_IP&gt; dst_port <span class="m">4789</span> id <span class="m">100</span> pipe action mirred ingress mirror dev vxlan0
</pre></div>
</div>
<p>Eg:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter add dev u25eth0_0 parent ffff: matchall skip_sw action tunnel_key <span class="nb">set</span> src_ip <span class="m">10</span>.0.0.2 dst_ip <span class="m">10</span>.0.0.3 dst_port <span class="m">4789</span> id <span class="m">100</span> pipe action mirred ingress mirror dev vxlan0
</pre></div>
</div>
</section>
<section id="delete-remote-ingress-mirroring-rule">
<h4>4.6.3.3 Delete Remote Ingress Mirroring Rule:<a class="headerlink" href="#delete-remote-ingress-mirroring-rule" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter del dev &lt;VF_rep_interface&gt; parent ffff:
</pre></div>
</div>
<p>Eg:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter del dev u25eth0_0 parent ffff:
</pre></div>
</div>
</section>
<section id="add-remote-egress-mirroring-rule">
<h4>4.6.3.4 Add Remote Egress Mirroring Rule:<a class="headerlink" href="#add-remote-egress-mirroring-rule" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc qdisc add dev &lt;VF_rep_interface&gt; handle <span class="m">1</span>: root prio
tc filter add dev &lt;VF_rep_interface&gt; parent <span class="m">1</span>: matchall skip_sw action tunnel_key <span class="nb">set</span> src_ip &lt;TUNNEL_LOCAL_IP&gt; dst_ip &lt;TUNNEL_REMOTE_IP&gt; dst_port <span class="m">4789</span> id <span class="m">100</span> pipe action mirred egress mirror dev vxlan0
</pre></div>
</div>
<p>Eg:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc qdisc add dev u25eth0_0 handle <span class="m">1</span>: root prio
tc filter add dev u25eth0_0 parent <span class="m">1</span>: matchall skip_sw action tunnel_key <span class="nb">set</span> src_ip <span class="m">10</span>.0.0.2 dst_ip <span class="m">10</span>.0.0.3 dst_port <span class="m">4789</span> id <span class="m">100</span> pipe action mirred egress mirror dev vxlan0
</pre></div>
</div>
</section>
<section id="delete-remote-egress-mirroring-rule">
<h4>4.6.3.5 Delete Remote Egress Mirroring Rule:<a class="headerlink" href="#delete-remote-egress-mirroring-rule" title="Permalink to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter del dev &lt;VF_rep_interface&gt; parent ffff: 
tc qdisc del dev &lt;&lt;VF_rep_interface&gt;&gt; root
</pre></div>
</div>
<p>Eg:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter del dev u25eth0_0 parent ffff:
tc qdisc del dev u25eth0_0 root
</pre></div>
</div>
</section>
</section>
</section>
<section id="statistics">
<h2>4.7 Statistics<a class="headerlink" href="#statistics" title="Permalink to this heading">¶</a></h2>
<p>This section outlines the commands used by different modules to check the statistics and packet counters.</p>
<section id="ovs-commands">
<h3>4.7.1 OVS Commands<a class="headerlink" href="#ovs-commands" title="Permalink to this heading">¶</a></h3>
<ol>
<li><p>To print a brief overview of the database contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-vsctl show
</pre></div>
</div>
</li>
<li><p>To show the datapath flow entries:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-ofctl dump-flows &lt;bridge_name&gt;
</pre></div>
</div>
</li>
<li><p>To show the full OpenFlow flow table, including hidden flows, on the bridge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-appctl dpctl/dump-flows <span class="nv">type</span><span class="o">=</span>offloaded
</pre></div>
</div>
</li>
<li><p>To show the OVS datapath flows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-dpctl dump-flows
ovs-appctl dpctl/dump-flows
</pre></div>
</div>
</li>
<li><p>To show which flows are offloaded or not:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tc filter show dev &lt;iface_name&gt; ingress
</pre></div>
</div>
</li>
</ol>
</section>
<section id="mae-rules">
<h3>4.7.2 MAE Rules<a class="headerlink" href="#mae-rules" title="Permalink to this heading">¶</a></h3>
<ol>
<li><p>Use the following command to display the rules present in the match-action engine (MAE):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat /sys/kernel/debug/sfc/&lt;if_iface&gt;/mae_rules
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Here <code class="docutils literal notranslate"><span class="pre">if_iface</span></code> should be the corresponding PF interface.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat /sys/kernel/debug/sfc/if_u25eth0/mae_rules
</pre></div>
</div>
</li>
<li><p>Use the following command to display the default rules present in the MAE:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat /sys/kernel/debug/sfc/&lt;iface/mae_default_rules
</pre></div>
</div>
</li>
</ol>
</section>
<section id="ipsec-statistics">
<h3>4.7.3 IPsec Statistics<a class="headerlink" href="#ipsec-statistics" title="Permalink to this heading">¶</a></h3>
<ol>
<li><p>Get IPsec stats:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>swanctl --stats
</pre></div>
</div>
</li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">xfrm</span> <span class="pre">show</span></code> command to display IPsec offload security association.</p></li>
</ol>
</section>
</section>
<section id="debug-commands">
<h2>4.8 Debug Commands<a class="headerlink" href="#debug-commands" title="Permalink to this heading">¶</a></h2>
<p><strong><em>Note</em>:</strong> The output of the following commands should be saved for debug purposes.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lsmod</span></code> - It displays which kernel modules are currently loaded. Whether the sfc driver is inserted or not can be verified by the below command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lsmod <span class="p">|</span> grep sfc
</pre></div>
</div>
<p>Expected result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfc                   		<span class="m">704512</span>  	<span class="m">0</span>
sfc_driverlink         	<span class="m">16384</span>  		<span class="m">1</span> 	sfc
virtual_bus            	<span class="m">20480</span>  		<span class="m">1</span> 	sfc
mtd                    	<span class="m">65536</span>  		<span class="m">14</span>  cmdlinepart,sfc
mdio                   	<span class="m">16384</span>  		<span class="m">1</span> 	sfc
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dmesg</span></code> - To get kernel logs, enter the following command.
This command will help to understand all the actions performed by the driver and if there are any crashes happening due to the driver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lspci</span></code> - To display information about all PCI buses and devices in the system. It will also show the network cards inserted in the system with details like driver in use, pci id etc.
For Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lspci <span class="p">|</span> grep Solarflare <span class="c1">#Lists the info regarding solarflare devices in the system</span>
lspci -k <span class="p">|</span> grep Solarflare <span class="c1">#Lists the subsystem information also.  </span>
lspci -vvv -s &lt;BDF&gt;
</pre></div>
</div>
<p>Expected result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lspci <span class="p">|</span> grep Solarflare:
3b:00.0 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>
3b:00.1 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>

lspci -k <span class="p">|</span> grep Solarflare:
3b:00.0 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>
Subsystem: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller
3b:00.1 Ethernet controller: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller <span class="o">(</span>rev <span class="m">01</span><span class="o">)</span>
Subsystem: Solarflare Communications XtremeScale SFC9250 <span class="m">10</span>/25/40/50/100G Ethernet Controller
</pre></div>
</div>
</li>
<li><p>Logs generated by U25N hardware are saved to a file.The logs are collected from the internal processing subsystem and exported to the host at frequent intervals. Currently these logs are populated when switchdev mode is enabled.</p>
<p>Path to read the logs in host : <code class="docutils literal notranslate"><span class="pre">/var/log/ps_dmesg.txt</span></code></p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sfreport</span></code> - A command line utility that generates a diagnostic log file providing diagnostic data about the server and Solarflare adapters.
Please refer to SF-103837-CD Solarflare Server Adapter User Guide chapter 5.20 for more details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">top</span></code> - This command can be used to show the linux processes or threads. It provides a real time view of the running system. It can be used to detect memory leaks. The file in the linux path /proc/meminfo can also be used for detecting memory leaks.</p>
<p>Watch out for the total memory already in use. Memory leak can be identified by running the command multiple times and checking whether the memory usage keeps on increasing.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ps</span></code> - This command displays relevant information about active processes.</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ps -aux <span class="p">|</span> grep sfc
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ethtool</span></code> - This command can be used to understand the driver related information such as version, firmware info and the enabled features.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -i &lt;interface_name&gt;
</pre></div>
</div>
<p>Example Usage:	ethtool -i u25eth0</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Expected result: 
driver: sfc
version: <span class="m">5</span>.3.3.2000.1
firmware-version: <span class="m">7</span>.8.7.1005 rx0 tx0
expansion-rom-version: 
bus-info: <span class="m">0000</span>:3b:00.0
supports-statistics: yes
supports-test: yes
supports-eeprom-access: no
supports-register-dump: yes
supports-priv-flags: yes
</pre></div>
</div>
<p>To get the information of the state of protocol offload and other features</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -k &lt;interface_name&gt;
</pre></div>
</div>
<p>Example Usage:	ethtool -k u25eth0</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Expected result: 
Features <span class="k">for</span> enp59s0f1np1:
rx-checksumming: on
tx-checksumming: on
   tx-checksum-ipv4: on
   tx-checksum-ip-generic: off <span class="o">[</span>fixed<span class="o">]</span>
   tx-checksum-ipv6: on
   tx-checksum-fcoe-crc: off <span class="o">[</span>fixed<span class="o">]</span>
   tx-checksum-sctp: off <span class="o">[</span>fixed<span class="o">]</span>
scatter-gather: on
   tx-scatter-gather: on
   tx-scatter-gather-fraglist: off <span class="o">[</span>fixed<span class="o">]</span>
tcp-segmentation-offload: on
   tx-tcp-segmentation: on
   tx-tcp-ecn-segmentation: on
   tx-tcp-mangleid-segmentation: off
   tx-tcp6-segmentation: on
generic-segmentation-offload: on
generic-receive-offload: on
large-receive-offload: off
</pre></div>
</div>
<p>To change the offload parameters and other features of the network device</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -K &lt;interface_name&gt; &lt;feature&gt; &lt;on/off&gt;
</pre></div>
</div>
<p>To get information about NIC Statistics</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ethtool -S &lt;interface_name&gt;
</pre></div>
</div>
<p>Example usage: ethtool -S enp59s0f1np1</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```bash
Expected result:
NIC statistics:
   rx_noskb_drops: 0
   rx_nodesc_trunc: 0
   port_tx_bytes: 59052
   port_tx_packets: 353
   port_tx_pause: 0
   port_tx_control: 0
   port_tx_unicast: 0
   port_tx_multicast: 273
   port_tx_broadcast: 80
   port_tx_lt64: 0
   port_tx_64: 0
   port_tx_65_to_127: 229
   port_tx_128_to_255: 44
   port_tx_256_to_511: 80
   port_tx_512_to_1023: 0
   port_tx_1024_to_15xx: 0
   port_tx_15xx_to_jumbo: 0
   port_rx_bytes: 0
   port_rx_good_bytes: 0
   port_rx_bad_bytes: 0
   port_rx_packets: 0
```
</pre></div>
</div>
<p><strong><em>NOTE</em>:</strong> ethtool functionalities for sfc driver can also be realised using the sfctool utility also. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfctool -S &lt;interface_name&gt;
</pre></div>
</div>
<p>Example Usage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sfctool -S u25eth0
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">u25n_update</span></code> Application: u25n_update utility can be used to read the U25N shell version.
For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./utils/u25n_update get-version &lt;PF0_interface&gt; 
</pre></div>
</div>
</li>
<li><p>MCDI Logging - Mcdi request and response data will be visible in dmesg if we activate mcdi logs. To activate the logs in dmesg.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="m">1</span> &gt;&gt; /sys/class/net/&lt;interface_name&gt;/device/mcdi_logging
</pre></div>
</div>
</li>
<li><p>OVS log levels - It can be turned on/off using the ovs-appctl commands.</p>
<p>The ovs-vswitchd accepts the option –log-file[=file] to enable logging to a specific file. The file argument is actually optional, so if it is specified, it is used as the exact name for the log file. The default is used if the file is not specified. Usually the default is /usr/local/var/log/openvswitch/ovs-vswitchd.log</p>
<p>Setting OVS Log levels:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ovs-appctl vlog/set ANY:ANY:dbg
ovs-appctl vlog/set poll_loop:ANY:OFF
ovs-appctl vlog/set netlink_socket:ANY:OFF
</pre></div>
</div>
</li>
<li><p>MAE Rules - To see the offloaded rules available in the MAE, check the below file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat /sys/kernel/debug/sfc/if_&lt;interface_name&gt;/mae_rules
</pre></div>
</div>
<p>To check the default rules in MAE, check the below file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat /sys/kernel/debug/sfc/if_&lt;interface_name&gt;/mae_default_rules
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">iperf3</span></code> - Iperf is a tool for network performance measurement and tuning. It is a cross-platform tool that can produce standardized performance measurements for any network. It has client and server functionality, and can create data streams to measure the throughput between the interfaces. After setting proper ip addresses:</p>
<p>Server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>iperf3 -s &lt;options&gt;
</pre></div>
</div>
<p>Client :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>iperf -c &lt;ip_addr_interface&gt; &lt;options&gt;
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">tcpdump</span></code> -  Tcpdump is a packet sniffing and packet analyzing tool meant for System Administrators to troubleshoot connectivity issues in Linux. For example it can capture the packets coming to the network interface using the below command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tcpdump -i &lt;interface_name&gt;
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">conntrack</span></code> - get connection status and track connection process</p>
<p>Get connection status</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conntrack -L
</pre></div>
</div>
<p>Track connection process</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conntrack -E
</pre></div>
</div>
<p>Check U25N offloaded connection</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat /sys/kernel/debug/sfc/if_&lt;PF_interface&gt;/tracked_conns <span class="p">|</span> grep 0xfff <span class="p">|</span> wc -l
</pre></div>
</div>
</li>
</ul>
</section>
</section>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ug1534-dpdk.html" class="btn btn-neutral float-right" title="DPDK" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ug1534-installation.html" class="btn btn-neutral float-left" title="3. U25N Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on Nov 6, 2023.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
														
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<div class="lang-select dropup hidden-md hidden-lg">
		<button data-toggle="dropdown">
			<span class="fas fa-globe" aria-hidden="true"></span>
			<span>
				
					English
				</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a target="_blank" href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
																	<div class="lang-select dropup hidden-xs hidden-sm">
	<button data-toggle="dropdown">
		<span class="fas fa-globe" aria-hidden="true"></span>
		<span>
			
				English
			</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
															</div>
														</div>
														<div class="col-md-pull-5 col-lg-pull-5 col-md-5 col-lg-5">
															<span class="copyright">©2023 Advanced Micro Devices, Inc</span>
														</div>

													</div>
													                    <div class="movethisrowtoleft row">
                        <div class="col-xs-24">
                            <ul class="sub-menu">
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a></li>
								<li><a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a></li>
                                <li><a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></li>
                            </ul>
                        </div>
                    </div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
<div class="backToTop parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><noindex>
    <span data-component="backToTopButton" class="backToTopButton loaded">
        <ul>
            <li>
                <a href="https://www.author.xilinx.com/xx/rebrand/amd/en-amd-xilinx-header-footer.html#top" class="btn top">
                    <span class="fas fa-angle-up" aria-hidden="true"></span>
                </a>
            </li>
        </ul>
    </span>
</noindex></div>
			</div>
		</div>


		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>