


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

	<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="37701bd4-e5c0-4ee3-9329-e7475d0b13a7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
		<!-- Google Tag Manager -->
	<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
	<!-- End Google Tag Manager -->
	
        <!-- Google Tag Manager -->
        <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
        <!-- End Google Tag Manager -->	

  
  
  
  

  
      <script type="text/javascript" src="../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../_static/js/Searchbox.min.js"></script>
    <script type="text/javascript" src="../_static/js/header-footer.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DPDK" href="ug1534-dpdk.html" />
    <link rel="prev" title="U25N Installation" href="ug1534-installation.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
 <div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">

    
    

    



<div class="xf-content-height">
    

<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
    
    <div class="header parbase aem-GridColumn aem-GridColumn--default--12"><noindex>
	<header data-component="header" class="site-header">
		<nav class="navbar navbar-default">
			<div class="container-fluid main-nav">
				<div class="row">
					<div class="navbar-column col-xs-4 col-sm-5">
						<ul class="nav navbar-nav hidden-xs">
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
								</li>
							</ul>
							
						<ul class="nav navbar-nav hidden-sm hidden-md hidden-lg">
							<li>
									<button data-target="#header-container-0" data-function="toggle">Solutions</button>
								</li>
							<li>
									<button data-target="#header-container-1" data-function="toggle">Products</button>
								</li>
							<li>
									<button data-target="#header-container-2" data-function="toggle">Company</button>
								</li>
							</ul>
							
						<div id="header-container-0" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-1" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-2" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							</div>
					<div class="logo-column col-xs-4 col-sm-2">
						<div class="logo">
							<a target="_blank" href="https://www.xilinx.com/">
								<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
							</a>
						</div>
					</div>

				</div>
			</div>
			</nav></header></noindex></div>
		
	
</div>

    
</div>
</div>

<div class="calloutBanner parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><div class="callout-banner">
    Xilinx is now a part of <a target="_blank" href="https://www.amd.com/en/corporate/xilinx-acquisition">AMD</a> |  <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Learn More</a>
</div>
</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> U25N
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">U25N</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ug1534-introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-supportedservices.html">Supported Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-installation.html">U25N Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Detailed Applications Description</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#legacy-and-switchdev-modes">Legacy and Switchdev Modes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#legacy-nic-default">Legacy NIC (Default)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#switchdev-mode">Switchdev Mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ovs">OVS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-ovs">Installing OVS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#classification-fields-matches">Classification Fields (Matches)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#port-to-port">Port to Port</a></li>
<li class="toctree-l3"><a class="reference internal" href="#port-to-vm-or-vm-to-port">Port to VM or VM to Port</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vm-to-vm">VM to VM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tunnels-encapsulation-decapsulation">Tunnels (Encapsulation/Decapsulation)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#l2gre">L2GRE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vxlan">VXLAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vm-to-vm-or-vm-to-port-or-port-to-vm-tunnel">VM to VM or VM to Port or Port to VM Tunnel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ovs-configuration">OVS Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functionality-check">Functionality Check</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ping-test">Ping Test</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#statistics">Statistics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ipsec">IPsec</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supported-xfrm-parameters">Supported XFRM Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Classification Fields (Matches)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#encryption">Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decryption">Decryption</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#strongswan-installation">strongSwan Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">Server 1 Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">Server 2 Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#server-1-steps-to-run-ipsec">Server 1: Steps to Run IPsec</a></li>
<li class="toctree-l4"><a class="reference internal" href="#server-2-steps-to-run-ipsec">Server 2: Steps to Run IPsec</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Statistics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#stateless-firewall">Stateless Firewall</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#kernel-upgrade">Kernel Upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nftables">nftables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">Classification Fields (Matches)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#driver-installation">Driver Installation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id10">Statistics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ovs-commands">OVS Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mae-rules">MAE Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ipsec-statistics">IPsec Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#external-mac-counter">External MAC counter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#debug-commands">Debug Commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-dpdk.html">DPDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-shellprogramming.html">U25N Shell Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="ug1534-vminstall.html">VM Installation</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../_sources/docs/ug1534-detailedappsdescriptions.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">U25N</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Detailed Applications Description</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/docs/ug1534-detailedappsdescriptions.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="detailed-applications-description">
<h1>Detailed Applications Description<a class="headerlink" href="#detailed-applications-description" title="Permalink to this headline">¶</a></h1>
<div class="section" id="legacy-and-switchdev-modes">
<h2>Legacy and Switchdev Modes<a class="headerlink" href="#legacy-and-switchdev-modes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="legacy-nic-default">
<h3>Legacy NIC (Default)<a class="headerlink" href="#legacy-nic-default" title="Permalink to this headline">¶</a></h3>
<p>Packets from the external MAC0 are forwarded to the internal MAC2 without any modifications on flow entry miss, and vice versa. Similarly, packets from the external MAC1 are forwarded to the internal MAC3 without any modifications on flow entry miss, and vice versa.</p>
<p><em>Figure 5:</em> <strong>Legacy Mode</strong></p>
<p><img alt="X25712-091321" src="../_images/cgl1631062304607_LowRes.png" /></p>
</div>
<div class="section" id="switchdev-mode">
<h3>Switchdev Mode<a class="headerlink" href="#switchdev-mode" title="Permalink to this headline">¶</a></h3>
<p>When changed to switchdev mode, the U25N can support OVS switching. Devlink features are added to the PF0 interface in each adapter to support the switch mode. Switchdev mode can be added for a single adapter or both. A new representor network interface comes up for each VF when a VM is connected to the VF via SR-IOV virtual ports provided by X2 VNICs.</p>
<p><em>Figure 6:</em> <strong>Switchdev Mode</strong></p>
<p><img alt="X25549-091321" src="../_images/lpe1631063727073_LowRes.png" /></p>
</div>
</div>
<div class="section" id="ovs">
<h2>OVS<a class="headerlink" href="#ovs" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installing-ovs">
<h3>Installing OVS<a class="headerlink" href="#installing-ovs" title="Permalink to this headline">¶</a></h3>
<p>OVS is a multilayer software switch licensed under the open source Apache 2 license. It implements a production quality switch platform that supports standard management interfaces and opens the forwarding functions to programmatic extension and control. OVS is well suited to function as a virtual switch in VM environments. Carry out the following step to install OVS:</p>
<ol>
<li><p>The OVS source code is its Git repository, which you can clone into a directory named ovs with the git clone command (see <a class="reference external" href="https://github.com/openvswitch/ovs.git">https://github.com/openvswitch/ovs.git</a>).</p></li>
<li><p>After it has been cloned, the ovs directory will be in the current directory path. Move inside the ovs directory using the cd command. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">ovs</span>
</pre></div>
</div>
</li>
<li><p>Execute the following commands one by one as the root user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">boot</span><span class="o">.</span><span class="n">sh</span>
<span class="o">./</span><span class="n">configure</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j8</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</li>
<li><p>Export the path:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export PATH=$PATH:/usr/local/share/openvswitch/scripts
</pre></div>
</div>
</li>
<li><p>Perform a version check:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vswitchd</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Version 2.12 and 2.14 have been tested.</p>
</li>
</ol>
<p>Maximum flows supported: 8k</p>
</div>
<div class="section" id="classification-fields-matches">
<h3>Classification Fields (Matches)<a class="headerlink" href="#classification-fields-matches" title="Permalink to this headline">¶</a></h3>
<p>Key</p>
<ol class="simple">
<li><p>ipv4/ipv6 src_ip</p></li>
<li><p>ipv4/ipv6 dst_ip</p></li>
<li><p>ip_tos</p></li>
<li><p>ip_proto</p></li>
<li><p>ovlan Outer</p></li>
<li><p>ivlan Inner</p></li>
<li><p>ether_type</p></li>
<li><p>tcp/udp src_port</p></li>
<li><p>tcp/udp dst_port</p></li>
<li><p>src_mac</p></li>
<li><p>dst_mac</p></li>
<li><p>vni</p></li>
<li><p>Ingress port</p></li>
</ol>
<p>Action</p>
<ol class="simple">
<li><p>do_decap</p></li>
<li><p>do_decr_ip_ttl</p></li>
<li><p>do_src_mac</p></li>
<li><p>do_dst_mac</p></li>
<li><p>do_vlan_pop</p></li>
<li><p>do_vlan_push</p></li>
<li><p>do_encap</p></li>
<li><p>do_deliver</p></li>
</ol>
</div>
<div class="section" id="port-to-port">
<h3>Port to Port<a class="headerlink" href="#port-to-port" title="Permalink to this headline">¶</a></h3>
<p>The U25N PF is added to the OVS bridge. Packets are sent at an external MAC, and OVS does the switching based on the packet received.</p>
<ol>
<li><p>Refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/ software version.</p></li>
<li><p>If the U25N driver version is 5.3.3.1003, ignore this step. Check the driver version of the U25N interface using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p>This should give the output as version 5.3.3.1003.</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.md#u25n-driver">U25N Driver</a>.</p>
</li>
<li><p>Make both PF interfaces up:</p>
<ol>
<li><p>List the interfaces using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command.</p></li>
<li><p>Find the U25N interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">u25_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25_eth0</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="n">U25_eth1</span> <span class="n">up</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Make the PF interfaces into switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives us the PCIe® device bus ID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.0</span> <span class="n">mode</span> <span class="n">switchdev</span>
<span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.1</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
</li>
<li><p>Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.md#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, continue to the next step.</p></li>
<li><p>Add external ports to the OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="o">&lt;</span><span class="n">PF</span> <span class="n">interface</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">U25_eth0</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">U25_eth1</span>
</pre></div>
</div>
</li>
<li><p>Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
<p>Refer to <a class="reference external" href="link">Functionality Check</a> to check the OVS functionality.</p>
</li>
</ol>
<p><em>Figure 7:</em> <strong>Port to Port</strong></p>
<p><img alt="X25550-090721 this seems messed up and missing a portion" src="../_images/cfd1631064119641_LowRes.png" /></p>
</div>
<div class="section" id="port-to-vm-or-vm-to-port">
<h3>Port to VM or VM to Port<a class="headerlink" href="#port-to-vm-or-vm-to-port" title="Permalink to this headline">¶</a></h3>
<p><strong><em>Note</em>:</strong> SR-IOV must be enabled in BIOS. For the Port to VM or VM
to Port case, a tunnel could be created with two server setups. Here
the tunnel can be VXLAN or L2GRE.</p>
<ol>
<li><p>Refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version. For VM use cases, VFs need to be created at the corresponding PF for binding to the VM. The number of VF counts should be configured in the sfboot command and in sriov_numvfs.</p>
<p><strong><em>Note</em>:</strong> For more information, refer to <a class="reference external" href="link">sfboot Configuration</a>.</p>
</li>
<li><p>Check the driver version of the U25N interface using the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N driver version is 5.3.3.1003.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p>This should give the output as version 5.3.3.1003.</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">U25N Driver</a>.</p>
<p><strong><em>Note</em>:</strong> Refer to <a class="reference external" href="link">Deployment Image Flashing</a> for flashing images to check OVS functionality.</p>
</li>
<li><p>Make the U25N PF interface up:</p>
<p>a. List the PF interface using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command.</p>
<p>b. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">U25_eth0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>driver: sfc</p>
<p>version: 5.3.3.1003</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">U25_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25eth0</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Allocate the number of VF to PF. Here, a single VF is allocated to the PF0 interface:</p>
<p><strong><em>Note</em>:</strong> The VF could also be created in the PF1 interface based on use case. The sriov_numvfs count should be less than or equal to the VF count given in the sfboot command. The sriov_numvfs should be done only in legacy mode. To check the U25N mode, excecute the following steps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="n">show</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pci_id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The output of the above command would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.0</span> <span class="n">mode</span> <span class="n">legacy</span>
</pre></div>
</div>
<p>If not in legacy mode, change to legacy mode using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">legacy</span>
<span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/&lt;</span><span class="n">interface</span><span class="o">&gt;/</span><span class="n">device</span><span class="o">/</span><span class="n">sriov_numvfs</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">U25_eth0</span><span class="o">/</span><span class="n">device</span><span class="o">/</span><span class="n">sriov_numvfs</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> After the above command is executed, a VF PCIe ID and VF interface are created. The VF PCIe device ID can be listed with the command <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d</span> <span class="pre">1924:1b03</span></code>. An example of the device ID is 86:00.2 Ethernet controller: Solarflare Communications XtremeScale SFC9250 10/25/40/50/100G Ethernet Controller (Virtual Function) (rev 01). This VF PCIe ID is used for binding the VF to a VM.</p>
</li>
<li><p>The VF interface can be found using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. To differentiate VF from PF, use the ip link show command. This gives the VF interface ID and VF interface mac address under the PF interface.</p></li>
<li><p>Make the VF interface up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">vf_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Make the PF interfaces into switchdev mode:</p>
<p><strong><em>Note</em>:</strong> Make sure the PF interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">devlink</span> <span class="pre">dev</span> <span class="pre">eswitch</span> <span class="pre">set</span> <span class="pre">pci/0000:af:00.0</span> <span class="pre">mode</span> <span class="pre">switchdev</span></code>.</p>
</li>
<li><p>Running the above command creates a VF representor interface. The VF representor interface name will be the PF interface name followed by <code class="docutils literal notranslate"><span class="pre">_0</span></code> for the first VF representor and <code class="docutils literal notranslate"><span class="pre">_1</span></code> for the second V representor, and so on.</p>
<p><strong><em>Note</em>:</strong> Here, the number of VF representor interfaces created is based on the sriov_numvfs value configured.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">link</span> <span class="n">show</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">&lt;</span><span class="n">PF_interface</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">show</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&lt;u25eth0&gt;</span></code>.</p>
<p><strong><em>Note</em>:</strong> Here u25eth0 is the PF interface and u25eth0_0 is the VF representor interface.</p>
<p>Now make the VF representor interface up using the ifconfig command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">vf_rep_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.md#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p></li>
<li><p>Add PF interfaces as ports to the OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="o">&lt;</span><span class="n">x2</span> <span class="n">interface</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ovs-vsctl</span> <span class="pre">add-port</span> <span class="pre">br0</span> <span class="pre">U25eth0</span></code>.</p>
</li>
<li><p>Add a VF representator interface as a port to the OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">VF</span> <span class="n">rep</span> <span class="n">interface</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ovs-vsctl</span> <span class="pre">add-port</span> <span class="pre">br0</span> <span class="pre">U25eth0_0</span></code>.</p>
</li>
<li><p>Make the OVS bridge up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
</li>
<li><p>Refer to <a class="reference external" href="link">VM Installation</a> to make the VM up. After the VM is up, proceed to the next step to check functionality.</p></li>
<li><p>Refer to <a class="reference external" href="link">Functionality Check</a> to check OVS functionality.</p></li>
</ol>
<p><em>Figure 8:</em> <strong>Port to VM or VM to Port</strong></p>
<p><img alt="seems messed up a little bit X25551-090721" src="../_images/cgm1631064433686_LowRes.png" /></p>
</div>
<div class="section" id="vm-to-vm">
<h3>VM to VM<a class="headerlink" href="#vm-to-vm" title="Permalink to this headline">¶</a></h3>
<p><strong><em>Note</em>:</strong> SR-IOV must be enabled in BIOS. For a VM to VM case, a
tunnel could be created with two server setups. Here the tunnel can be
VXLAN or L2GRE.</p>
<ol>
<li><p>Refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">U25N Driver</a> for the required OS/software version. For VM use cases, VFs need to be created at the corresponding PF for binding to the VM. The number of VF counts should be configured in the sfboot command and in sriov_numvfs. Offload will occur only between VMs created using same the PF’s VF.</p>
<p><strong><em>Note</em>:</strong> For more information, refer to sfboot Configuration.</p>
</li>
<li><p>Check the driver version of the U25N interface using the following command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N driver version is 5.3.3.1003.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p>This should give the output as version 5.3.3.1003.</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">U25N Driver</a>.</p>
<p><strong><em>Note</em>:</strong> Refer to <a class="reference external" href="link">Deployment Image Flashing</a> for flashing images to check OVS functionality.</p>
</li>
<li><p>Make the U25N X2 PF interface up:</p>
<ol>
<li><p>List the PF interface using the ifconfig -a command.</p></li>
<li><p>Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">U25_eth0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>driver: sfc</p>
<p>version: 5.3.3.1003</p>
<p><code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">&lt;U25_interface&gt;</span> <span class="pre">up</span></code></p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25eth0</span> <span class="n">up</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Allocate the number of VF to PF. Here, two VFs are allocated to the PF0 interface:</p>
<p><strong><em>Note</em>:</strong> The VF could also be created in the PF1 interface based on the use case. The sriov_numvfs count should be less than or equal to the VF count given in the sfboot command. The sriov_numvfs should be done only in legacy mode. To check the U25N mode, execute the following steps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="n">show</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pci_id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The output of the above command would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.0</span> <span class="n">mode</span> <span class="n">legacy</span>
</pre></div>
</div>
<p>If not in legacy mode, change to legacy mode using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">legacy</span>
<span class="n">echo</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/&lt;</span><span class="n">interface</span><span class="o">&gt;/</span><span class="n">device</span><span class="o">/</span><span class="n">sriov_numvfs</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mi">1</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">U25_eth0</span><span class="o">/</span><span class="n">device</span><span class="o">/</span><span class="n">sriov_numvfs</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> After the above command is executed, two VF PCIe IDs and two VF interfaces are created. The VF PCIe device ID can be listed with the <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d</span> <span class="pre">1924:1b03</span></code> command. An example of the device ID is <em>af:00.2 Ethernet controller: Solarflare Communications XtremeScale SFC9250 10/25/40/50/100G Ethernet Controller (Virtual Function) (rev 01)</em> and <em>af:00.3 Ethernet controller: Solarflare Communications XtremeScale SFC9250 10/25/40/50/100G Ethernet Controller (Virtual Function) (rev 01)</em>. These VF PCIe IDs would be used for binding VFs to VMs.</p>
</li>
<li><p>The two VF interfaces can be found using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. To differentiate VF from PF, use the <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">show</span></code> command. This gives the VF interface ID and VF interface mac address under the PF interface.</p></li>
<li><p>Make the two VF interfaces up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">vf_interfaceup</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>Make the PF interfaces into switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">devlink</span> <span class="pre">dev</span> <span class="pre">eswitch</span> <span class="pre">set</span> <span class="pre">pci/0000:af:00.0</span> <span class="pre">mode</span> <span class="pre">switchdev</span></code>.</p>
</li>
<li><p>Running the above command creates two VF representor interfaces. The VF representor interface name will be the PF interface name and <code class="docutils literal notranslate"><span class="pre">_0</span></code> for the first VF representor and <code class="docutils literal notranslate"><span class="pre">_1</span></code> for the second VF representor.</p>
<p><strong><em>Note</em>:</strong> Here, the number of VF representor interfaces created is based on the sriov_numvfs value configured.</p>
<p>ip link show | grep &lt;PF_interface&gt;</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">&lt;ip</span> <span class="pre">link</span> <span class="pre">show</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&lt;u25eth0&gt;</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u25eth0</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">mq</span> <span class="n">state</span> <span class="n">UP</span>
<span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">group</span> <span class="n">default</span> <span class="n">qlen</span> <span class="mi">1000</span>
<span class="n">u25eth0_0</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">fq_codel</span>
<span class="n">master</span> <span class="n">ovs</span><span class="o">-</span><span class="n">system</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">group</span> <span class="n">default</span> <span class="n">qlen</span> <span class="mi">1000</span>
<span class="n">u25eth0_1</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">fq_codel</span>
<span class="n">master</span> <span class="n">ovs</span><span class="o">-</span><span class="n">system</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">group</span> <span class="n">default</span> <span class="n">qlen</span> <span class="mi">1000</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Here u25eth0 is the PF interface, and u25eth0_0 and u25eth0_1 are the VF representor interfaces.</p>
<p>Now make the VF representor interfaces up using the ifconfig command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">vf_rep_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Follow the steps mentioned in OVS Configuration to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p></li>
<li><p>Add two VF representator interfaces to the OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">VF</span> <span class="n">rep</span> <span class="n">interface</span> <span class="mi">1</span><span class="o">&gt;</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">VF</span> <span class="n">rep</span> <span class="n">interface</span> <span class="mi">2</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">u25eth0_0</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">u25eth0_1</span>
</pre></div>
</div>
</li>
<li><p>Make the OVS bridge up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
</li>
<li><p>Refer to <a class="reference internal" href="ug1534-vminstall.html"><span class="doc">VM Installation</span></a> to make the VM up. After the VM is up, proceed to the next step to check functionality.</p></li>
<li><p>Refer to [Functionality Check(link)] to check OVS functionality.</p></li>
</ol>
<p><em>Figure 9:</em> <strong>VM to VM</strong></p>
<p><img alt="X25552-090721 might be messed up" src="../_images/cxa1631064658045_LowRes.png" /></p>
</div>
<div class="section" id="tunnels-encapsulation-decapsulation">
<h3>Tunnels (Encapsulation/Decapsulation)<a class="headerlink" href="#tunnels-encapsulation-decapsulation" title="Permalink to this headline">¶</a></h3>
<p>U25N hardware supports offloading of tunnels using encapsulation and decapsulation actions.</p>
<ul class="simple">
<li><p><strong>Encapsulation:</strong> Pushing of tunnel header is supported on TX</p></li>
<li><p><strong>Decapsulation:</strong> Popping of tunnel header is supported on RX</p></li>
</ul>
<p>Supported tunnels:</p>
<ul class="simple">
<li><p>VXLAN</p></li>
<li><p>L2GRE</p></li>
</ul>
<div class="section" id="l2gre">
<h4>L2GRE<a class="headerlink" href="#l2gre" title="Permalink to this headline">¶</a></h4>
<p><strong><em>Note</em>:</strong> For Port to VM or VM to Port or VM to VM case, a tunnel
could be created with two server setups. Here the tunnel can be L2GRE.</p>
<ul class="simple">
<li><p>Maximum tunnel support = 1K</p></li>
<li><p>Maximum supported flows = 8K</p></li>
<li><p>Maximum MTU size = 1400</p></li>
</ul>
<p>Refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version. An L2GRE tunnel can be formed between two servers. Tunnel endpoint IP should be added to the PF interface where the tunnel needs to be created.</p>
<p><strong><em>Note</em>:</strong> Two tunnels could be formed between two PFs of U25N SmartNICs in two different servers for the VM to VM case.</p>
<div class="section" id="server-1-configuration">
<h5><strong>Server 1 Configuration</strong><a class="headerlink" href="#server-1-configuration" title="Permalink to this headline">¶</a></h5>
<ol>
<li><p>Check the driver version of the U25N interface using this command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N driver version is 5.3.3.1003.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p>This should give the output as version 5.3.3.1003</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to U25N Driver.</p>
<p><strong><em>Note</em>:</strong> Refer to Deployment Image Flashing for flashing images to check OVS functionality.</p>
</li>
<li><p>Make the U25N PF interfaces up:</p>
<p>List the PF interfaces using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">U25_eth0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>driver: sfc</p>
<p>version: 5.3.3.1003</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">U25_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25eth0</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="n">U25eth1</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Assign tunnel IP to PF0 interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, ifconfig U25eth0 10.16.0.2/24 up.</p>
</li>
<li><p>Make PF0 interface into switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.0</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
</li>
<li><p>Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.md#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p></li>
<li><p>Create GRE interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="n">gre0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">gre0</span> <span class="nb">type</span><span class="o">=</span><span class="n">gre</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">gre0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">gre0</span> <span class="nb">type</span><span class="o">=</span><span class="n">gre</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=</span><span class="mf">10.16.0.2</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=</span><span class="mf">10.16.0.1</span>
</pre></div>
</div>
</li>
<li><p>Add a PF1 interface as a port to the OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">U25N</span> <span class="n">interface_2</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">U25eth1</span>
</pre></div>
</div>
</li>
<li><p>Make the bridge up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">br0</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="server-2-configuration">
<h5>Server 2 Configuration<a class="headerlink" href="#server-2-configuration" title="Permalink to this headline">¶</a></h5>
<ol>
<li><p>Check the driver version of the U25N interface using this command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N X2 driver version is 5.3.3.1003.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p>This should give the output as version 5.3.3.1003.</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">U25N Driver</a>.</p>
</li>
<li><p>Make the U25N PF interfaces up:</p>
<p>List the PF interfaces using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">U25_eth0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>driver: sfc</p>
<p>version: 5.3.3.1000</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">U25_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
</li>
<li><p>Assign tunnel IP to PF0 interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25eth0</span> <span class="mf">10.16.0.1</span><span class="o">/</span><span class="mi">24</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Make PF0 interface into switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.0</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
</li>
<li><p>Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.md#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p></li>
<li><p>Create GRE interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="n">gre0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">gre0</span> <span class="nb">type</span><span class="o">=</span><span class="n">gre</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">gre0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">gre0</span> <span class="nb">type</span><span class="o">=</span><span class="n">gre</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=</span><span class="mf">10.16.0.1</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=</span><span class="mf">10.16.0.2</span>
</pre></div>
</div>
</li>
<li><p>Add a PF1 interface as a port to the OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">U25N</span> <span class="n">interface_2</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">U25eth1</span>
</pre></div>
</div>
</li>
<li><p>Make the bridge up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">br0</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
</li>
<li><p>Refer to <a class="reference external" href="link">Functionality Check</a> to check OVS functionality.</p></li>
</ol>
<p><em>Figure 10:</em> <strong>L2GRE</strong></p>
<p><img alt="X25553-091321" src="../_images/idz1631575855541_LowRes.png" /></p>
</div>
</div>
<div class="section" id="vxlan">
<h4>VXLAN<a class="headerlink" href="#vxlan" title="Permalink to this headline">¶</a></h4>
<p><strong><em>Note</em>:</strong> For Port to VM or VM to Port or VM to VM case, a tunnel could be created with two server setups. Here the tunnel can be VXLAN.</p>
<ul class="simple">
<li><p>Maximum tunnel support = 1K</p></li>
<li><p>Maximum supported flows = 8K</p></li>
<li><p>Maximum MTU size = 1400</p></li>
</ul>
<p>Refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version. A VXLAN tunnel can be formed between two servers. Tunnel endpoint IP should be added to the PF interface where the tunnel needs to be created.</p>
<div class="section" id="id1">
<h5>Server 1 Configuration<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<ol>
<li><p>Check the driver version of the U25N interface using this command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N X2 driver version is 5.3.3.1003.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p>This should give the output as version 5.3.3.1003.</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">U25N Driver</a>.</p>
<p><strong><em>Note</em>:</strong> Refer to Deployment Image Flashing for flashing images to check OVS functionality.</p>
</li>
<li><p>Make the U25N PF interfaces up:</p>
<p>List the PF interfaces using the ifconfig -a command. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">U25_eth0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>driver: sfc</p>
<p>version: 5.3.3.1003</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">U25_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25eth0</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="n">U25eth1</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Assign tunnel IP to PF0 interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25eth0</span> <span class="mf">10.16.0.2</span><span class="o">/</span><span class="mi">24</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Make PF0 interface into switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">devlink</span> <span class="pre">dev</span> <span class="pre">eswitch</span> <span class="pre">set</span> <span class="pre">pci/0000:af:00.0</span> <span class="pre">mode</span> <span class="pre">switchdev</span></code>.</p>
</li>
<li><p>Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.md#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p></li>
<li><p>Create VXLAN interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">vxlan0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">vxlan0</span> <span class="nb">type</span><span class="o">=</span><span class="n">vxlan</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span>
<span class="n">options</span><span class="p">:</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">key_id</span><span class="o">&gt;</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">vxlan0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">vxlan0</span> <span class="nb">type</span><span class="o">=</span><span class="n">vxlan</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=</span><span class="mf">10.16.0.2</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=</span><span class="mf">10.16.0.1</span> <span class="n">options</span><span class="p">:</span><span class="n">key</span><span class="o">=</span><span class="mi">123</span>
</pre></div>
</div>
</li>
<li><p>Add a PF1 interface as a port to the OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">U25N</span> <span class="n">interface_2</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ovs-vsctl</span> <span class="pre">add-port</span> <span class="pre">br0</span> <span class="pre">U25eth1</span></code>.</p>
</li>
<li><p>Make the bridge up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">br0</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id2">
<h5>Server 2 Configuration<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<ol>
<li><p>Check the driver version of the U25N X2 interface using this command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N driver version is 5.3.3.1003.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p>This should give the output as version 5.3.3.1003.</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to U25N Driver.</p>
</li>
<li><p>Make the U25N PF interfaces up:</p>
<p>List the PF interfaces using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">U25_eth0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>driver: sfc</p>
<p>version: 5.3.3.1003</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">U25_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25eth0</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="n">U25eth1</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Assign tunnel IP to PF0 interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25eth0</span> <span class="mf">10.16.0.1</span><span class="o">/</span><span class="mi">24</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Make PF0 interface into switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.0</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
</li>
<li><p>Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.md#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p></li>
<li><p>Create VXLAN interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">vxlan0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">vxlan0</span> <span class="nb">type</span><span class="o">=</span><span class="n">vxlan</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span>
<span class="n">options</span><span class="p">:</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">key_id</span><span class="o">&gt;</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">vxlan0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">vxlan0</span> <span class="nb">type</span><span class="o">=</span><span class="n">vxlan</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=</span><span class="mf">10.16.0.1</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=</span><span class="mf">10.16.0.2</span> <span class="n">options</span><span class="p">:</span><span class="n">key</span><span class="o">=</span><span class="mi">123</span>
</pre></div>
</div>
</li>
<li><p>Add a PF1 interface as a port to the OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">U25N</span> <span class="n">interface_2</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">U25eth1</span>
</pre></div>
</div>
</li>
<li><p>Make the bridge up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">br0</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
</li>
<li><p>Refer to <a class="reference external" href="link">Functionality Check</a> to check OVS functionality.</p></li>
</ol>
<p><em>Figure 11:</em> <strong>VXLAN</strong></p>
<p><img alt="X25554-091321" src="../_images/rcv1631576075856_LowRes.png" /></p>
</div>
</div>
<div class="section" id="vm-to-vm-or-vm-to-port-or-port-to-vm-tunnel">
<h4>VM to VM or VM to Port or Port to VM Tunnel<a class="headerlink" href="#vm-to-vm-or-vm-to-port-or-port-to-vm-tunnel" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Maximum tunnel support = 1K</p></li>
<li><p>Maximum supported flows = 8K</p></li>
<li><p>Maximum MTU size = 1400</p></li>
</ul>
<p>Refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a>. A VXLAN tunnel can be formed between two
servers. Tunnel endpoint IP should be added to the PF interface where
the tunnel needs to be created.</p>
<div class="section" id="id3">
<h5>Server 1 Configuration<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<ol>
<li><p>Check the driver version of the U25N interface using this command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N X2 driver version is 5.3.3.1003.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p>This should give the output as version 5.3.3.1003.</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">U25N Driver</a>.</p>
<p><strong><em>Note</em>:</strong> Refer to <a class="reference external" href="link">Deployment Image Flashing</a> for flashing images to check OVS functionality.</p>
</li>
<li><p>Make the U25N PF interfaces up:</p>
<p>List the PF interfaces using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code> command.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">U25_eth0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Driver: sfc</p>
<p>Version: 5.3.3.1003</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">U25_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25eth0</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="n">U25eth1</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Assign tunnel IP to PF0 and PF1 interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_2</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_2</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Allocate the number of VF to PF. Here, one VF is allocated to the PF0 and PF1 interfaces:</p>
<p><strong><em>Note</em>:</strong> The sriov_numvfs count should be less than or equal to VF count given in sfboot command. The sriov_numvfs should be done only in legacy mode. To check mode, please follow the below steps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="n">show</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pci_id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The output of the above command would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.0</span> <span class="n">mode</span> <span class="n">legacy</span>
</pre></div>
</div>
<p>If not in legacy mode, change to legacy mode using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">legacy</span>
<span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/&lt;</span><span class="n">interface</span><span class="o">&gt;/</span><span class="n">device</span><span class="o">/</span><span class="n">sriov_numvfs</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">U25_eth0</span><span class="o">/</span><span class="n">device</span><span class="o">/</span><span class="n">sriov_numvfs</span>
<span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">U25_eth1</span><span class="o">/</span><span class="n">device</span><span class="o">/</span><span class="n">sriov_numvfs</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> After the above command is executed, a VF PCIe ID and a VF interface are created corresponding to each PF0 and PF1. The VF PCIe device ID can be listed with the <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d</span> <span class="pre">1924:1b03</span></code> command. An example of the device ID is af:00.2 Ethernet controller: Solarflare Communications XtremeScale SFC9250 10/25/40/50/100G Ethernet Controller (Virtual Function) (rev 01) and af:00.6 Ethernet controller: Solarflare Communications XtremeScale SFC9250 10/25/40/50/100G Ethernet Controller (Virtual Function) (rev 01). These VF PCIe IDs would be used for binding VFs to VMs.</p>
</li>
<li><p>The two VF interfaces can be found using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. To differentiate VF from PF, use the <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">show</span></code> command. This gives the VF interface ID and VF interface mac address under the PF interface.</p></li>
<li><p>Make the two VF interfaces up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">vf_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Make the PF0 and PF1 interfaces into switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 and PF1 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.0</span> <span class="n">mode</span> <span class="n">switchdev</span>
<span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.1</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
</li>
<li><p>Running the above command creates a VF representor interface
corresponding to each PF interface. The VF representor interface
name will be the PF interface name along with <code class="docutils literal notranslate"><span class="pre">_0</span></code>.</p>
<p><strong><em>Note</em>:</strong> Here, the number of VF representor created is based on the sriov_numvfs value configured.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">link</span> <span class="n">show</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">&lt;</span><span class="n">PF_interface</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">show</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&lt;u25eth0&gt;</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u25eth0</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">mq</span> <span class="n">state</span> <span class="n">UP</span>
<span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">group</span> <span class="n">default</span> <span class="n">qlen</span> <span class="mi">1000</span>
<span class="n">u25eth0_0</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">fq_codel</span>
<span class="n">master</span> <span class="n">ovs</span><span class="o">-</span><span class="n">system</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">group</span> <span class="n">default</span> <span class="n">qlen</span> <span class="mi">1000</span>
<span class="n">ip</span> <span class="n">link</span> <span class="n">show</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">&lt;</span><span class="n">u25eth1</span><span class="o">&gt;</span>
<span class="n">u25eth1</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">mq</span> <span class="n">state</span> <span class="n">UP</span>
<span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">group</span> <span class="n">default</span> <span class="n">qlen</span> <span class="mi">1000</span>
<span class="n">u25eth1_0</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">fq_codel</span>
<span class="n">master</span> <span class="n">ovs</span><span class="o">-</span><span class="n">system</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">group</span> <span class="n">default</span> <span class="n">qlen</span> <span class="mi">1000</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Here u25eth0 and u25eth1 are the PF interfaces, and u25eth0_0 and u25eth1_0 are the VF representor interfaces.</p>
<p>Now make the VF representor interfaces up using the ifconfig command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">vf_rep_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.md#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p></li>
<li><p>Create VXLAN/GRE interfaces:</p>
<p><strong><em>Note</em>:</strong> The following configuration is for the VXLAN. Similarly, the GRE tunnel could also be used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">vxlan0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">vxlan0</span> <span class="nb">type</span><span class="o">=</span><span class="n">vxlan</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span>
<span class="n">options</span><span class="p">:</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">key_id</span><span class="o">&gt;</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br1</span> <span class="n">vxlan1</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">vxlan0</span> <span class="nb">type</span><span class="o">=</span><span class="n">vxlan</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span>
<span class="n">options</span><span class="p">:</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">key_id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">vxlan0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">vxlan0</span> <span class="nb">type</span><span class="o">=</span><span class="n">vxlan</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=</span><span class="mf">10.16.0.2</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=</span><span class="mf">10.16.0.1</span> <span class="n">options</span><span class="p">:</span><span class="n">key</span><span class="o">=</span><span class="mi">123</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br1</span> <span class="n">vxlan1</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">vxlan</span> <span class="nb">type</span><span class="o">=</span><span class="n">vxlan</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=</span><span class="mf">10.16.0.3</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=</span><span class="mf">10.16.0.4</span> <span class="n">options</span><span class="p">:</span><span class="n">key</span><span class="o">=</span><span class="mi">456</span>
</pre></div>
</div>
</li>
<li><p>Adding VF representor of each PF interface to separate OVS bridge.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name_0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">VF</span> <span class="n">rep</span> <span class="n">interface</span> <span class="mi">1</span><span class="o">&gt;</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">VF</span> <span class="n">rep</span> <span class="n">interface</span> <span class="mi">2</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">u25eth0_0</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br1</span> <span class="n">u25eth1_0</span>
</pre></div>
</div>
</li>
<li><p>Make the two bridges up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">br0</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="n">br1</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
</li>
<li><p>Refer to <a class="reference internal" href="ug1534-vminstall.html"><span class="doc">VM Installation</span></a> to make the virtual machine up.</p></li>
</ol>
</div>
<div class="section" id="id4">
<h5>Server 2 Configuration<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<ol>
<li><p>Check the driver version of the U25N interface using this command:</p>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N X2 driver version is 5.3.3.1003.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p>This should give the output as version 5.3.3.1003.</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">U25N Driver</a>.</p>
<p><strong><em>Note</em>:</strong> Refer to <a class="reference external" href="link">Deployment Image Flashing</a> for flashing images to check OVS functionality.</p>
</li>
<li><p>Make the U25N PF interfaces up:</p>
<p>List the PF interfaces using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. Find the U25N PF interface using the <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-i</span> <span class="pre">&lt;interface_name&gt;</span></code>command.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">U25_eth0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Driver: sfc</p>
<p>Version: 5.3.3.1003</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">U25_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25eth0</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="n">U25eth1</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Assign tunnel IP to PF0 and PF1 interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_2</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">U25eth0</span> <span class="mf">10.16.0.1</span><span class="o">/</span><span class="mi">24</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="n">U25eth1</span> <span class="mf">10.16.0.4</span><span class="o">/</span><span class="mi">24</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Allocate the number of VF to PF. Here, one VF is allocated to the PF0 and PF1 interfaces:</p>
<p><strong><em>Note</em>:</strong> The sriov_numvfs count should be less than or equal to VF count given in sfboot command. The sriov_numvfs should be done only in legacy mode. To check mode, please follow the below steps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="n">show</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pci_id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The output of the above command would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.0</span> <span class="n">mode</span> <span class="n">legacy</span>
</pre></div>
</div>
<p>If not in legacy mode, change to legacy mode using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">legacy</span>
<span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/&lt;</span><span class="n">interface</span><span class="o">&gt;/</span><span class="n">device</span><span class="o">/</span><span class="n">sriov_numvfs</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">U25_eth0</span><span class="o">/</span><span class="n">device</span><span class="o">/</span><span class="n">sriov_numvfs</span>
<span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">U25_eth1</span><span class="o">/</span><span class="n">device</span><span class="o">/</span><span class="n">sriov_numvfs</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> After the above command is executed, a VF PCIe ID and a VF interface are created corresponding to each PF0 and PF1. The VF PCIe device ID can be listed with the <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">-d</span> <span class="pre">1924:1b03</span></code> command. An example of the device ID is af:00.2 Ethernet controller: Solarflare Communications XtremeScale SFC9250 10/25/40/50/100G Ethernet Controller (Virtual Function) (rev 01) and af:00.6 Ethernet controller: Solarflare Communications XtremeScale SFC9250 10/25/40/50/100G Ethernet Controller (Virtual Function) (rev 01). These VF PCIe IDs would be used for binding VFs to VMs.</p>
</li>
<li><p>The two VF interfaces can be found using the <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">-a</span></code> command. To differentiate VF from PF, use the <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">show</span></code> command. This gives the VF interface ID and VF interface mac address under the PF interface.</p></li>
<li><p>Make the two VF interfaces up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">vf_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Make the PF0 and PF1 interfaces into switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 and PF1 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives the PCIe device bus ID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="n">idm</span> <span class="n">ode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.0</span> <span class="n">mode</span> <span class="n">switchdev</span>
<span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mf">00.1</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
</li>
<li><p>Running the above command creates a VF representor interface corresponding to each PF interface. The VF representor interface name will be the PF interface name along with <code class="docutils literal notranslate"><span class="pre">_0</span></code>.</p>
<p><strong><em>Note</em>:</strong> Here, the number of VF representor created is based on the sriov_numvfs value configured.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">link</span> <span class="n">show</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">&lt;</span><span class="n">PF_interface</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">show</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&lt;u25eth0&gt;</span></code>.</p>
<p><strong><em>Note</em>:</strong> Here u25eth0 and u25eth1 are the PF interfaces, and u25eth0_0 and u25eth1_0 are the VF representor interfaces.</p>
<p>Now make the VF representor interfaces up using the ifconfig command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">vf_rep_interface</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.md#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed to the next step.</p></li>
<li><p>Create VXLAN/GRE interfaces:</p>
<p><strong><em>Note</em>:</strong> The following configuration is for the VXLAN. Similarly, the GRE tunnel could also be used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">vxlan0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">vxlan0</span> <span class="nb">type</span><span class="o">=</span><span class="n">vxlan</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span>
<span class="n">options</span><span class="p">:</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">key_id</span><span class="o">&gt;</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br1</span> <span class="n">vxlan1</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">vxlan0</span> <span class="nb">type</span><span class="o">=</span><span class="n">vxlan</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span>
<span class="n">options</span><span class="p">:</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">key_id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">vxlan0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">vxlan0</span> <span class="nb">type</span><span class="o">=</span><span class="n">vxlan</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=</span><span class="mf">10.16.0.1</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=</span><span class="mf">10.16.0.2</span> <span class="n">options</span><span class="p">:</span><span class="n">key</span><span class="o">=</span><span class="mi">123</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br1</span> <span class="n">vxlan1</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">vxlan</span> <span class="nb">type</span><span class="o">=</span><span class="n">vxlan</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=</span><span class="mf">10.16.0.4</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=</span><span class="mf">10.16.0.3</span> <span class="n">options</span><span class="p">:</span><span class="n">key</span><span class="o">=</span><span class="mi">456</span>
</pre></div>
</div>
</li>
<li><p>Adding VF representor of each PF interface to separate OVS bridge.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name_0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">VF</span> <span class="n">rep</span> <span class="n">interface</span> <span class="mi">1</span><span class="o">&gt;</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">VF</span> <span class="n">rep</span> <span class="n">interface</span> <span class="mi">2</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">u25eth0_0</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br1</span> <span class="n">u25eth1_0</span>
</pre></div>
</div>
</li>
<li><p>Make the two bridges up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">br0</span> <span class="n">up</span>
<span class="n">ifconfig</span> <span class="n">br1</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
</li>
<li><p>Refer to <a class="reference internal" href="ug1534-vminstall.html"><span class="doc">VM Installation</span></a> to make the virtual machine up. After the VM is up, do refer to <a class="reference external" href="link">Functionality Check</a> check functionality.</p></li>
</ol>
<p><em>Figure 12:</em> <strong>Tunneling/Detunneling</strong></p>
<p><img alt="X25696-090721" src="../_images/ash1631066523492_LowRes.png" /></p>
</div>
</div>
</div>
<div class="section" id="ovs-configuration">
<h3>OVS Configuration<a class="headerlink" href="#ovs-configuration" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Export the OVS path:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export PATH=$PATH:/usr/local/share/openvswitch/scripts
export PATH=$PATH:/usr/local/bin
</pre></div>
</div>
</li>
<li><p>Stop OVS and remove the database for removing old configurations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">ctl</span> <span class="n">stop</span>
<span class="n">rm</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">openvswitch</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">db</span>
</pre></div>
</div>
</li>
<li><p>Start OVS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">ctl</span> <span class="n">start</span>
</pre></div>
</div>
</li>
<li><p>Enable hardware offload:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="nb">set</span> <span class="n">Open_vSwitch</span> <span class="o">.</span> <span class="n">other_config</span><span class="p">:</span><span class="n">hw</span><span class="o">-</span><span class="n">offload</span><span class="o">=</span><span class="n">true</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="nb">set</span> <span class="n">Open_vSwitch</span> <span class="o">.</span> <span class="n">other_config</span><span class="p">:</span><span class="n">tc</span><span class="o">-</span><span class="n">policy</span><span class="o">=</span><span class="n">none</span>
</pre></div>
</div>
</li>
<li><p>After adding the policy, restart OVS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">ctl</span> <span class="n">restart</span>
</pre></div>
</div>
</li>
<li><p>Set OVS log levels (for debug purpose only, if needed):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">appctl</span> <span class="n">vlog</span><span class="o">/</span><span class="nb">set</span> <span class="n">ANY</span><span class="p">:</span><span class="n">ANY</span><span class="p">:</span><span class="n">dbg</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">appctl</span> <span class="n">vlog</span><span class="o">/</span><span class="nb">set</span> <span class="n">poll_loop</span><span class="p">:</span><span class="n">ANY</span><span class="p">:</span><span class="n">OFF</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">appctl</span> <span class="n">vlog</span><span class="o">/</span><span class="nb">set</span> <span class="n">netlink_socket</span><span class="p">:</span><span class="n">ANY</span><span class="p">:</span><span class="n">OFF</span>
</pre></div>
</div>
</li>
<li><p>Obtain the maximum time (in ms) that idle flows remain cached in the datapath:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ovs-vsctl set open_vswitch $(ovs-vsctl list open_vswitch | grep _uuid |
cut -f2 -d &quot;:&quot; | tr -d &#39; &#39;) other_config:max-idle=30000000g
</pre></div>
</div>
</li>
<li><p>Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
<p>The output should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">git_version</span><span class="o">&gt;</span>
<span class="n">ovs_version</span><span class="p">:</span> <span class="s2">&quot;&lt;ovs_version&gt;&quot;</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> OVS versions 2.12 and 2.14 have been tested.</p>
</li>
<li><p>Add bridge to OVS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">br</span> <span class="o">&lt;</span><span class="n">bridge</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">br</span> <span class="n">br0</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> For VM to VM or VM to Port or Port to VM Tunnel alone create two OVS bridges. For example, <code class="docutils literal notranslate"><span class="pre">ovs-vsctl</span> <span class="pre">add-br</span> <span class="pre">br0</span></code> and <code class="docutils literal notranslate"><span class="pre">ovs-vsctl</span> <span class="pre">add-br</span> <span class="pre">br1</span></code>.</p>
</li>
</ol>
</div>
<div class="section" id="functionality-check">
<h3>Functionality Check<a class="headerlink" href="#functionality-check" title="Permalink to this headline">¶</a></h3>
<p>After adding the U25N network interfaces to the OVS bridge, the functionality can be verified using ping, iperf, and dpdk network performance tools.</p>
<div class="section" id="ping-test">
<h4>Ping Test<a class="headerlink" href="#ping-test" title="Permalink to this headline">¶</a></h4>
<ol>
<li><p>Assign the IP address to the respective interface and do a ping using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ping</span> <span class="o">&lt;</span><span class="n">remote_ip</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>After the ping occurs, do an iperf:</p>
<p><strong><em>Note</em>:</strong> For VXLAN and L2GRE, set the MTU size to 1400 before
running iperf or pktgen on a particular interface.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interfacemtu</span> <span class="mi">1400</span> <span class="p">[</span><span class="k">as</span> <span class="n">root</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>Run iperf3 -s on the host device [iperf server].</p></li>
<li><p>Run iperf3 -c <ip> on a remote device [iperf client].</p></li>
</ol>
<p><strong><em>Note</em>:</strong> Refer to <a class="reference external" href="link">DPDK on U25N</a> to run dpdk-testpmd.</p>
</div>
</div>
<div class="section" id="statistics">
<h3>Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h3>
<p>Refer to Statistics to get commands for statistics.</p>
</div>
</div>
<div class="section" id="ipsec">
<h2>IPsec<a class="headerlink" href="#ipsec" title="Permalink to this headline">¶</a></h2>
<div class="section" id="supported-xfrm-parameters">
<h3>Supported XFRM Parameters<a class="headerlink" href="#supported-xfrm-parameters" title="Permalink to this headline">¶</a></h3>
<p>IPsec tunnels are created between two servers. Because IPsec is in <em>transport mode</em>, L2GRE is used to create tunnels. The strongSwan application runs in userspace. The charon plugin of strongSwan is used to offload rules on the U25N. Packets reaching the IPsec module should be L2GRE encapsulated.</p>
<ul class="simple">
<li><p>Encryption algorithm: AES-GCM 256 encryption/decryption</p></li>
<li><p>IPsec mode: Transport mode.</p></li>
<li><p>Maximum IPsec tunnel supported: 32</p></li>
</ul>
</div>
<div class="section" id="id5">
<h3>Classification Fields (Matches)<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="section" id="encryption">
<h4>Encryption<a class="headerlink" href="#encryption" title="Permalink to this headline">¶</a></h4>
<p>Key</p>
<ol class="simple">
<li><p>IPv4 source address</p></li>
<li><p>IPv4 destination address</p></li>
<li><p>IP4 protocol Action</p></li>
</ol>
<p>Action</p>
<ol class="simple">
<li><p>Action flag</p></li>
<li><p>SPI</p></li>
<li><p>Key</p></li>
<li><p>IV</p></li>
</ol>
</div>
<div class="section" id="decryption">
<h4>Decryption<a class="headerlink" href="#decryption" title="Permalink to this headline">¶</a></h4>
<p>Key</p>
<ol class="simple">
<li><p>IPv4 source address</p></li>
<li><p>IPv4 destination address</p></li>
<li><p>SPI Action</p></li>
</ol>
<p>Action</p>
<ol class="simple">
<li><p>Decryption key</p></li>
<li><p>IV</p></li>
</ol>
</div>
</div>
<div class="section" id="strongswan-installation">
<h3>strongSwan Installation<a class="headerlink" href="#strongswan-installation" title="Permalink to this headline">¶</a></h3>
<p>Do the following as a root user:</p>
<ul class="simple">
<li><p>apt-get install aptitude</p></li>
<li><p>aptitude install opensc</p></li>
<li><p>aptitude install libgmp10</p></li>
<li><p>aptitude install libgmp-dev</p></li>
<li><p>apt-get install libssl-dev</p></li>
</ul>
<p><strong><em>Note</em>:</strong> Before installing the Debian package for strongSwan, make sure all the dependencies are installed.</p>
<ol>
<li><p>Refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p></li>
<li><p>Check the version of the strongSwan Debian package. If it shows the version as strongswan_5.8.4-1, ignore this step.</p>
<p>The version can be found using the command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">swanctl</span> <span class="pre">--version</span></code>.</p>
<p>Remove the already installed package before installing the latest one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpkg</span> <span class="o">-</span><span class="n">r</span> <span class="n">strongswan_5</span><span class="mf">.8.4</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span>
<span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">strongswan_5</span><span class="mf">.8.4</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span>
</pre></div>
</div>
</li>
<li><p>After installation of the strongSwan package, create a CA certificate. For this, create a CA certificate in one server and copy the same to another server.</p></li>
</ol>
<div class="section" id="id6">
<h4>Server 1 Configuration<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<ol>
<li><p>Generate a self-sign CA certificate using the PKI utility of strongSwan:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">d</span>
<span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="n">gen</span> <span class="o">--</span><span class="nb">type</span> <span class="n">rsa</span> <span class="o">--</span><span class="n">size</span> <span class="mi">4096</span> <span class="o">--</span><span class="n">outform</span> <span class="n">pem</span> <span class="o">&gt;</span> <span class="n">private</span><span class="o">/</span>
<span class="n">strongswanKey</span><span class="o">.</span><span class="n">pem</span>
<span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="bp">self</span> <span class="o">--</span><span class="n">ca</span> <span class="o">--</span><span class="n">lifetime</span> <span class="mi">3650</span> <span class="o">--</span><span class="ow">in</span> <span class="n">private</span><span class="o">/</span><span class="n">strongswanKey</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span>
<span class="nb">type</span> <span class="n">rsa</span> <span class="o">--</span><span class="n">dn</span> <span class="s2">&quot;C=CH, O=strongSwan, CN=Root CA&quot;</span> <span class="o">--</span><span class="n">outform</span> <span class="n">pem</span> <span class="o">&gt;</span> <span class="n">cacerts</span><span class="o">/</span>
<span class="n">strongswanCert</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
</li>
<li><p>After the key and certificate is generated in server 1, copy it to server 2 in the same path.</p>
<p>a. Copy the file <code class="docutils literal notranslate"><span class="pre">strongswanKey.pem</span></code> in the path <code class="docutils literal notranslate"><span class="pre">/etc/ipsec.d/private/</span></code> in the first server to the second server in the same path.</p>
<p>b. Copy the file <code class="docutils literal notranslate"><span class="pre">strongswanCert.pem</span></code> in the path <code class="docutils literal notranslate"><span class="pre">/etc/ipsec.d/cacerts/strongswanCert.pem</span></code> in the first server to the second server in the same path.</p>
<p>After finishing the above, create a key pair and certificate for each server separately as root.</p>
</li>
<li><p>Generate the key pair and certificate in server 1 as root:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">d</span>
<span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="n">gen</span> <span class="o">--</span><span class="nb">type</span> <span class="n">rsa</span> <span class="o">--</span><span class="n">size</span> <span class="mi">2048</span> <span class="o">--</span><span class="n">outform</span> <span class="n">pem</span> <span class="o">&gt;</span> <span class="n">private</span><span class="o">/</span>
<span class="n">client1Key</span><span class="o">.</span><span class="n">pem</span>
<span class="n">chmod</span> <span class="mi">600</span> <span class="n">private</span><span class="o">/</span><span class="n">client1Key</span><span class="o">.</span><span class="n">pem</span>
<span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="n">pub</span> <span class="o">--</span><span class="ow">in</span> <span class="n">private</span><span class="o">/</span><span class="n">client1Key</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="nb">type</span> <span class="n">rsa</span> <span class="o">|</span> <span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span>
<span class="n">issue</span> <span class="o">--</span><span class="n">lifetime</span> <span class="mi">730</span> <span class="o">--</span><span class="n">cacert</span> <span class="n">cacerts</span><span class="o">/</span><span class="n">strongswanCert</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="n">cakey</span> <span class="n">private</span><span class="o">/</span>
<span class="n">strongswanKey</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="n">dn</span> <span class="s2">&quot;C=CH, O=strongSwan, CN=device1&quot;</span> <span class="o">--</span><span class="n">san</span> <span class="n">device1</span> <span class="o">--</span>
<span class="n">flag</span> <span class="n">serverAuth</span> <span class="o">--</span><span class="n">flag</span> <span class="n">ikeIntermediate</span> <span class="o">--</span><span class="n">outform</span> <span class="n">pem</span> <span class="o">&gt;</span> <span class="n">certs</span><span class="o">/</span>
<span class="n">client1Cert</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
</li>
<li><p>Configure the conf file and secret file in server 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">conf</span>
<span class="n">conn</span> <span class="n">hw_offload</span> <span class="c1">#</span>
<span class="n">left</span><span class="o">=</span><span class="mf">10.16.0.2</span>
<span class="n">right</span><span class="o">=</span><span class="mf">10.16.0.1</span>
<span class="n">ike</span><span class="o">=</span><span class="n">aes256gcm16</span><span class="o">-</span><span class="n">sha256</span><span class="o">-</span><span class="n">modp2048</span>
<span class="n">esp</span><span class="o">=</span><span class="n">aes256gcm16</span><span class="o">-</span><span class="n">modp2048</span>
<span class="n">keyingtries</span><span class="o">=%</span><span class="n">forever</span>
<span class="n">ikelifetime</span><span class="o">=</span><span class="mi">8</span><span class="n">h</span>
<span class="n">lifetime</span><span class="o">=</span><span class="mi">8</span><span class="n">h</span>
<span class="n">dpddelay</span><span class="o">=</span><span class="mi">1</span><span class="n">h</span>
<span class="n">dpdtimeout</span><span class="o">=</span><span class="mi">1</span><span class="n">h</span>
<span class="n">dpdaction</span><span class="o">=</span><span class="n">restart</span>
<span class="n">auto</span><span class="o">=</span><span class="n">route</span>
<span class="n">keyexchange</span><span class="o">=</span><span class="n">ikev2</span>
<span class="nb">type</span><span class="o">=</span><span class="n">transport</span>
<span class="n">leftcert</span><span class="o">=</span><span class="n">client1Cert</span><span class="o">.</span><span class="n">pem</span>
<span class="n">leftsendcert</span><span class="o">=</span><span class="n">always</span>
<span class="n">hw_offload</span><span class="o">=</span><span class="n">yes</span>
<span class="n">leftid</span><span class="o">=</span><span class="s2">&quot;C=CH, O=strongSwan, CN=device1&quot;</span>
<span class="n">rightid</span><span class="o">=</span><span class="s2">&quot;C=CH, O=strongSwan, CN=device2&quot;</span>
<span class="n">leftprotoport</span><span class="o">=</span><span class="n">gre</span>
<span class="n">rightprotoport</span><span class="o">=</span><span class="n">gre</span>
<span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">secrets</span>
<span class="p">:</span> <span class="n">RSA</span> <span class="n">client1Key</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> White space is present between <code class="docutils literal notranslate"><span class="pre">:</span></code> and <code class="docutils literal notranslate"><span class="pre">RSA</span></code>.</p>
</li>
</ol>
</div>
<div class="section" id="id7">
<h4>Server 2 Configuration<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<ol>
<li><p>Generate the key pair and certificate in server 2 as root:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">d</span>
<span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="n">gen</span> <span class="o">--</span><span class="nb">type</span> <span class="n">rsa</span> <span class="o">--</span><span class="n">size</span> <span class="mi">2048</span> <span class="o">--</span><span class="n">outform</span> <span class="n">pem</span> <span class="o">&gt;</span> <span class="n">private</span><span class="o">/</span>
<span class="n">client2Key</span><span class="o">.</span><span class="n">pem</span>
<span class="n">chmod</span> <span class="mi">600</span> <span class="n">private</span><span class="o">/</span><span class="n">client2Key</span><span class="o">.</span><span class="n">pem</span>
<span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span><span class="n">pub</span> <span class="o">--</span><span class="ow">in</span> <span class="n">private</span><span class="o">/</span><span class="n">client2Key</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="nb">type</span> <span class="n">rsa</span> <span class="o">|</span> <span class="n">ipsec</span> <span class="n">pki</span> <span class="o">--</span>
<span class="n">issue</span> <span class="o">--</span><span class="n">lifetime</span> <span class="mi">730</span> <span class="o">--</span><span class="n">cacert</span> <span class="n">cacerts</span><span class="o">/</span><span class="n">strongswanCert</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="n">cakey</span> <span class="n">private</span><span class="o">/</span>
<span class="n">strongswanKey</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="n">dn</span> <span class="s2">&quot;C=CH, O=strongSwan, CN=device2&quot;</span> <span class="o">--</span><span class="n">san</span> <span class="n">device2</span> <span class="o">--</span>
<span class="n">flag</span> <span class="n">serverAuth</span> <span class="o">--</span><span class="n">flag</span> <span class="n">ikeIntermediate</span> <span class="o">--</span><span class="n">outform</span> <span class="n">pem</span> <span class="o">&gt;</span> <span class="n">certs</span><span class="o">/</span>
<span class="n">client2Cert</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
</li>
<li><p>Configure the conf file and secret file in server 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">conf</span>
<span class="n">conn</span> <span class="n">hw_offload</span> <span class="c1">#</span>
<span class="n">left</span><span class="o">=</span><span class="mf">10.16.0.1</span>
<span class="n">right</span><span class="o">=</span><span class="mf">10.16.0.2</span>
<span class="n">ike</span><span class="o">=</span><span class="n">aes256gcm16</span><span class="o">-</span><span class="n">sha256</span><span class="o">-</span><span class="n">modp2048</span>
<span class="n">esp</span><span class="o">=</span><span class="n">aes256gcm16</span><span class="o">-</span><span class="n">modp2048</span>
<span class="n">keyingtries</span><span class="o">=%</span><span class="n">forever</span>
<span class="n">ikelifetime</span><span class="o">=</span><span class="mi">8</span><span class="n">h</span>
<span class="n">lifetime</span><span class="o">=</span><span class="mi">8</span><span class="n">h</span>
<span class="n">dpddelay</span><span class="o">=</span><span class="mi">1</span><span class="n">h</span>
<span class="n">dpdtimeout</span><span class="o">=</span><span class="mi">1</span><span class="n">h</span>
<span class="n">dpdaction</span><span class="o">=</span><span class="n">restart</span>
<span class="n">auto</span><span class="o">=</span><span class="n">route</span>
<span class="n">keyexchange</span><span class="o">=</span><span class="n">ikev2</span>
<span class="nb">type</span><span class="o">=</span><span class="n">transport</span>
<span class="n">leftcert</span><span class="o">=</span><span class="n">client2Cert</span><span class="o">.</span><span class="n">pem</span>
<span class="n">leftsendcert</span><span class="o">=</span><span class="n">always</span>
<span class="n">hw_offload</span><span class="o">=</span><span class="n">yes</span>
<span class="n">leftid</span><span class="o">=</span><span class="s2">&quot;C=CH, O=strongSwan, CN=device2&quot;</span>
<span class="n">rightid</span><span class="o">=</span><span class="s2">&quot;C=CH, O=strongSwan, CN=device1&quot;</span>
<span class="n">leftprotoport</span><span class="o">=</span><span class="n">gre</span>
<span class="n">rightprotoport</span><span class="o">=</span><span class="n">gre</span>
<span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ipsec</span><span class="o">.</span><span class="n">secrets</span>
<span class="p">:</span> <span class="n">RSA</span> <span class="n">client2Key</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> White space is present between <code class="docutils literal notranslate"><span class="pre">:</span></code> and <code class="docutils literal notranslate"><span class="pre">RSA</span></code>.</p>
</li>
</ol>
</div>
<div class="section" id="server-1-steps-to-run-ipsec">
<h4>Server 1: Steps to Run IPsec<a class="headerlink" href="#server-1-steps-to-run-ipsec" title="Permalink to this headline">¶</a></h4>
<ol>
<li><p>Check the driver version of the U25N interface using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N driver version is 5.3.3.1003.</p>
<p>This should give the output as version: 5.3.3.1003.</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">U25N Driver</a>.</p>
</li>
<li><p>Make the PF1 interface up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_2</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">U25eth1</span> <span class="pre">up</span></code>.</p>
</li>
<li><p>Make the PF0 interface up and assign a tunnel endpoint IP to it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">U25eth0</span> <span class="pre">10.16.0.2/24</span> <span class="pre">up</span></code>.</p>
</li>
<li><p>Make the PF0 interface into switchdev mode.</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 interface link is up before doing switchdev mode.</p>
<p>The lspci | grep Sol command gives the PCIe device bus ID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">devlink</span> <span class="pre">dev</span> <span class="pre">eswitch</span> <span class="pre">set</span> <span class="pre">pci/0000:af:00.0</span> <span class="pre">mode</span> <span class="pre">switchdev</span></code>.</p>
</li>
<li><p>Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.md#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed with the following steps.</p></li>
<li><p>Create GRE interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">gre0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">gre0</span> <span class="nb">type</span><span class="o">=</span><span class="n">gre</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">gre0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">gre0</span> <span class="nb">type</span><span class="o">=</span><span class="n">gre</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=</span><span class="mf">10.16.0.2</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=</span><span class="mf">10.16.0.1</span>
</pre></div>
</div>
</li>
<li><p>Add the PF1 interface OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="o">&lt;</span><span class="n">U25N</span> <span class="n">interface_2</span><span class="o">&gt;</span>
<span class="n">eg</span><span class="p">:</span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">U25eth1</span>
</pre></div>
</div>
</li>
<li><p>Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
</li>
<li><p>Make the bridge up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">br0</span> <span class="pre">up</span></code>.</p>
</li>
<li><p>Enable ipsec offload in the driver:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/&lt;</span><span class="n">U25N_interface_1</span><span class="o">&gt;/</span><span class="n">device</span><span class="o">/</span><span class="n">ipsec_enable</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">1</span> <span class="pre">&gt;&gt;</span> <span class="pre">/sys/class/net/U25eth0/device/ipsec_enable</span></code>.</p>
</li>
<li><p>Start IPsec:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ipsec</span> <span class="n">restart</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="server-2-steps-to-run-ipsec">
<h4>Server 2: Steps to Run IPsec<a class="headerlink" href="#server-2-steps-to-run-ipsec" title="Permalink to this headline">¶</a></h4>
<ol>
<li><p>Check the driver version of the U25N interface using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ethtool</span> <span class="o">-</span><span class="n">i</span> <span class="n">U25_eth0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">version</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Ignore this step if the U25N driver version is 5.3.3.1003.</p>
<p>This should give the output as version 5.3.3.1003.</p>
<p><strong><em>Note</em>:</strong> To install the latest sfc driver, refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">U25N Driver</a>.</p>
</li>
<li><p>Make the PF1 interface up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_2</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">U25eth1</span> <span class="pre">up</span></code>.</p>
</li>
<li><p>Make the PF0 interface up and assign a tunnel IP to it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">interface_1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">U25_eth0</span> <span class="pre">10.16.0.1/24up</span></code>.</p>
</li>
<li><p>Make the PF0 interface into switchdev mode:</p>
<p><strong><em>Note</em>:</strong> Make sure the PF0 interface link is up before doing switchdev mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lspci</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Sol</span></code> command gives us the PCIe device bus ID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">switchdev</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">devlink</span> <span class="pre">dev</span> <span class="pre">eswitch</span> <span class="pre">set</span> <span class="pre">pci/0000:af:00.0</span> <span class="pre">mode</span> <span class="pre">switchdev</span></code>.</p>
</li>
<li><p>Follow the steps mentioned in <a class="reference external" href="./ug1534-detailedappsdescriptions.md#ovs-configuration">OVS Configuration</a> to create an OVS bridge. After creating the OVS bridge, proceed with the following steps.</p></li>
<li><p>Create GRE interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">gre0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">gre0</span> <span class="nb">type</span><span class="o">=</span><span class="n">gre</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=&lt;</span><span class="n">ip_address</span><span class="o">&gt;</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">gre0</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">gre0</span> <span class="nb">type</span><span class="o">=</span><span class="n">gre</span>
<span class="n">options</span><span class="p">:</span><span class="n">local_ip</span><span class="o">=</span><span class="mf">10.16.0.1</span> <span class="n">options</span><span class="p">:</span><span class="n">remote_ip</span><span class="o">=</span><span class="mf">10.16.0.2</span>
</pre></div>
</div>
</li>
<li><p>Add PF1 interface OVS bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="o">&lt;</span><span class="n">U25N</span> <span class="n">interface_2</span><span class="o">&gt;</span>
<span class="n">eg</span><span class="p">:</span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">U25eth1</span>
</pre></div>
</div>
</li>
<li><p>Print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
</li>
<li><p>Make the bridge up.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span> <span class="n">up</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">br0</span> <span class="pre">up</span></code>.</p>
</li>
<li><p>Enable ipsec offload in the driver:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">net</span><span class="o">/&lt;</span><span class="n">U25N_interface_1</span><span class="o">&gt;/</span><span class="n">device</span><span class="o">/</span><span class="n">ipsec_enable</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">1</span> <span class="pre">&gt;&gt;</span> <span class="pre">/sys/class/net/U25eth0/device/ipsec_enable</span></code>.</p>
</li>
<li><p>Start IPsec:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ipsec</span> <span class="n">restart</span>
</pre></div>
</div>
<p>Refer to <a class="reference external" href="link">Functionality Check</a> to check OVS functionality.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="id8">
<h3>Statistics<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Refer to <a class="reference external" href="link">Statistics</a> to get IPsec statistics.</p>
<p><em>Figure 13:</em> <strong>IPsec + OVS</strong></p>
<p><img alt="X25555-091321" src="../_images/jqy1631576791246_LowRes.png" /></p>
</div>
</div>
<div class="section" id="stateless-firewall">
<h2>Stateless Firewall<a class="headerlink" href="#stateless-firewall" title="Permalink to this headline">¶</a></h2>
<p>This section is about stateless firewall prerequisites, installation steps, and rules supported.</p>
<div class="section" id="kernel-upgrade">
<h3>Kernel Upgrade<a class="headerlink" href="#kernel-upgrade" title="Permalink to this headline">¶</a></h3>
<p>Run the command <code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-r</span></code> to get the kernel version. If the kernel version is v5.5 or higher, ignore the following steps:</p>
<ol>
<li><p>Download the Debian packages for the kernel upgrade.</p></li>
<li><p>Install the dpkg utility using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">-</span><span class="n">y</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">dpkg</span>
</pre></div>
</div>
</li>
<li><p>Unzip the folder using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unzip</span> <span class="o">&lt;</span><span class="n">folder_name</span><span class="o">&gt;.</span><span class="n">zip</span>
</pre></div>
</div>
</li>
<li><p>Move inside the folder using the cd command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">folder_name</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>Run the following command to install the Debian packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="o">*.</span><span class="n">deb</span>
</pre></div>
</div>
</li>
<li><p>After the command is executed with no error, do a reboot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">reboot</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="nftables">
<h3>nftables<a class="headerlink" href="#nftables" title="Permalink to this headline">¶</a></h3>
<p><strong><em>Note</em>:</strong> Refer to <a class="reference external" href="link">Deployment Image Flashing</a> for flashing images to check firewall functionality.</p>
<ol>
<li><p>The nftables only work in legacy mode. Ensure the SmartNIC is in legacy mode using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="n">show</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pci_id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The output of the above command should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pci_id</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">mode</span> <span class="n">legacy</span>
</pre></div>
</div>
<p>If not in legacy mode, change to this mode using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devlink</span> <span class="n">dev</span> <span class="n">eswitch</span> <span class="nb">set</span> <span class="n">pci</span><span class="o">/</span><span class="mi">0000</span><span class="p">:</span><span class="o">&lt;</span><span class="n">PCIe</span> <span class="n">device</span> <span class="n">bus</span> <span class="nb">id</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="n">legacy</span>
</pre></div>
</div>
</li>
<li><p>Refer to <a class="reference external" href="./ug1534-installation.md#basic-requirements-and-component-versions-supported">Basic Requirements and Component Versions Supported</a> for the required OS/software version.</p>
<p>The nftables version can be found using the command <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">-v</span></code>.</p>
<p>nftables version ≥ v0.9.6</p>
<p><strong><em>Note</em>:</strong> Tested version 0.9.6 and 0.9.8.</p>
</li>
</ol>
</div>
<div class="section" id="id9">
<h3>Classification Fields (Matches)<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Maximum rules supported: 1K for each U25N PF interface.</p>
<p>Key:</p>
<ol class="simple">
<li><p>IPv4/IPv6 source address</p></li>
<li><p>IPv4/IPv6 destination address</p></li>
<li><p>Protocol (TCP/UDP)</p></li>
<li><p>Src_port</p></li>
<li><p>Dst_port</p></li>
<li><p>Chain</p></li>
<li><p>Interface Action</p></li>
</ol>
<p>Action</p>
<ol class="simple">
<li><p>drop</p></li>
<li><p>accept</p></li>
</ol>
<div class="section" id="driver-installation">
<h4>Driver Installation<a class="headerlink" href="#driver-installation" title="Permalink to this headline">¶</a></h4>
<p><strong><em>Note</em>:</strong> Log in as root user before proceeding with the following
steps.</p>
<p>The prerequisites for the installation are as follows:</p>
<ul class="simple">
<li><p>modprobe mtd (first time only)</p></li>
<li><p>modprobe mdio (first time only)</p></li>
</ul>
<ol>
<li><p>If the debian package already exists, remove the existing package before installing the latest debian package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmmod</span> <span class="n">sfc</span>
<span class="n">dpkg</span> <span class="o">-</span><span class="n">r</span> <span class="n">sfc</span><span class="o">-</span><span class="n">dkms</span>
<span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">sfc</span><span class="o">-</span><span class="n">dkms_5</span><span class="mf">.3.3.2000</span><span class="n">_all</span><span class="o">.</span><span class="n">deb</span>
<span class="n">modprobe</span> <span class="n">sfc</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Login as root user before proceeding with the following steps.</p>
</li>
<li><p>Create a table</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">add</span> <span class="n">table</span> <span class="o">&lt;</span><span class="n">family</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">add</span> <span class="pre">table</span> <span class="pre">netdev</span> <span class="pre">filter</span></code>.</p>
</li>
<li><p>Create a chain:</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">add</span> <span class="pre">chain</span> <span class="pre">netdev</span> <span class="pre">filter</span> <span class="pre">input1</span> <span class="pre">{</span> <span class="pre">type</span> <span class="pre">filter</span> <span class="pre">hook</span> <span class="pre">ingress</span> <span class="pre">device</span> <span class="pre">ens7f1np1</span> <span class="pre">priority</span> <span class="pre">1;</span> <span class="pre">flags</span> <span class="pre">offload</span> <span class="pre">;}</span></code>. Adding a chain without specifying the policy leads to the default policy Accept.</p>
</li>
<li><p>Add rules to the chain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">add</span> <span class="n">rule</span> <span class="o">&lt;</span><span class="n">family</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">table</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">chain</span> <span class="n">name</span><span class="o">&gt;</span> <span class="n">ip</span> <span class="n">saddr</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">drop</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">add</span> <span class="pre">rule</span> <span class="pre">netdev</span> <span class="pre">filter</span> <span class="pre">input1</span> <span class="pre">ip</span> <span class="pre">saddr</span> <span class="pre">1.1.1.1</span> <span class="pre">drop</span></code>.</p>
</li>
<li><p>Commands for listing tables, chain, and rules:</p>
<p>a. Listing a table of a netdev family:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="nb">list</span> <span class="n">tables</span> <span class="o">&lt;</span><span class="n">family</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">list</span> <span class="pre">tables</span> <span class="pre">netdev</span></code>.</p>
<p>b. Listing a particular chain from a table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="nb">list</span> <span class="n">chain</span> <span class="o">&lt;</span><span class="n">family</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">table</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">chain_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">list</span> <span class="pre">chain</span> <span class="pre">netdev</span> <span class="pre">filter</span> <span class="pre">input1</span></code>.</p>
<p>c. Listing a chain along with a handle:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="o">-</span><span class="n">a</span> <span class="nb">list</span> <span class="n">chain</span> <span class="o">&lt;</span><span class="n">family</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">table</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">chain_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">-a</span> <span class="pre">list</span> <span class="pre">chain</span> <span class="pre">netdev</span> <span class="pre">filter</span> <span class="pre">input1</span></code>.</p>
<p>d. Listing all tables, chains, and rules with handle:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="o">-</span><span class="n">a</span> <span class="nb">list</span> <span class="n">ruleset</span>
</pre></div>
</div>
</li>
<li><p>Commands for deleting tables, chains and rules:</p>
<p>a. Deleting a table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">delete</span> <span class="n">table</span> <span class="o">&lt;</span><span class="n">family</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">delete</span> <span class="pre">table</span> <span class="pre">netdev</span> <span class="pre">filter</span></code>.</p>
<p>b. Deleting a chain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">delete</span> <span class="n">chain</span> <span class="o">&lt;</span><span class="n">family</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">table</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">chain</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">delete</span> <span class="pre">chain</span> <span class="pre">netdev</span> <span class="pre">filter</span> <span class="pre">input1</span></code>.</p>
<p>c. Deleting a specific rule with a handle:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">delete</span> <span class="n">rule</span> <span class="o">&lt;</span><span class="n">family</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">table</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">chain_name</span><span class="o">&gt;</span> <span class="n">handle</span> <span class="o">&lt;</span><span class="n">handle_no</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">delete</span> <span class="pre">rule</span> <span class="pre">netdev</span> <span class="pre">filter</span> <span class="pre">input1</span> <span class="pre">handle</span> <span class="pre">3</span></code>.</p>
<p><strong><em>Note</em>:</strong> Here the handle number for a specific rule could be found using the <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">-a</span> <span class="pre">list</span> <span class="pre">ruleset</span></code> command.</p>
</li>
</ol>
<p><em>Figure 14:</em> <strong>Firewall</strong></p>
<p><img alt="X25556-091321 this table might be messed up" src="../_images/uhd1631577266564_LowRes.png" /></p>
</div>
</div>
</div>
<div class="section" id="id10">
<h2>Statistics<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>This section outlines the commands used by different modules to check the statistics and packet counters.</p>
<div class="section" id="ovs-commands">
<h3>OVS Commands<a class="headerlink" href="#ovs-commands" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>To print a brief overview of the database contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
</pre></div>
</div>
</li>
<li><p>To show the datapath flow entries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">ofctl</span> <span class="n">dump</span><span class="o">-</span><span class="n">flows</span> <span class="o">&lt;</span><span class="n">bridge_name</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>To show the full OpenFlow flow table, including hidden flows, on the bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">appctl</span> <span class="n">dpctl</span><span class="o">/</span><span class="n">dump</span><span class="o">-</span><span class="n">flows</span> <span class="nb">type</span><span class="o">=</span><span class="n">offloaded</span>
</pre></div>
</div>
</li>
<li><p>To show the OVS datapath flows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">dpctl</span> <span class="n">dump</span><span class="o">-</span><span class="n">flows</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">appctl</span> <span class="n">dpctl</span><span class="o">/</span><span class="n">dump</span><span class="o">-</span><span class="n">flows</span>
</pre></div>
</div>
</li>
<li><p>To show which flows are offloaded or not:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span> <span class="nb">filter</span> <span class="n">show</span> <span class="n">dev</span> <span class="o">&lt;</span><span class="n">iface_name</span><span class="o">&gt;</span> <span class="n">ingress</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="mae-rules">
<h3>MAE Rules<a class="headerlink" href="#mae-rules" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>To show offloaded rules now present in the match-action engine (MAE):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">sfc</span><span class="o">/&lt;</span><span class="n">if_iface</span><span class="o">&gt;/</span><span class="n">mae_rules</span>
</pre></div>
</div>
<p><strong><em>Note</em>:</strong> Here <code class="docutils literal notranslate"><span class="pre">if_iface</span></code> should be the corresponding PF interface.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/sys/kernel/debug/sfc/if_u25eth0/mae_rules</span></code>.</p>
</li>
<li><p>To show default rules now present in the MAE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">sfc</span><span class="o">/&lt;</span><span class="n">iface</span><span class="o">/</span><span class="n">mae_default_rules</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="ipsec-statistics">
<h3>IPsec Statistics<a class="headerlink" href="#ipsec-statistics" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">swanctl</span> <span class="pre">--stats</span></code></p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">xfrm</span> <span class="pre">show</span></code> command to display IPsec offload security association.</p></li>
</ul>
</div>
<div class="section" id="external-mac-counter">
<h3>External MAC counter<a class="headerlink" href="#external-mac-counter" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
</div>
<div class="section" id="debug-commands">
<h2>Debug Commands<a class="headerlink" href="#debug-commands" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>To get kernel logs, enter the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dmesg</span>
</pre></div>
</div>
</li>
<li><p>Logs from the U25N hardware are saved to a file. Reading a file from the X86 host produces logs. The logs are collected from the internal processing subsystem and exported to the host at intervals. These logs are populated when switchdev mode is enabled. The path to read the logs in host is <code class="docutils literal notranslate"><span class="pre">/var/log/ps_dmesg.txt</span></code>.</p></li>
<li><p>sfreport: This is a command line utility that generates a diagnostic log file providing diagnostic data about the server and Solarflare adapters.</p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ug1534-dpdk.html" class="btn btn-neutral float-right" title="DPDK" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ug1534-installation.html" class="btn btn-neutral float-left" title="U25N Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on March 31, 2022.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
														
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<div class="lang-select dropup hidden-md hidden-lg">
		<button data-toggle="dropdown">
			<span class="fas fa-globe" aria-hidden="true"></span>
			<span>
				
					English
				</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a target="_blank" href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
																	<div class="lang-select dropup hidden-xs hidden-sm">
	<button data-toggle="dropdown">
		<span class="fas fa-globe" aria-hidden="true"></span>
		<span>
			
				English
			</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
															</div>
														</div>
														<div class="col-md-pull-5 col-lg-pull-5 col-md-5 col-lg-5">
															<span class="copyright">©2022 Advanced Micro Devices, Inc</span>
														</div>

													</div>
													                    <div class="movethisrowtoleft row">
                        <div class="col-xs-24">
                            <ul class="sub-menu">
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a></li>
								<li><a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a></li>
                                <li><a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></li>
                            </ul>
                        </div>
                    </div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
<div class="backToTop parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><noindex>
    <span data-component="backToTopButton" class="backToTopButton loaded">
        <ul>
            <li>
                <a href="https://www.author.xilinx.com/xx/rebrand/amd/en-amd-xilinx-header-footer.html#top" class="btn top">
                    <span class="fas fa-angle-up" aria-hidden="true"></span>
                </a>
            </li>
        </ul>
    </span>
</noindex></div>
			</div>
		</div>


		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>